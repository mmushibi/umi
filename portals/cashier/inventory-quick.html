<!DOCTYPE html>
<html lang="en" x-data="inventorySystem()">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Inventory Management - Umi Health Information Systems</title>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@100;400;500;600;700&family=Varela+Round&family=Nunito:wght@400;600;700&display=swap" rel="stylesheet">
  <link href="https://fonts.googleapis.com/css2?family=Material+Symbols+Rounded:wght@300;400;500;600;700&display=swap" rel="stylesheet">
  <script src="https://cdn.tailwindcss.com"></script>
  <style>
    :root {
      --color-primary: #000000;
      --color-accent: #14B8A6;
      --color-success: #22c55e;
      --color-warning: #ef4444;
      --color-text-primary: #000000;
      --color-text-secondary: #6b7280;
      --color-text-muted: #9ca3af;
      --color-background: #ffffff;
      --color-surface: #f9fafb;
      --color-border: #e5e7eb;
      --font-primary: 'Inter', sans-serif;
      --sidebar-width: 280px;
    }

    * {
      box-sizing: border-box;
      margin: 0;
      padding: 0;
    }

    body {
      background: var(--color-background);
      color: var(--color-text-primary);
      font-family: 'Nunito', 'Varela Round', sans-serif;
      line-height: 1.5;
      overflow-x: hidden;
    }

    /* Sidebar Styles */
    .sidebar {
      position: fixed;
      left: 0;
      top: 0;
      width: var(--sidebar-width);
      height: 100vh;
      background: var(--color-text-primary);
      color: var(--color-accent);
      z-index: 1000;
      transition: transform 0.3s ease;
      display: flex;
      flex-direction: column;
      overflow-y: auto;
      overflow-x: hidden;
    }

    .sidebar-header {
      padding: 1.5rem;
      border-bottom: 1px solid rgba(255, 255, 255, 0.1);
    }

    .logo-section {
      display: flex;
      align-items: center;
      gap: 0.75rem;
    }

    .logo-icon {
      width: 40px;
      height: 40px;
      background: rgba(255, 255, 255, 0.2);
      border-radius: 10px;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 1.5rem;
    }

    .logo-text {
      font-size: 1.25rem;
      font-weight: 700;
      font-family: 'Inter', sans-serif;
    }

    .nav-menu {
      padding: 1rem 0;
      flex: 1;
      overflow-y: auto;
    }

    .nav-item {
      display: flex;
      align-items: center;
      gap: 1rem;
      padding: 0.875rem 1.5rem;
      color: rgba(255, 255, 255, 0.8);
      text-decoration: none;
      transition: all 0.2s ease;
      cursor: pointer;
      font-size: 0.9rem;
      font-weight: 500;
    }

    .nav-item:hover {
      background: rgba(255, 255, 255, 0.1);
      color: var(--color-accent);
    }

    .nav-item.active {
      background: rgba(255, 255, 255, 0.15);
      color: var(--color-accent);
      border-left: 3px solid var(--color-accent);
    }

    .nav-icon {
      font-size: 1.25rem;
    }

    /* Main Content Area */
    .main-content {
      margin-left: var(--sidebar-width);
      min-height: 100vh;
      transition: margin-left 0.3s ease;
    }

    /* Header Styles */
    .header {
      background: white;
      border-bottom: 1px solid #e2e8f0;
      padding: 1rem 2rem;
      display: flex;
      justify-content: space-between;
      align-items: center;
      position: sticky;
      top: 0;
      z-index: 100;
    }

    .header-left {
      display: flex;
      align-items: center;
      gap: 1rem;
    }

    .page-title-section {
      margin-right: 2rem;
    }

    .page-title-section .page-title {
      font-size: 1.5rem;
      font-weight: 700;
      color: var(--color-text-primary);
      margin: 0;
      font-family: 'Inter', sans-serif;
    }

    .mobile-menu-toggle {
      display: none;
      background: none;
      border: none;
      font-size: 1.5rem;
      color: var(--color-text-secondary);
      cursor: pointer;
    }

    .header-right {
      display: flex;
      align-items: center;
      gap: 1rem;
    }

    .user-profile {
      display: flex;
      align-items: center;
      gap: 0.75rem;
      padding: 0.5rem;
      border-radius: 16px;
      cursor: pointer;
      transition: all 0.3s ease;
    }

    .user-profile:hover {
      background: var(--color-surface);
    }

    .user-avatar {
      width: 36px;
      height: 36px;
      background: var(--color-text-primary);
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      color: var(--color-accent);
      font-weight: 600;
      font-size: 0.875rem;
      box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
    }

    .user-info {
      display: flex;
      flex-direction: column;
    }

    .user-name {
      font-size: 0.875rem;
      font-weight: 600;
      color: var(--color-text-primary);
    }

    .user-role {
      font-size: 0.75rem;
      color: var(--color-text-secondary);
    }

    /* Inventory Content */
    .inventory-content {
      padding: 2rem;
      max-width: 1400px;
      margin: 0 auto;
    }

    /* Stats Grid */
    .stats-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
      gap: 1.5rem;
      margin-bottom: 2rem;
    }

    .stat-card {
      background: var(--color-background);
      border-radius: 20px;
      border: 1px solid var(--color-border);
      padding: 1.5rem;
      box-shadow: 0 2px 8px rgba(0, 0, 0, 0.04);
      transition: all 0.3s ease;
    }

    .stat-card:hover {
      transform: translateY(-4px);
      box-shadow: 0 12px 24px rgba(0, 0, 0, 0.1);
    }

    .stat-header {
      display: flex;
      align-items: center;
      justify-content: space-between;
      margin-bottom: 1rem;
    }

    .stat-title {
      font-size: 0.875rem;
      font-weight: 600;
      color: var(--color-text-secondary);
    }

    .stat-icon {
      width: 40px;
      height: 40px;
      background: rgba(0, 0, 0, 0.1);
      border-radius: 10px;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 1.25rem;
      color: var(--color-text-primary);
    }

    .stat-value {
      font-size: 2rem;
      font-weight: 700;
      color: var(--color-primary);
      margin-bottom: 0.5rem;
      font-family: 'Inter', sans-serif;
    }

    .stat-description {
      color: var(--color-text-secondary);
      font-size: 0.875rem;
    }

    /* Search and Filters */
    .controls-section {
      background: var(--color-background);
      border-radius: 20px;
      border: 1px solid var(--color-border);
      padding: 1.5rem;
      margin-bottom: 2rem;
      box-shadow: 0 2px 8px rgba(0, 0, 0, 0.04);
    }

    .search-filters-grid {
      display: grid;
      grid-template-columns: 1fr auto auto;
      gap: 1rem;
      align-items: end;
    }

    .search-group {
      display: flex;
      flex-direction: column;
    }

    .search-label {
      font-weight: 500;
      color: var(--color-text-primary);
      margin-bottom: 0.5rem;
      font-size: 0.875rem;
    }

    .search-input {
      padding: 0.75rem 1rem;
      border: 1px solid var(--color-border);
      border-radius: 12px;
      font-size: 0.875rem;
      transition: all 0.3s ease;
      background: var(--color-background);
    }

    .search-input:focus {
      outline: none;
      border-color: var(--color-primary);
      box-shadow: 0 0 0 4px rgba(0, 0, 0, 0.1);
    }

    /* Button Styles */
    .btn {
      padding: 0.75rem 1.5rem;
      border-radius: 12px;
      font-size: 0.875rem;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.3s ease;
      border: none;
      display: flex;
      align-items: center;
      gap: 0.5rem;
    }

    .btn-primary {
      background: var(--color-primary);
      color: var(--color-accent);
      box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
    }

    .btn-primary:hover {
      background: var(--color-text-secondary);
      transform: translateY(-2px);
      box-shadow: 0 8px 24px rgba(0, 0, 0, 0.2);
    }

    .btn-secondary {
      background: var(--color-surface);
      color: var(--color-text-secondary);
      border: 1px solid var(--color-border);
    }

    .btn-secondary:hover {
      background: var(--color-border);
    }

    .btn-success {
      background: var(--color-success);
      color: white;
      box-shadow: 0 2px 8px rgba(34, 197, 94, 0.2);
    }

    .btn-success:hover {
      background: #16a34a;
      transform: translateY(-2px);
      box-shadow: 0 8px 24px rgba(34, 197, 94, 0.3);
    }

    /* Inventory Table */
    .inventory-section {
      background: var(--color-background);
      border-radius: 20px;
      border: 1px solid var(--color-border);
      padding: 2rem;
      box-shadow: 0 2px 8px rgba(0, 0, 0, 0.04);
    }

    .section-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 1.5rem;
    }

    .section-title {
      font-size: 1.25rem;
      font-weight: 600;
      color: var(--color-text-primary);
      font-family: 'Inter', sans-serif;
    }

    .table-container {
      overflow-x: auto;
      border-radius: 12px;
      border: 1px solid var(--color-border);
    }

    .inventory-table {
      width: 100%;
      border-collapse: collapse;
    }

    .inventory-table th {
      background: var(--color-surface);
      padding: 1rem;
      text-align: left;
      font-weight: 600;
      color: var(--color-text-primary);
      font-size: 0.875rem;
      border-bottom: 1px solid var(--color-border);
    }

    .inventory-table td {
      padding: 1rem;
      border-bottom: 1px solid var(--color-border);
      font-size: 0.875rem;
    }

    .inventory-table tr:hover {
      background: var(--color-surface);
    }

    .stock-badge {
      display: inline-flex;
      align-items: center;
      gap: 0.25rem;
      padding: 0.25rem 0.75rem;
      border-radius: 12px;
      font-size: 0.75rem;
      font-weight: 600;
    }

    .stock-badge.in-stock {
      background: rgba(34, 197, 94, 0.1);
      color: var(--color-success);
    }

    .stock-badge.low-stock {
      background: rgba(251, 191, 36, 0.1);
      color: #f59e0b;
    }

    .stock-badge.out-of-stock {
      background: rgba(239, 68, 68, 0.1);
      color: var(--color-warning);
    }

    .action-buttons {
      display: flex;
      gap: 0.5rem;
    }

    .action-btn {
      padding: 0.5rem;
      background: var(--color-surface);
      border: 1px solid var(--color-border);
      border-radius: 8px;
      cursor: pointer;
      transition: all 0.2s ease;
      color: var(--color-text-secondary);
    }

    .action-btn:hover {
      background: var(--color-border);
      color: var(--color-text-primary);
    }

    /* Loading States */
    .loading-state {
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      padding: 3rem;
      text-align: center;
    }

    .loading-spinner {
      width: 40px;
      height: 40px;
      border: 4px solid var(--color-border);
      border-top: 4px solid var(--color-primary);
      border-radius: 50%;
      animation: spin 1s linear infinite;
      margin-bottom: 1rem;
    }

    @keyframes spin {
      0% { transform: rotate(0deg); }
      100% { transform: rotate(360deg); }
    }

    .loading-state p {
      color: var(--color-text-secondary);
      font-size: 0.875rem;
      margin: 0;
    }

    .logout-section {
      padding: 1rem;
      border-top: 1px solid rgba(255, 255, 255, 0.1);
      margin-top: auto;
    }

    .logout-button {
      display: flex;
      align-items: center;
      gap: 1rem;
      padding: 0.875rem 1.5rem;
      color: rgba(255, 255, 255, 0.8);
      text-decoration: none;
      transition: all 0.2s ease;
      cursor: pointer;
      font-size: 0.9rem;
      font-weight: 500;
      width: 100%;
      border: none;
      background: transparent;
      text-align: left;
    }

    .logout-button:hover {
      background: rgba(239, 68, 68, 0.1);
      color: var(--color-warning);
    }

    .logout-icon {
      font-size: 1.25rem;
    }

    /* Modal Styles */
    .modal-overlay {
      position: fixed;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background: rgba(0, 0, 0, 0.5);
      display: flex;
      align-items: center;
      justify-content: center;
      z-index: 10000;
      padding: 1rem;
    }

    .modal-content {
      background: white;
      border-radius: 16px;
      box-shadow: 0 20px 25px -5px rgba(0, 0, 0, 0.1), 0 10px 10px -5px rgba(0, 0, 0, 0.04);
      max-width: 600px;
      width: 100%;
      max-height: 90vh;
      overflow-y: auto;
    }

    .modal-content.large {
      max-width: 800px;
    }

    .modal-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 1.5rem;
      border-bottom: 1px solid var(--color-border);
    }

    .modal-header h3 {
      margin: 0;
      font-size: 1.25rem;
      font-weight: 600;
      color: var(--color-text-primary);
    }

    .modal-close {
      background: none;
      border: none;
      font-size: 1.5rem;
      color: var(--color-text-secondary);
      cursor: pointer;
      padding: 0.5rem;
      border-radius: 8px;
      transition: all 0.2s ease;
    }

    .modal-close:hover {
      background: var(--color-surface);
      color: var(--color-text-primary);
    }

    .modal-body {
      padding: 1.5rem;
    }

    .form-grid {
      display: grid;
      grid-template-columns: repeat(2, 1fr);
      gap: 1rem;
      margin-bottom: 1.5rem;
    }

    .form-group {
      display: flex;
      flex-direction: column;
    }

    .form-group.full-width {
      grid-column: span 2;
    }

    .form-group label {
      font-weight: 500;
      color: var(--color-text-primary);
      margin-bottom: 0.5rem;
      font-size: 0.875rem;
    }

    .form-group input,
    .form-group select,
    .form-group textarea {
      padding: 0.75rem;
      border: 1px solid var(--color-border);
      border-radius: 8px;
      font-size: 0.875rem;
      transition: all 0.3s ease;
      background: var(--color-background);
    }

    .form-group input:focus,
    .form-group select:focus,
    .form-group textarea:focus {
      outline: none;
      border-color: var(--color-primary);
      box-shadow: 0 0 0 4px rgba(0, 0, 0, 0.1);
    }

    .modal-actions {
      display: flex;
      justify-content: flex-end;
      gap: 1rem;
      padding-top: 1rem;
      border-top: 1px solid var(--color-border);
    }

    /* History Table Styles */
    .history-table-container {
      overflow-x: auto;
      border-radius: 8px;
      border: 1px solid var(--color-border);
    }

    .history-table {
      width: 100%;
      border-collapse: collapse;
    }

    .history-table th {
      background: var(--color-surface);
      padding: 0.75rem;
      text-align: left;
      font-weight: 600;
      color: var(--color-text-primary);
      font-size: 0.875rem;
      border-bottom: 1px solid var(--color-border);
    }

    .history-table td {
      padding: 0.75rem;
      border-bottom: 1px solid var(--color-border);
      font-size: 0.875rem;
    }

    .action-badge {
      display: inline-flex;
      align-items: center;
      gap: 0.25rem;
      padding: 0.25rem 0.75rem;
      border-radius: 12px;
      font-size: 0.75rem;
      font-weight: 600;
    }

    .action-badge.add {
      background: rgba(34, 197, 94, 0.1);
      color: var(--color-success);
    }

    .action-badge.remove {
      background: rgba(239, 68, 68, 0.1);
      color: var(--color-warning);
    }

    .action-badge.set {
      background: rgba(59, 130, 246, 0.1);
      color: #3b82f6;
    }

    /* Barcode Scanner Styles */
    .barcode-input-group {
      display: flex;
      gap: 0.5rem;
      align-items: center;
    }

    .barcode-input-group input {
      flex: 1;
    }

    .scan-btn {
      padding: 0.75rem;
      display: flex;
      align-items: center;
      gap: 0.5rem;
      white-space: nowrap;
    }

    .scan-btn span:first-child {
      font-size: 1.25rem;
    }

    .scan-btn span:last-child {
      font-size: 0.875rem;
    }

    /* Barcode Scanner Modal Styles */
    .barcode-scanner {
      max-width: 500px;
    }

    .scanner-container {
      display: flex;
      flex-direction: column;
      align-items: center;
      gap: 1rem;
    }

    .scanner-viewport {
      position: relative;
      width: 100%;
      height: 300px;
      background: #000;
      border-radius: 8px;
      overflow: hidden;
    }

    .scanner-viewport video {
      width: 100%;
      height: 100%;
      object-fit: cover;
    }

    .scanner-overlay {
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      pointer-events: none;
    }

    .scan-line {
      position: absolute;
      top: 50%;
      left: 0;
      right: 0;
      height: 2px;
      background: linear-gradient(90deg, transparent, #22c55e, transparent);
      animation: scan 2s linear infinite;
    }

    @keyframes scan {
      0% { transform: translateY(-150px); }
      50% { transform: translateY(150px); }
      100% { transform: translateY(-150px); }
    }

    .scan-corners {
      position: absolute;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      width: 200px;
      height: 100px;
      border: 2px solid #22c55e;
      border-radius: 8px;
    }

    .scan-corners::before,
    .scan-corners::after {
      content: '';
      position: absolute;
      width: 20px;
      height: 20px;
      border: 3px solid #22c55e;
    }

    .scan-corners::before {
      top: -3px;
      left: -3px;
      border-right: none;
      border-bottom: none;
    }

    .scan-corners::after {
      bottom: -3px;
      right: -3px;
      border-left: none;
      border-top: none;
    }

    .scanner-controls {
      display: flex;
      gap: 1rem;
      justify-content: center;
      width: 100%;
    }

    /* Alerts Panel Styles */
    .alerts-panel {
      background: white;
      border-radius: 16px;
      border: 1px solid var(--color-border);
      margin: 2rem;
      box-shadow: 0 4px 12px rgba(0, 0, 0, 0.05);
      overflow: hidden;
    }

    .alerts-panel.expiry {
      border-color: #f59e0b;
    }

    .alerts-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 1rem 1.5rem;
      background: var(--color-surface);
      border-bottom: 1px solid var(--color-border);
    }

    .alerts-header h3 {
      display: flex;
      align-items: center;
      gap: 0.5rem;
      margin: 0;
      font-size: 1.125rem;
      font-weight: 600;
      color: var(--color-text-primary);
    }

    .alert-count {
      background: var(--color-warning);
      color: white;
      padding: 0.125rem 0.5rem;
      border-radius: 12px;
      font-size: 0.75rem;
      font-weight: 600;
    }

    .alerts-list {
      max-height: 300px;
      overflow-y: auto;
    }

    .alert-item {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 1rem 1.5rem;
      border-bottom: 1px solid var(--color-border);
      transition: background 0.2s ease;
    }

    .alert-item:hover {
      background: var(--color-surface);
    }

    .alert-item:last-child {
      border-bottom: none;
    }

    .alert-item.low-stock {
      border-left: 4px solid var(--color-warning);
    }

    .alert-item.critical {
      border-left: 4px solid var(--color-warning);
      background: rgba(245, 158, 11, 0.05);
    }

    .alert-item.warning {
      border-left: 4px solid #f59e0b;
      background: rgba(245, 158, 11, 0.02);
    }

    .alert-item.info {
      border-left: 4px solid #3b82f6;
      background: rgba(59, 130, 246, 0.02);
    }

    .alert-content h4 {
      margin: 0 0 0.5rem 0;
      font-size: 0.875rem;
      font-weight: 600;
      color: var(--color-text-primary);
    }

    .alert-content p {
      margin: 0;
      font-size: 0.75rem;
      color: var(--color-text-secondary);
      line-height: 1.4;
    }

    .alert-actions {
      display: flex;
      gap: 0.5rem;
      align-items: center;
    }

    .btn-sm {
      padding: 0.5rem 0.75rem;
      font-size: 0.75rem;
    }

    .btn-warning {
      background: #f59e0b;
      color: white;
      border: none;
    }

    .btn-warning:hover {
      background: #d97706;
    }

    /* Bulk Operations Styles */
    .bulk-toolbar {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 1rem 1.5rem;
      background: var(--color-surface);
      border: 1px solid var(--color-border);
      border-top: none;
      border-radius: 0 0 16px 16px;
      margin-bottom: 1rem;
    }

    .bulk-info {
      font-weight: 500;
      color: var(--color-text-primary);
    }

    .bulk-actions {
      display: flex;
      gap: 0.5rem;
      flex-wrap: wrap;
    }

    .selected-row {
      background: rgba(59, 130, 246, 0.05) !important;
    }

    .selected-row:hover {
      background: rgba(59, 130, 246, 0.1) !important;
    }

    /* Advanced Filters Section */
    .advanced-filters {
      background: white;
      border-radius: 16px;
      border: 1px solid var(--color-border);
      padding: 1.5rem;
      margin-bottom: 2rem;
      box-shadow: 0 2px 8px rgba(0, 0, 0, 0.04);
    }

    .filters-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 1rem;
    }

    .filters-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
      gap: 1rem;
    }

    .filter-group {
      display: flex;
      flex-direction: column;
    }

    .filter-group label {
      font-weight: 500;
      color: var(--color-text-primary);
      margin-bottom: 0.5rem;
      font-size: 0.875rem;
    }

    .filter-group input,
    .filter-group select {
      padding: 0.75rem;
      border: 1px solid var(--color-border);
      border-radius: 8px;
      font-size: 0.875rem;
      background: var(--color-background);
    }

    /* Reports Dashboard Styles */
    .reports-modal {
      max-width: 1200px;
      width: 95%;
      max-height: 90vh;
    }

    .report-controls {
      display: flex;
      gap: 1rem;
      align-items: end;
      margin-bottom: 2rem;
      flex-wrap: wrap;
    }

    .control-group {
      display: flex;
      flex-direction: column;
      gap: 0.5rem;
    }

    .control-group label {
      font-weight: 500;
      color: var(--color-text-primary);
      font-size: 0.875rem;
    }

    .control-group select,
    .control-group input {
      padding: 0.75rem;
      border: 1px solid var(--color-border);
      border-radius: 8px;
      font-size: 0.875rem;
      background: var(--color-background);
    }

    .metrics-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
      gap: 1.5rem;
      margin-bottom: 2rem;
    }

    .metric-card {
      background: var(--color-surface);
      border-radius: 12px;
      padding: 1.5rem;
      border: 1px solid var(--color-border);
      display: flex;
      align-items: center;
      gap: 1rem;
    }

    .metric-icon {
      width: 48px;
      height: 48px;
      background: var(--color-primary);
      color: var(--color-accent);
      border-radius: 12px;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 1.5rem;
    }

    .metric-content h4 {
      margin: 0 0 0.5rem 0;
      font-size: 0.875rem;
      color: var(--color-text-secondary);
      font-weight: 500;
    }

    .metric-value {
      margin: 0 0 0.5rem 0;
      font-size: 1.5rem;
      font-weight: 700;
      color: var(--color-text-primary);
    }

    .metric-change {
      font-size: 0.75rem;
      font-weight: 600;
      padding: 0.25rem 0.5rem;
      border-radius: 6px;
    }

    .metric-change.positive {
      background: rgba(34, 197, 94, 0.1);
      color: var(--color-success);
    }

    .metric-change.negative {
      background: rgba(239, 68, 68, 0.1);
      color: var(--color-warning);
    }

    .charts-section {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 2rem;
      margin-bottom: 2rem;
    }

    .chart-container {
      background: var(--color-surface);
      border-radius: 12px;
      padding: 1.5rem;
      border: 1px solid var(--color-border);
    }

    .chart-container h4 {
      margin: 0 0 1rem 0;
      font-size: 1rem;
      font-weight: 600;
      color: var(--color-text-primary);
    }

    .chart-placeholder {
      height: 200px;
      background: linear-gradient(45deg, #f0f0f0 25%, transparent 25%, transparent 75%, #f0f0f0 75%, #f0f0f0),
                  linear-gradient(45deg, #f0f0f0 25%, transparent 25%, transparent 75%, #f0f0f0 75%, #f0f0f0);
      background-size: 20px 20px;
      background-position: 0 0, 10px 10px;
      border-radius: 8px;
      display: flex;
      align-items: center;
      justify-content: center;
      color: var(--color-text-muted);
    }

    .top-products-section {
      margin-bottom: 2rem;
    }

    .top-products-section h4 {
      margin: 0 0 1rem 0;
      font-size: 1.125rem;
      font-weight: 600;
      color: var(--color-text-primary);
    }

    .report-table {
      width: 100%;
      border-collapse: collapse;
    }

    .report-table th {
      background: var(--color-surface);
      padding: 0.75rem;
      text-align: left;
      font-weight: 600;
      color: var(--color-text-primary);
      font-size: 0.875rem;
      border-bottom: 1px solid var(--color-border);
    }

    .report-table td {
      padding: 0.75rem;
      border-bottom: 1px solid var(--color-border);
      font-size: 0.875rem;
    }

    .export-section h4 {
      margin: 0 0 1rem 0;
      font-size: 1.125rem;
      font-weight: 600;
      color: var(--color-text-primary);
    }

    .export-buttons {
      display: flex;
      gap: 1rem;
      flex-wrap: wrap;
    }

    /* Real-time Updates Indicator */
    .real-time-indicator {
      position: fixed;
      top: 20px;
      left: 20px;
      background: var(--color-success);
      color: white;
      padding: 0.5rem 1rem;
      border-radius: 20px;
      font-size: 0.75rem;
      font-weight: 600;
      display: flex;
      align-items: center;
      gap: 0.5rem;
      z-index: 1000;
      opacity: 0;
      transform: translateY(-10px);
      transition: all 0.3s ease;
    }

    .real-time-indicator.active {
      opacity: 1;
      transform: translateY(0);
    }

    .real-time-indicator .pulse {
      width: 8px;
      height: 8px;
      background: white;
      border-radius: 50%;
      animation: pulse 2s infinite;
    }

    @keyframes pulse {
      0% { opacity: 1; }
      50% { opacity: 0.3; }
      100% { opacity: 1; }
    }

    @media (max-width: 768px) {
      .sidebar {
        transform: translateX(-100%);
      }

      .sidebar.open {
        transform: translateX(0);
      }

      .main-content {
        margin-left: 0;
      }

      .mobile-menu-toggle {
        display: block;
      }

      .page-title-section {
        display: none;
      }

      .inventory-content {
        padding: 1rem;
      }

      .stats-grid {
        grid-template-columns: 1fr;
      }

      .search-filters-grid {
        grid-template-columns: 1fr;
      }

      .metrics-grid {
        grid-template-columns: 1fr;
      }

      .charts-section {
        grid-template-columns: 1fr;
      }

      .report-controls {
        flex-direction: column;
        align-items: stretch;
      }

      .export-buttons {
        flex-direction: column;
      }

      .bulk-actions {
        flex-wrap: wrap;
      }

      .bulk-actions .btn {
        font-size: 0.75rem;
        padding: 0.5rem;
      }

      .alerts-panel {
        margin: 1rem;
      }

      .modal-content {
        width: 95%;
        margin: 1rem;
        max-height: 90vh;
      }

      .reports-modal {
        max-width: 100%;
        width: 100%;
        height: 100vh;
        max-height: 100vh;
        border-radius: 0;
      }

      .modal-body {
        padding: 1rem;
      }

      .table-container {
        overflow-x: auto;
      }

      .inventory-table,
      .report-table {
        font-size: 0.75rem;
      }

      .inventory-table th,
      .inventory-table td,
      .report-table th,
      .report-table td {
        padding: 0.5rem;
      }

      .action-buttons {
        flex-direction: column;
        gap: 0.25rem;
      }

      .action-btn {
        padding: 0.25rem;
        font-size: 0.875rem;
      }

      .real-time-indicator {
        top: 10px;
        left: 10px;
        right: 10px;
        padding: 0.375rem 0.75rem;
        font-size: 0.625rem;
      }

      .advanced-filters {
        padding: 1rem;
      }

      .filters-grid {
        grid-template-columns: 1fr;
      }

      .bulk-toolbar {
        flex-direction: column;
        gap: 1rem;
        align-items: stretch;
      }

      .bulk-info {
        text-align: center;
      }

      .scanner-container {
        padding: 1rem;
      }

      .scanner-viewport {
        height: 200px;
      }
    }

    /* Mobile Table Optimizations */
    .mobile-table {
      border: 0;
    }

    .mobile-table thead {
      display: none;
    }

    .mobile-table tbody,
    .mobile-table tr,
    .mobile-table td {
      display: block;
      width: 100%;
    }

    .mobile-table tr {
      margin-bottom: 1rem;
      border: 1px solid var(--color-border);
      border-radius: 8px;
      padding: 0.5rem;
    }

    .mobile-table td {
      text-align: left;
      padding: 0.25rem 0.5rem;
      border-bottom: 1px solid var(--color-border);
    }

    .mobile-table td:before {
      content: attr(data-label) ": ";
      font-weight: 600;
      color: var(--color-text-primary);
    }

    /* Touch-friendly mobile interactions */
    @media (hover: none) and (pointer: coarse) {
      .btn,
      .action-btn,
      .modal-close {
        min-height: 44px;
        min-width: 44px;
      }

      .form-group input,
      .form-group select,
      .form-group textarea {
        min-height: 44px;
        font-size: 16px; /* Prevent zoom on iOS */
      }
    }

    /* Small screen optimizations */
    @media (max-width: 480px) {
      .stats-grid {
        grid-template-columns: 1fr;
        gap: 0.75rem;
      }

      .metric-card {
        padding: 1rem;
      }

      .metric-icon {
        width: 40px;
        height: 40px;
        font-size: 1.25rem;
      }

      .metric-value {
        font-size: 1.25rem;
      }

      .search-filters-grid {
        grid-template-columns: 1fr;
        gap: 0.5rem;
      }

      .search-filters-grid .btn {
        padding: 0.75rem;
        font-size: 0.875rem;
      }
    }
  </style>
</head>
<body>
  <!-- Real-time Updates Indicator -->
  <div class="real-time-indicator" :class="realTimeConnected ? 'active' : ''">
    <div class="pulse"></div>
    <span>Live Updates</span>
  </div>

  <!-- Sidebar -->
  <aside class="sidebar" :class="sidebarOpen ? 'open' : ''">
    <div class="sidebar-header">
      <div class="logo-section">
        <div class="logo-icon">
          <span class="material-symbols-rounded">medication</span>
        </div>
        <div class="logo-text">Umi Health</div>
      </div>
    </div>

    <nav class="nav-menu">
      <a href="home.html" class="nav-item">
        <span class="material-symbols-rounded nav-icon">home</span>
        <span>Home</span>
      </a>
      <a href="point-of-sale.html" class="nav-item">
        <span class="material-symbols-rounded nav-icon">point_of_sale</span>
        <span>Point of Sale</span>
      </a>
      <a href="patients.html" class="nav-item">
        <span class="material-symbols-rounded nav-icon">people</span>
        <span>Patients</span>
      </a>
      <a href="sales.html" class="nav-item">
        <span class="material-symbols-rounded nav-icon">receipt_long</span>
        <span>Sales</span>
      </a>
      <a href="payments.html" class="nav-item">
        <span class="material-symbols-rounded nav-icon">payments</span>
        <span>Payments</span>
      </a>
    <a href="inventory.html" class="nav-item active">
        <span class="material-symbols-rounded nav-icon">inventory_2</span>
        <span>Inventory</span>
      </a>
      <a href="queue-management.html" class="nav-item">
        <span class="material-symbols-rounded nav-icon">queue</span>
        <span>Queue</span>
      </a>
      <a href="shift-management.html" class="nav-item">
        <span class="material-symbols-rounded nav-icon">schedule</span>
        <span>Shift Management</span>
      </a>
      <a href="reports.html" class="nav-item">
        <span class="material-symbols-rounded nav-icon">summarize</span>
        <span>Reports</span>
      </a>
      <a href="help.html" class="nav-item">
        <span class="material-symbols-rounded nav-icon">help</span>
        <span>Help & Training</span>
      </a>
      <a href="account.html" class="nav-item">
        <span class="material-symbols-rounded nav-icon">settings</span>
        <span>Account</span>
      </a>
    </nav>
    
    <div class="logout-section">
      <button class="logout-button" @click="logout()">
        <span class="material-symbols-rounded logout-icon">logout</span>
        <span>Logout</span>
      </button>
    </div>
  </aside>

  <!-- Main Content -->
  <main class="main-content">
    <!-- Header -->
    <header class="header">
      <div class="header-left">
        <button class="mobile-menu-toggle" @click="sidebarOpen = !sidebarOpen">
          <span class="material-symbols-rounded">menu</span>
        </button>
        
        <div class="page-title-section">
          <h1 class="page-title">Inventory Management</h1>
        </div>
      </div>

      <div class="header-right">
        <!-- User profile removed -->
      </div>
    </header>

    <!-- Inventory Content -->
    <div class="inventory-content">
      <!-- Stats Cards -->
      <div class="stats-grid">
        <div class="stat-card">
          <div class="stat-header">
            <h3 class="stat-title">Total Items</h3>
            <div class="stat-icon">
              <span class="material-symbols-rounded">inventory</span>
            </div>
          </div>
          <div class="stat-value" x-text="stats.totalItems.toLocaleString()"></div>
          <div class="stat-description">Total medicine items in inventory</div>
        </div>

        <div class="stat-card">
          <div class="stat-header">
            <h3 class="stat-title">Low Stock Items</h3>
            <div class="stat-icon">
              <span class="material-symbols-rounded">warning</span>
            </div>
          </div>
          <div class="stat-value" x-text="stats.lowStockItems.toLocaleString()"></div>
          <div class="stat-description">Items below reorder level</div>
        </div>

        <div class="stat-card">
          <div class="stat-header">
            <h3 class="stat-title">Out of Stock</h3>
            <div class="stat-icon">
              <span class="material-symbols-rounded">error</span>
            </div>
          </div>
          <div class="stat-value" x-text="stats.outOfStockItems.toLocaleString()"></div>
          <div class="stat-description">Items completely out of stock</div>
        </div>

        <div class="stat-card">
          <div class="stat-header">
            <h3 class="stat-title">Total Value</h3>
            <div class="stat-icon">
              <span class="material-symbols-rounded">payments</span>
            </div>
          </div>
          <div class="stat-value" x-text="formatCurrency(stats.totalValue)"></div>
          <div class="stat-description">Total inventory value</div>
        </div>
      </div>

      <!-- Search and Filters -->
      <div class="controls-section">
        <div class="search-filters-grid">
          <div class="search-group">
            <label class="search-label" for="searchInput">Search Medicine</label>
            <input type="text" id="searchInput" class="search-input" x-model="searchQuery" placeholder="Search by name, category, or barcode...">
          </div>
          <button class="btn btn-secondary" @click="toggleAdvancedFilters">
            <span class="material-symbols-rounded">filter_list</span>
            <span x-text="showAdvancedFilters ? 'Hide Filters' : 'Advanced Filters'"></span>
          </button>
          <button class="btn btn-secondary" @click="toggleReportsModal">
            <span class="material-symbols-rounded">analytics</span>
            <span>Reports</span>
          </button>
          <button class="btn btn-secondary" @click="resetSearch">
            <span class="material-symbols-rounded">refresh</span>
            <span>Reset</span>
          </button>
          <button class="btn btn-secondary" @click="syncInventory" title="Sync with Pharmacy">
            <span class="material-symbols-rounded">sync</span>
            <span>Sync</span>
          </button>
          <button class="btn btn-success" @click="openAddModal">
            <span class="material-symbols-rounded">add</span>
            <span>Add Item</span>
          </button>
        </div>
      </div>

      <!-- Advanced Filters -->
      <div x-show="showAdvancedFilters" class="advanced-filters">
        <div class="filters-header">
          <h3>Advanced Filters</h3>
          <button class="btn btn-secondary btn-sm" @click="clearFilters">Clear Filters</button>
        </div>
        <div class="filters-grid">
          <div class="filter-group">
            <label>Category</label>
            <select x-model="advancedFilters.category">
              <option value="">All Categories</option>
              <option value="Antibiotics">Antibiotics</option>
              <option value="Analgesics">Analgesics</option>
              <option value="Antimalarials">Antimalarials</option>
              <option value="Antihypertensives">Antihypertensives</option>
              <option value="Diabetes">Diabetes</option>
              <option value="Vitamins & Supplements">Vitamins & Supplements</option>
              <option value="OTC">OTC</option>
              <option value="Community Health">Community Health</option>
              <option value="Endocrinology">Endocrinology</option>
            </select>
          </div>
          <div class="filter-group">
            <label>Form</label>
            <select x-model="advancedFilters.form">
              <option value="">All Forms</option>
              <option value="Tablet">Tablet</option>
              <option value="Capsule">Capsule</option>
              <option value="Syrup">Syrup</option>
              <option value="Injection">Injection</option>
              <option value="Ointment">Ointment</option>
              <option value="Cream">Cream</option>
              <option value="Drops">Drops</option>
              <option value="Inhaler">Inhaler</option>
              <option value="Suppository">Suppository</option>
            </select>
          </div>
          <div class="filter-group">
            <label>Stock Status</label>
            <select x-model="advancedFilters.stockStatus">
              <option value="">All Status</option>
              <option value="in-stock">In Stock</option>
              <option value="low-stock">Low Stock</option>
              <option value="out-of-stock">Out of Stock</option>
            </select>
          </div>
          <div class="filter-group">
            <label>Expiry Status</label>
            <select x-model="advancedFilters.expiryStatus">
              <option value="">All Items</option>
              <option value="expired">Expired</option>
              <option value="expiring-soon">Expiring Soon (30 days)</option>
              <option value="critical">Critical (7 days)</option>
            </select>
          </div>
          <div class="filter-group">
            <label>Supplier</label>
            <input type="text" x-model="advancedFilters.supplier" placeholder="Filter by supplier">
          </div>
          <div class="filter-group">
            <label>Price Range (K)</label>
            <div style="display: flex; gap: 0.5rem;">
              <input type="number" x-model="advancedFilters.minPrice" placeholder="Min" style="flex: 1;">
              <input type="number" x-model="advancedFilters.maxPrice" placeholder="Max" style="flex: 1;">
            </div>
          </div>
        </div>
      </div>

      <!-- Inventory Table -->
      <div class="inventory-section">
        <div class="section-header">
          <h2 class="section-title">Medicine Inventory</h2>
          <div class="action-buttons">
            <button class="btn btn-secondary" @click="toggleBulkMode" :class="bulkMode ? 'btn-primary' : ''">
              <span class="material-symbols-rounded">checklist</span>
              <span x-text="bulkMode ? 'Exit Bulk Mode' : 'Bulk Operations'"></span>
            </button>
            <button class="action-btn" @click="exportInventory" title="Export">
              <span class="material-symbols-rounded">download</span>
            </button>
            <button class="action-btn" @click="importInventory" title="Import">
              <span class="material-symbols-rounded">upload</span>
            </button>
            <button class="action-btn" @click="refreshInventory" title="Refresh">
              <span class="material-symbols-rounded">refresh</span>
            </button>
          </div>
        </div>

        <!-- Bulk Operations Toolbar -->
        <div x-show="bulkMode" class="bulk-toolbar">
          <div class="bulk-info">
            <span x-text="selectedItems.length + ' items selected'"></span>
          </div>
          <div class="bulk-actions">
            <button class="btn btn-secondary btn-sm" @click="selectAllItems" :disabled="selectedItems.length === inventory.length">
              Select All
            </button>
            <button class="btn btn-secondary btn-sm" @click="clearSelection" :disabled="selectedItems.length === 0">
              Clear Selection
            </button>
            <button class="btn btn-primary btn-sm" @click="bulkEdit" :disabled="selectedItems.length === 0">
              <span class="material-symbols-rounded">edit</span>
              Edit Selected
            </button>
            <button class="btn btn-success btn-sm" @click="bulkAdjustStock" :disabled="selectedItems.length === 0">
              <span class="material-symbols-rounded">add_shopping_cart</span>
              Adjust Stock
            </button>
            <button class="btn btn-warning btn-sm" @click="bulkDelete" :disabled="selectedItems.length === 0">
              <span class="material-symbols-rounded">delete</span>
              Delete
            </button>
          </div>
        </div>

        <!-- Loading State -->
        <div x-show="loading.inventory" class="loading-state">
          <div class="loading-spinner"></div>
          <p>Loading inventory data...</p>
        </div>
        
        <!-- Inventory Table -->
        <div x-show="!loading.inventory">
          <div class="table-container">
            <table class="inventory-table">
              <thead>
                <tr>
                  <th x-show="bulkMode" style="width: 50px;">
                    <input type="checkbox" @change="toggleSelectAll($event)" :checked="selectedItems.length === inventory.length && inventory.length > 0">
                  </th>
                  <th>Brand Name</th>
                  <th>Generic Name</th>
                  <th>Strength</th>
                  <th>Form</th>
                  <th>Category</th>
                  <th>Stock Quantity</th>
                  <th>Low Stock Threshold</th>
                  <th>Selling Price</th>
                  <th>Status</th>
                  <th>Actions</th>
                </tr>
              </thead>
              <tbody>
                <template x-for="item in filteredInventory" :key="item.id">
                  <tr :class="selectedItems.includes(item.id) ? 'selected-row' : ''">
                    <td x-show="bulkMode">
                      <input type="checkbox" :checked="selectedItems.includes(item.id)" @change="toggleItemSelection(item.id, $event)">
                    </td>
                    <td x-text="item.brandName"></td>
                    <td x-text="item.genericName"></td>
                    <td x-text="item.strength || '-'"></td>
                    <td x-text="item.form"></td>
                    <td x-text="item.category"></td>
                    <td x-text="item.stockQuantity"></td>
                    <td x-text="item.lowStockThreshold"></td>
                    <td x-text="formatCurrency(item.sellingPrice)"></td>
                    <td>
                      <span class="stock-badge" :class="getStockClass(item)" x-text="getStockStatus(item)"></span>
                    </td>
                    <td>
                      <div class="action-buttons">
                        <button class="action-btn" @click="editItem(item)" title="Edit">
                          <span class="material-symbols-rounded">edit</span>
                        </button>
                        <button class="action-btn" @click="openStockAdjustment(item)" title="Adjust Stock">
                          <span class="material-symbols-rounded">add_shopping_cart</span>
                        </button>
                        <button class="action-btn" @click="viewHistory(item)" title="History">
                          <span class="material-symbols-rounded">history</span>
                        </button>
                      </div>
                    </td>
                  </tr>
                </template>
              </tbody>
            </table>
          </div>
        </div>
      </div>
    </div>

    <!-- Low Stock Alerts Panel -->
    <div x-show="lowStockItems.length > 0" class="alerts-panel">
      <div class="alerts-header">
        <h3>
          <span class="material-symbols-rounded">warning</span>
          Low Stock Alerts
          <span class="alert-count" x-text="lowStockItems.length"></span>
        </h3>
        <button class="btn btn-secondary" @click="dismissAllAlerts">
          <span class="material-symbols-rounded">close</span>
          Dismiss All
        </button>
      </div>
      <div class="alerts-list">
        <template x-for="item in lowStockItems" :key="item.id">
          <div class="alert-item low-stock">
            <div class="alert-content">
              <h4 x-text="item.brandName + ' - ' + item.genericName"></h4>
              <p>
                Current stock: <strong x-text="item.stockQuantity"></strong> | 
                Reorder at: <strong x-text="item.lowStockThreshold"></strong> | 
                Category: <span x-text="item.category"></span>
              </p>
            </div>
            <div class="alert-actions">
              <button class="btn btn-primary btn-sm" @click="quickReorder(item)">
                <span class="material-symbols-rounded">add_shopping_cart</span>
                Reorder
              </button>
              <button class="btn btn-secondary btn-sm" @click="dismissAlert(item.id)">
                <span class="material-symbols-rounded">close</span>
              </button>
            </div>
          </div>
        </template>
      </div>
    </div>

    <!-- Expiry Alerts Panel -->
    <div x-show="expiringItems.length > 0" class="alerts-panel expiry">
      <div class="alerts-header">
        <h3>
          <span class="material-symbols-rounded">schedule</span>
          Expiry Alerts
          <span class="alert-count" x-text="expiringItems.length"></span>
        </h3>
        <button class="btn btn-secondary" @click="dismissAllExpiryAlerts">
          <span class="material-symbols-rounded">close</span>
          Dismiss All
        </button>
      </div>
      <div class="alerts-list">
        <template x-for="item in expiringItems" :key="item.id">
          <div class="alert-item" :class="getExpiryAlertClass(item)">
            <div class="alert-content">
              <h4 x-text="item.brandName + ' - ' + item.genericName"></h4>
              <p>
                Expires: <strong x-text="formatDate(item.expiryDate)"></strong> | 
                Days left: <strong x-text="getDaysUntilExpiry(item.expiryDate)"></strong> | 
                Batch: <span x-text="item.batchNumber"></span>
              </p>
            </div>
            <div class="alert-actions">
              <button class="btn btn-warning btn-sm" @click="markForDiscount(item)">
                <span class="material-symbols-rounded">sell</span>
                Discount
              </button>
              <button class="btn btn-secondary btn-sm" @click="dismissExpiryAlert(item.id)">
                <span class="material-symbols-rounded">close</span>
              </button>
            </div>
          </div>
        </template>
      </div>
    </div>

  </main>

  <!-- Add/Edit Item Modal -->
  <div x-show="showAddModal" class="modal-overlay" @click.self="showAddModal = false">
    <div class="modal-content">
      <div class="modal-header">
        <h3 x-text="editingItem ? 'Edit Item' : 'Add New Item'"></h3>
        <button class="modal-close" @click="showAddModal = false">
          <span class="material-symbols-rounded">close</span>
        </button>
      </div>
      <div class="modal-body">
        <form @submit.prevent="saveItem">
          <div class="form-grid">
            <div class="form-group">
              <label>Brand Name *</label>
              <input type="text" x-model="itemForm.brandName" required>
            </div>
            <div class="form-group">
              <label>Generic Name *</label>
              <input type="text" x-model="itemForm.genericName" required>
            </div>
            <div class="form-group">
              <label>Strength</label>
              <input type="text" x-model="itemForm.strength" placeholder="e.g., 500mg">
            </div>
            <div class="form-group">
              <label>Form *</label>
              <select x-model="itemForm.form" required>
                <option value="">Select form</option>
                <option value="Tablet">Tablet</option>
                <option value="Capsule">Capsule</option>
                <option value="Syrup">Syrup</option>
                <option value="Injection">Injection</option>
                <option value="Ointment">Ointment</option>
                <option value="Cream">Cream</option>
                <option value="Drops">Drops</option>
                <option value="Inhaler">Inhaler</option>
                <option value="Suppository">Suppository</option>
              </select>
            </div>
            <div class="form-group">
              <label>Category *</label>
              <select x-model="itemForm.category" required>
                <option value="">Select category</option>
                <option value="Antibiotics">Antibiotics</option>
                <option value="Analgesics">Analgesics</option>
                <option value="Antimalarials">Antimalarials</option>
                <option value="Antihypertensives">Antihypertensives</option>
                <option value="Diabetes">Diabetes</option>
                <option value="Vitamins & Supplements">Vitamins & Supplements</option>
                <option value="OTC">OTC</option>
                <option value="Community Health">Community Health</option>
                <option value="Endocrinology">Endocrinology</option>
              </select>
            </div>
            <div class="form-group">
              <label>Unit Size</label>
              <input type="text" x-model="itemForm.unitSize" placeholder="e.g., 10s, 100ml">
            </div>
            <div class="form-group">
              <label>Supplier</label>
              <input type="text" x-model="itemForm.supplier">
            </div>
            <div class="form-group">
              <label>Low Stock Threshold *</label>
              <input type="number" x-model="itemForm.lowStockThreshold" min="0" required>
            </div>
            <div class="form-group">
              <label>Manufacture Date *</label>
              <input type="date" x-model="itemForm.manufactureDate" required>
            </div>
            <div class="form-group">
              <label>Batch Number *</label>
              <input type="text" x-model="itemForm.batchNumber" required>
            </div>
            <div class="form-group">
              <label>License Number *</label>
              <input type="text" x-model="itemForm.licenseNumber" required>
            </div>
            <div class="form-group">
              <label>Zambia REG Number *</label>
              <input type="text" x-model="itemForm.zambiaRegNumber" required>
            </div>
            <div class="form-group">
              <label>Packing Type *</label>
              <select x-model="itemForm.packingType" required>
                <option value="">Select packing type</option>
                <option value="Box">Box</option>
                <option value="Blister">Blister</option>
                <option value="Bottle">Bottle</option>
                <option value="Tube">Tube</option>
                <option value="Sachet">Sachet</option>
                <option value="Vial">Vial</option>
                <option value="Ampoule">Ampoule</option>
              </select>
            </div>
            <div class="form-group">
              <label>Barcode</label>
              <div class="barcode-input-group">
                <input type="text" x-model="itemForm.barcode" placeholder="Scan or enter barcode">
                <button type="button" class="btn btn-secondary scan-btn" @click="scanBarcode">
                  <span class="material-symbols-rounded">qr_code_scanner</span>
                  <span>Scan</span>
                </button>
              </div>
            </div>
            <div class="form-group">
              <label>Cost Price (K) *</label>
              <input type="number" x-model="itemForm.costPrice" min="0" step="0.01" required>
            </div>
            <div class="form-group">
              <label>Selling Price (K) *</label>
              <input type="number" x-model="itemForm.sellingPrice" min="0" step="0.01" required>
            </div>
            <div class="form-group">
              <label>Stock Quantity *</label>
              <input type="number" x-model="itemForm.stockQuantity" min="0" required>
            </div>
            <div class="form-group">
              <label>Expiry Date *</label>
              <input type="date" x-model="itemForm.expiryDate" required>
            </div>
          </div>
          <div class="form-group full-width">
            <label>Description</label>
            <textarea x-model="itemForm.description" rows="3" placeholder="Add optional notes about the product"></textarea>
          </div>
          <div class="modal-actions">
            <button type="button" class="btn btn-secondary" @click="showAddModal = false">Cancel</button>
            <button type="submit" class="btn btn-primary" x-text="editingItem ? 'Update' : 'Add'"></button>
          </div>
        </form>
      </div>
    </div>
  </div>

  <!-- Stock Adjustment Modal -->
  <div x-show="showStockModal" class="modal-overlay" @click.self="showStockModal = false">
    <div class="modal-content">
      <div class="modal-header">
        <h3>Adjust Stock - <span x-text="adjustingItem?.medicineName"></span></h3>
        <button class="modal-close" @click="showStockModal = false">
          <span class="material-symbols-rounded">close</span>
        </button>
      </div>
      <div class="modal-body">
        <form @submit.prevent="saveStockAdjustment">
          <div class="form-grid">
            <div class="form-group">
              <label>Adjustment Type *</label>
              <select x-model="stockForm.adjustmentType" required>
                <option value="add">Add Stock</option>
                <option value="remove">Remove Stock</option>
                <option value="set">Set Stock Level</option>
              </select>
            </div>
            <div class="form-group">
              <label>Quantity *</label>
              <input type="number" x-model="stockForm.quantity" required>
            </div>
            <div class="form-group">
              <label>Reason *</label>
              <select x-model="stockForm.reason" required>
                <option value="">Select Reason</option>
                <option value="purchase">New Purchase</option>
                <option value="return">Customer Return</option>
                <option value="damage">Damaged/Lost</option>
                <option value="expiry">Expired</option>
                <option value="adjustment">Stock Adjustment</option>
                <option value="transfer">Stock Transfer</option>
              </select>
            </div>
            <div class="form-group full-width">
              <label>Notes</label>
              <textarea x-model="stockForm.notes" rows="3" placeholder="Additional notes..."></textarea>
            </div>
          </div>
          <div class="modal-actions">
            <button type="button" class="btn btn-secondary" @click="showStockModal = false">Cancel</button>
            <button type="submit" class="btn btn-primary">Adjust Stock</button>
          </div>
        </form>
      </div>
    </div>
  </div>

  <!-- History Modal -->
  <div x-show="showHistoryModal" class="modal-overlay" @click.self="showHistoryModal = false">
    <div class="modal-content large">
      <div class="modal-header">
        <h3>Inventory History - <span x-text="historyItem?.medicineName"></span></h3>
        <button class="modal-close" @click="showHistoryModal = false">
          <span class="material-symbols-rounded">close</span>
        </button>
      </div>
      <div class="modal-body">
        <div x-show="loading.history" class="loading-state">
          <div class="loading-spinner"></div>
          <p>Loading history...</p>
        </div>
        
        <div x-show="!loading.history">
          <div class="history-table-container">
            <table class="history-table">
              <thead>
                <tr>
                  <th>Date</th>
                  <th>Action</th>
                  <th>Quantity</th>
                  <th>Reason</th>
                  <th>User</th>
                  <th>Notes</th>
                </tr>
              </thead>
              <tbody>
                <template x-for="record in itemHistory" :key="record.id">
                  <tr>
                    <td x-text="new Date(record.date).toLocaleString()"></td>
                    <td>
                      <span class="action-badge" :class="record.action.toLowerCase()" x-text="record.action"></span>
                    </td>
                    <td x-text="record.quantity"></td>
                    <td x-text="record.reason || '-'"></td>
                    <td x-text="record.user || '-'"></td>
                    <td x-text="record.notes || '-'"></td>
                  </tr>
                </template>
                <tr x-show="itemHistory.length === 0">
                  <td colspan="6" style="text-align: center; padding: 2rem;">No history records found</td>
                </tr>
              </tbody>
            </table>
          </div>
        </div>
        
        <div class="modal-actions">
          <button type="button" class="btn btn-secondary" @click="showHistoryModal = false">Close</button>
        </div>
      </div>
    </div>
  </div>

  <!-- Barcode Scanner Modal -->
  <div x-show="showBarcodeScanner" class="modal-overlay" @click.self="closeBarcodeScanner">
    <div class="modal-content barcode-scanner">
      <div class="modal-header">
        <h3>Scan Barcode</h3>
        <button class="modal-close" @click="closeBarcodeScanner">
          <span class="material-symbols-rounded">close</span>
        </button>
      </div>
      <div class="modal-body">
        <div class="scanner-container">
          <div class="scanner-viewport">
            <video x-ref="scannerVideo" autoplay playsinline></video>
            <div class="scanner-overlay">
              <div class="scan-line"></div>
              <div class="scan-corners"></div>
            </div>
          </div>
          <div class="scanner-controls">
            <button type="button" class="btn btn-secondary" @click="closeBarcodeScanner">Cancel</button>
            <button type="button" class="btn btn-primary" @click="simulateBarcodeScan">Simulate Scan</button>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Reports Dashboard Modal -->
  <div x-show="showReportsModal" class="modal-overlay" @click.self="showReportsModal = false">
    <div class="modal-content reports-modal">
      <div class="modal-header">
        <h3>Inventory Reports Dashboard</h3>
        <button class="modal-close" @click="showReportsModal = false">
          <span class="material-symbols-rounded">close</span>
        </button>
      </div>
      <div class="modal-body">
        <!-- Report Period Selection -->
        <div class="report-controls">
          <div class="control-group">
            <label>Report Period</label>
            <select x-model="reportFilters.period" @change="loadReportData">
              <option value="7">Last 7 Days</option>
              <option value="30">Last 30 Days</option>
              <option value="90">Last 3 Months</option>
              <option value="365">Last Year</option>
              <option value="custom">Custom Range</option>
            </select>
          </div>
          <div class="control-group" x-show="reportFilters.period === 'custom'">
            <label>Custom Range</label>
            <div style="display: flex; gap: 0.5rem;">
              <input type="date" x-model="reportFilters.startDate">
              <input type="date" x-model="reportFilters.endDate">
            </div>
          </div>
          <button class="btn btn-primary" @click="loadReportData">
            <span class="material-symbols-rounded">refresh</span>
            Refresh
          </button>
        </div>

        <!-- Key Metrics -->
        <div class="metrics-grid">
          <div class="metric-card">
            <div class="metric-icon">
              <span class="material-symbols-rounded">trending_up</span>
            </div>
            <div class="metric-content">
              <h4>Total Sales</h4>
              <p class="metric-value" x-text="formatCurrency(reportData.totalSales)"></p>
              <span class="metric-change positive" x-text="'+12.5%'"></span>
            </div>
          </div>
          <div class="metric-card">
            <div class="metric-icon">
              <span class="material-symbols-rounded">inventory</span>
            </div>
            <div class="metric-content">
              <h4>Items Sold</h4>
              <p class="metric-value" x-text="reportData.itemsSold.toLocaleString()"></p>
              <span class="metric-change positive" x-text="'+8.3%'"></span>
            </div>
          </div>
          <div class="metric-card">
            <div class="metric-icon">
              <span class="material-symbols-rounded">category</span>
            </div>
            <div class="metric-content">
              <h4>Top Category</h4>
              <p class="metric-value" x-text="reportData.topCategory"></p>
              <span class="metric-change" x-text="reportData.topCategorySales + ' sales'"></span>
            </div>
          </div>
          <div class="metric-card">
            <div class="metric-icon">
              <span class="material-symbols-rounded">speed</span>
            </div>
            <div class="metric-content">
              <h4>Avg. Turnover</h4>
              <p class="metric-value" x-text="reportData.avgTurnover + ' days'"></p>
              <span class="metric-change negative" x-text="'-2.1 days'"></span>
            </div>
          </div>
        </div>

        <!-- Charts Section -->
        <div class="charts-section">
          <div class="chart-container">
            <h4>Sales Trend</h4>
            <div class="chart-placeholder">
              <canvas x-ref="salesChart"></canvas>
            </div>
          </div>
          <div class="chart-container">
            <h4>Category Distribution</h4>
            <div class="chart-placeholder">
              <canvas x-ref="categoryChart"></canvas>
            </div>
          </div>
        </div>

        <!-- Top Products Table -->
        <div class="top-products-section">
          <h4>Top Selling Products</h4>
          <div class="table-container">
            <table class="report-table">
              <thead>
                <tr>
                  <th>Product</th>
                  <th>Category</th>
                  <th>Units Sold</th>
                  <th>Revenue</th>
                  <th>Growth</th>
                </tr>
              </thead>
              <tbody>
                <template x-for="product in reportData.topProducts" :key="product.id">
                  <tr>
                    <td x-text="product.name"></td>
                    <td x-text="product.category"></td>
                    <td x-text="product.unitsSold.toLocaleString()"></td>
                    <td x-text="formatCurrency(product.revenue)"></td>
                    <td>
                      <span class="metric-change" :class="product.growth >= 0 ? 'positive' : 'negative'" 
                            x-text="(product.growth >= 0 ? '+' : '') + product.growth + '%'"></span>
                    </td>
                  </tr>
                </template>
              </tbody>
            </table>
          </div>
        </div>

        <!-- Export Options -->
        <div class="export-section">
          <h4>Export Reports</h4>
          <div class="export-buttons">
            <button class="btn btn-secondary" @click="exportReport('pdf')">
              <span class="material-symbols-rounded">picture_as_pdf</span>
              Export PDF
            </button>
            <button class="btn btn-secondary" @click="exportReport('excel')">
              <span class="material-symbols-rounded">table_chart</span>
              Export Excel
            </button>
            <button class="btn btn-secondary" @click="exportReport('csv')">
              <span class="material-symbols-rounded">csv</span>
              Export CSV
            </button>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Alpine.js Component -->
  <script>
    function inventorySystem() {
      return {
        sidebarOpen: false,
        tenantId: null,
        branchId: null,
        userInfo: {
          name: '',
          role: 'Cashier',
          initials: ''
        },
        searchQuery: '',
        inventory: [],
        stats: {
          totalItems: 0,
          lowStockItems: 0,
          outOfStockItems: 0,
          totalValue: 0
        },
        loading: {
          inventory: true,
          history: false
        },
        showAddModal: false,
        showStockModal: false,
        showHistoryModal: false,
        showBarcodeScanner: false,
        showBulkEditModal: false,
        showBulkStockModal: false,
        showReportsModal: false,
        realTimeConnected: false,
        websocket: null,
        editingItem: null,
        adjustingItem: null,
        historyItem: null,
        scannerStream: null,
        lowStockItems: [],
        expiringItems: [],
        dismissedAlerts: [],
        notificationSettings: {
          lowStock: true,
          expiry: true,
          sound: true
        },
        bulkMode: false,
        selectedItems: [],
        showAdvancedFilters: false,
        advancedFilters: {
          category: '',
          form: '',
          stockStatus: '',
          expiryStatus: '',
          supplier: '',
          minPrice: '',
          maxPrice: ''
        },
        itemForm: {
          brandName: '',
          genericName: '',
          strength: '',
          form: '',
          category: '',
          unitSize: '',
          supplier: '',
          lowStockThreshold: '',
          manufactureDate: '',
          batchNumber: '',
          licenseNumber: '',
          zambiaRegNumber: '',
          packingType: '',
          barcode: '',
          costPrice: '',
          sellingPrice: '',
          stockQuantity: '',
          expiryDate: '',
          description: ''
        },
        stockForm: {
          adjustmentType: 'add',
          quantity: '',
          reason: '',
          notes: ''
        },
        bulkEditForm: {
          field: '',
          value: '',
          applyToAll: false
        },
        bulkStockForm: {
          adjustmentType: 'add',
          quantity: '',
          reason: '',
          notes: ''
        },
        reportData: {
          totalSales: 0,
          itemsSold: 0,
          topCategory: '',
          topCategorySales: 0,
          avgTurnover: 0,
          topProducts: []
        },
        reportFilters: {
          period: '30',
          startDate: '',
          endDate: ''
        },
        itemHistory: [],

        get filteredInventory() {
          let filtered = this.inventory;
          
          // Basic search
          if (this.searchQuery) {
            const query = this.searchQuery.toLowerCase();
            filtered = filtered.filter(item => 
              item.brandName?.toLowerCase().includes(query) ||
              item.genericName?.toLowerCase().includes(query) ||
              item.category?.toLowerCase().includes(query) ||
              item.strength?.toLowerCase().includes(query) ||
              item.form?.toLowerCase().includes(query) ||
              item.supplier?.toLowerCase().includes(query) ||
              item.batchNumber?.toLowerCase().includes(query) ||
              item.barcode?.toLowerCase().includes(query)
            );
          }
          
          // Advanced filters
          if (this.advancedFilters.category) {
            filtered = filtered.filter(item => item.category === this.advancedFilters.category);
          }
          
          if (this.advancedFilters.form) {
            filtered = filtered.filter(item => item.form === this.advancedFilters.form);
          }
          
          if (this.advancedFilters.stockStatus) {
            filtered = filtered.filter(item => {
              if (this.advancedFilters.stockStatus === 'in-stock') return item.stockQuantity > item.lowStockThreshold;
              if (this.advancedFilters.stockStatus === 'low-stock') return item.stockQuantity > 0 && item.stockQuantity <= item.lowStockThreshold;
              if (this.advancedFilters.stockStatus === 'out-of-stock') return item.stockQuantity === 0;
              return true;
            });
          }
          
          if (this.advancedFilters.expiryStatus) {
            filtered = filtered.filter(item => {
              if (!item.expiryDate) return false;
              const daysUntil = this.getDaysUntilExpiry(item.expiryDate);
              if (this.advancedFilters.expiryStatus === 'expired') return daysUntil < 0;
              if (this.advancedFilters.expiryStatus === 'expiring-soon') return daysUntil <= 30 && daysUntil >= 0;
              if (this.advancedFilters.expiryStatus === 'critical') return daysUntil <= 7 && daysUntil >= 0;
              return true;
            });
          }
          
          if (this.advancedFilters.supplier) {
            const supplierQuery = this.advancedFilters.supplier.toLowerCase();
            filtered = filtered.filter(item => 
              item.supplier?.toLowerCase().includes(supplierQuery)
            );
          }
          
          if (this.advancedFilters.minPrice) {
            filtered = filtered.filter(item => item.sellingPrice >= parseFloat(this.advancedFilters.minPrice));
          }
          
          if (this.advancedFilters.maxPrice) {
            filtered = filtered.filter(item => item.sellingPrice <= parseFloat(this.advancedFilters.maxPrice));
          }
          
          return filtered;
        },

        async init() {
          // Initialize tenant and branch info
          this.tenantId = window.cashierAPI.getTenantId();
          this.branchId = window.cashierAPI.branchId;
          
          await this.loadUserInfo();
          await this.loadInventory();
          
          // Initialize real-time updates
          this.initRealTimeUpdates();
          
          // Initialize mobile responsiveness
          this.initMobileResponsiveness();
        },

        // Reports Dashboard Functions
        toggleReportsModal() {
          this.showReportsModal = !this.showReportsModal;
          if (this.showReportsModal) {
            this.loadReportData();
          }
        },

        async loadReportData() {
          try {
            this.showNotification('Loading report data...', 'info');
            const reportData = await window.cashierAPI.getInventoryReport(this.reportFilters);
            this.reportData = reportData.data || reportData || {
              totalSales: 0,
              itemsSold: 0,
              topCategory: '',
              topCategorySales: 0,
              avgTurnover: 0,
              topProducts: []
            };
            this.showNotification('Report data loaded', 'success');
          } catch (error) {
            console.error('Report data error:', error);
            this.reportData = {
              totalSales: 0,
              itemsSold: 0,
              topCategory: '',
              topCategorySales: 0,
              avgTurnover: 0,
              topProducts: []
            };
            this.showNotification('Failed to load report data', 'error');
          }
        },

        async exportReport(format) {
          try {
            this.showNotification(`Exporting ${format.toUpperCase()} report...`, 'info');
            const blob = await window.cashierAPI.exportReport('inventory', format, this.reportFilters);
            const url = window.URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `inventory_report_${new Date().toISOString().split('T')[0]}.${format}`;
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            window.URL.revokeObjectURL(url);
            this.showNotification('Report exported successfully', 'success');
          } catch (error) {
            console.error('Export error:', error);
            this.showNotification('Failed to export report', 'error');
          }
        },

        // Real-time Updates Functions
        initRealTimeUpdates() {
          try {
            // Initialize WebSocket connection
            const wsUrl = `ws://localhost:5000/ws/inventory?tenantId=${this.tenantId}&branchId=${this.branchId}`;
            this.websocket = new WebSocket(wsUrl);
            
            this.websocket.onopen = () => {
              this.realTimeConnected = true;
              console.log('WebSocket connected');
            };
            
            this.websocket.onmessage = (event) => {
              const data = JSON.parse(event.data);
              this.handleRealTimeUpdate(data);
            };
            
            this.websocket.onclose = () => {
              this.realTimeConnected = false;
              console.log('WebSocket disconnected');
              // Attempt to reconnect after 5 seconds
              setTimeout(() => this.initRealTimeUpdates(), 5000);
            };
            
            this.websocket.onerror = (error) => {
              console.error('WebSocket error:', error);
              this.realTimeConnected = false;
            };
          } catch (error) {
            console.log('WebSocket not available, using polling');
            // Fallback to polling
            this.startPolling();
          }
        },

        handleRealTimeUpdate(data) {
          switch(data.type) {
            case 'inventory_update':
              this.updateInventoryItem(data.payload);
              break;
            case 'stock_adjustment':
              this.handleStockAdjustment(data.payload);
              break;
            case 'low_stock_alert':
              this.handleLowStockAlert(data.payload);
              break;
            case 'expiry_alert':
              this.handleExpiryAlert(data.payload);
              break;
          }
        },

        updateInventoryItem(item) {
          const index = this.inventory.findIndex(i => i.id === item.id);
          if (index !== -1) {
            this.inventory[index] = { ...this.inventory[index], ...item };
            this.calculateStats();
            this.showNotification(`${item.brandName} updated`, 'info');
          }
        },

        handleStockAdjustment(adjustment) {
          const item = this.inventory.find(i => i.id === adjustment.itemId);
          if (item) {
            item.stockQuantity = adjustment.newQuantity;
            this.calculateStats();
            this.showNotification(`Stock adjusted for ${item.brandName}`, 'info');
          }
        },

        startPolling() {
          // Fallback polling mechanism
          setInterval(async () => {
            if (!this.realTimeConnected) {
              await this.loadInventory();
            }
          }, 30000); // Poll every 30 seconds
        },

        // Mobile Responsiveness Functions
        initMobileResponsiveness() {
          this.checkMobileView();
          window.addEventListener('resize', this.checkMobileView.bind(this));
        },

        checkMobileView() {
          this.isMobile = window.innerWidth <= 768;
          if (this.isMobile) {
            this.optimizeForMobile();
          }
        },

        optimizeForMobile() {
          // Adjust table for mobile
          const tables = document.querySelectorAll('.inventory-table, .report-table');
          tables.forEach(table => {
            if (this.isMobile) {
              table.classList.add('mobile-table');
            } else {
              table.classList.remove('mobile-table');
            }
          });
        },

        // Enhanced Audit Trail Functions
        async getAuditTrail(itemId, filters = {}) {
          try {
            const params = new URLSearchParams({
              page: filters.page || 1,
              pageSize: filters.pageSize || 50,
              startDate: filters.startDate || '',
              endDate: filters.endDate || '',
              action: filters.action || '',
              userId: filters.userId || ''
            });
            return await window.cashierAPI.getAuditTrail(itemId, params);
          } catch (error) {
            console.error('Audit trail error:', error);
            return { data: [] };
          }
        },

        // Supplier Management Functions
        async getSuppliers() {
          try {
            return await window.cashierAPI.getSuppliers();
          } catch (error) {
            console.error('Suppliers error:', error);
            return { data: [] };
          }
        },

        async createSupplier(supplierData) {
          try {
            return await window.cashierAPI.createSupplier(supplierData);
          } catch (error) {
            console.error('Create supplier error:', error);
            throw error;
          }
        },

        // Inventory Forecasting Functions
        async getInventoryForecast(period = 30) {
          try {
            return await window.cashierAPI.getInventoryForecast(period);
          } catch (error) {
            console.error('Forecast error:', error);
            return {
              predictions: [],
              recommendations: []
            };
          }
        },

        async loadUserInfo() {
          try {
            const profile = await window.cashierAPI.getUserProfile();
            this.userInfo = {
              name: `${profile.firstName || ''} ${profile.lastName || ''}`.trim() || 'Cashier',
              role: 'Cashier',
              initials: this.getInitials(profile.firstName, profile.lastName)
            };
          } catch (error) {
            console.error('Error loading user info:', error);
            this.userInfo = {
              name: 'Cashier',
              role: 'Cashier',
              initials: 'C'
            };
          }
        },

        getInitials(firstName, lastName) {
          const first = firstName ? firstName.charAt(0).toUpperCase() : '';
          const last = lastName ? lastName.charAt(0).toUpperCase() : '';
          return (first + last) || 'C';
        },

        async loadInventory() {
          this.loading.inventory = true;
          try {
            // Load tenant-specific inventory with shared access
            const inventoryData = await window.cashierAPI.getSharedInventory();
            this.inventory = inventoryData.data || inventoryData || [];
            
            // Also try to sync with main pharmacy if needed
            if (this.tenantId && this.branchId) {
              try {
                await window.cashierAPI.syncTenantInventory(this.tenantId);
              } catch (syncError) {
                console.log('Sync failed, using cached data:', syncError);
              }
            }
            
            this.calculateStats();
          } catch (error) {
            console.error('Error loading inventory:', error);
            this.inventory = [];
            this.calculateStats();
          } finally {
            this.loading.inventory = false;
          }
        },

        calculateStats() {
          this.stats = {
            totalItems: this.inventory.length,
            lowStockItems: this.inventory.filter(item => item.stockQuantity > 0 && item.stockQuantity <= item.lowStockThreshold).length,
            outOfStockItems: this.inventory.filter(item => item.stockQuantity === 0).length,
            totalValue: this.inventory.reduce((sum, item) => sum + (item.stockQuantity * item.sellingPrice), 0)
          };
          
          // Check for alerts
          this.checkLowStockAlerts();
          this.checkExpiryAlerts();
        },

        checkLowStockAlerts() {
          this.lowStockItems = this.inventory.filter(item => 
            item.stockQuantity <= item.lowStockThreshold && 
            !this.dismissedAlerts.includes(`low-${item.id}`)
          );
          
          if (this.lowStockItems.length > 0 && this.notificationSettings.lowStock) {
            this.showNotification(`${this.lowStockItems.length} items are low on stock`, 'warning');
            if (this.notificationSettings.sound) {
              this.playAlertSound();
            }
          }
        },

        checkExpiryAlerts() {
          const today = new Date();
          const thirtyDaysFromNow = new Date(today.getTime() + (30 * 24 * 60 * 60 * 1000));
          
          this.expiringItems = this.inventory.filter(item => {
            if (!item.expiryDate) return false;
            const expiryDate = new Date(item.expiryDate);
            return expiryDate <= thirtyDaysFromNow && !this.dismissedAlerts.includes(`expiry-${item.id}`);
          });
          
          if (this.expiringItems.length > 0 && this.notificationSettings.expiry) {
            this.showNotification(`${this.expiringItems.length} items are expiring soon`, 'warning');
            if (this.notificationSettings.sound) {
              this.playAlertSound();
            }
          }
        },

        getDaysUntilExpiry(expiryDate) {
          const today = new Date();
          const expiry = new Date(expiryDate);
          const diffTime = expiry - today;
          const diffDays = Math.ceil(diffTime / (1000 * 60 * 60 * 24));
          return diffDays > 0 ? diffDays : 0;
        },

        getExpiryAlertClass(item) {
          const daysUntil = this.getDaysUntilExpiry(item.expiryDate);
          if (daysUntil <= 7) return 'critical';
          if (daysUntil <= 30) return 'warning';
          return 'info';
        },

        formatDate(date) {
          return new Date(date).toLocaleDateString('en-ZM');
        },

        dismissAlert(itemId) {
          this.dismissedAlerts.push(`low-${itemId}`);
          this.checkLowStockAlerts();
        },

        dismissExpiryAlert(itemId) {
          this.dismissedAlerts.push(`expiry-${itemId}`);
          this.checkExpiryAlerts();
        },

        dismissAllAlerts() {
          this.lowStockItems.forEach(item => {
            this.dismissedAlerts.push(`low-${item.id}`);
          });
          this.lowStockItems = [];
        },

        dismissAllExpiryAlerts() {
          this.expiringItems.forEach(item => {
            this.dismissedAlerts.push(`expiry-${item.id}`);
          });
          this.expiringItems = [];
        },

        quickReorder(item) {
          // Open stock adjustment modal with pre-filled data
          this.openStockAdjustment(item);
          this.stockForm.adjustmentType = 'add';
          this.stockForm.quantity = item.lowStockThreshold * 2 - item.stockQuantity;
          this.stockForm.reason = 'purchase';
          this.stockForm.notes = `Auto-reorder for low stock alert`;
        },

        markForDiscount(item) {
          // Create discount suggestion for expiring item
          const discountPercentage = this.getDaysUntilExpiry(item.expiryDate) <= 7 ? 50 : 25;
          this.showNotification(`${item.brandName} marked for ${discountPercentage}% discount`, 'info');
          
          // Here you could integrate with a discount system
          console.log('Mark for discount:', {
            item: item,
            discountPercentage: discountPercentage,
            reason: 'Expiring soon'
          });
        },

        playAlertSound() {
          // Play a notification sound
          const audio = new Audio('data:audio/wav;base64,UklGRnoGAABXQVZFZm10IBAAAAABAAEAQB8AAEAfAAABAAgAZGF0YQoGAACBhYqFbF1fdJivrJBhNjVgodDbq2EcBj+a2/LDciUFLIHO8tiJNwgZaLvt559NEAxQp+PwtmMcBjiR1/LMeSwFJHfH8N2QQAoUXrTp66hVFApGn+DyvmwhBSuBzvLZiTYIG2m98OScTgwOUarm7blmGgU7k9n1unEiBC13yO/eizEIHWq+8+OWT');
          audio.volume = 0.3;
          audio.play().catch(() => {});
        },

        // Bulk Operations Functions
        toggleBulkMode() {
          this.bulkMode = !this.bulkMode;
          if (!this.bulkMode) {
            this.selectedItems = [];
          }
        },

        toggleSelectAll(event) {
          if (event.target.checked) {
            this.selectedItems = this.inventory.map(item => item.id);
          } else {
            this.selectedItems = [];
          }
        },

        toggleItemSelection(itemId, event) {
          if (event.target.checked) {
            if (!this.selectedItems.includes(itemId)) {
              this.selectedItems.push(itemId);
            }
          } else {
            const index = this.selectedItems.indexOf(itemId);
            if (index > -1) {
              this.selectedItems.splice(index, 1);
            }
          }
        },

        selectAllItems() {
          this.selectedItems = this.inventory.map(item => item.id);
        },

        clearSelection() {
          this.selectedItems = [];
        },

        async bulkEdit() {
          if (this.selectedItems.length === 0) return;
          
          this.showBulkEditModal = true;
          this.bulkEditForm = {
            field: '',
            value: '',
            applyToAll: false
          };
        },

        async bulkAdjustStock() {
          if (this.selectedItems.length === 0) return;
          
          this.showBulkStockModal = true;
          this.bulkStockForm = {
            adjustmentType: 'add',
            quantity: '',
            reason: '',
            notes: ''
          };
        },

        async bulkDelete() {
          if (this.selectedItems.length === 0) return;
          
          const count = this.selectedItems.length;
          if (!confirm(`Are you sure you want to delete ${count} item${count > 1 ? 's' : ''}? This action cannot be undone.`)) {
            return;
          }

          try {
            for (const itemId of this.selectedItems) {
              await window.cashierAPI.deleteInventoryItem(itemId);
            }
            this.showNotification(`${count} item${count > 1 ? 's' : ''} deleted successfully`, 'success');
            this.selectedItems = [];
            this.loadInventory();
          } catch (error) {
            console.error('Bulk delete error:', error);
            this.showNotification('Failed to delete items', 'error');
          }
        },

        async importInventory() {
          const input = document.createElement('input');
          input.type = 'file';
          input.accept = '.csv';
          input.onchange = async (event) => {
            const file = event.target.files[0];
            if (file) {
              try {
                this.showNotification('Importing inventory...', 'info');
                const result = await window.cashierAPI.importInventoryCSV(file);
                this.showNotification(`Successfully imported ${result.imported || 0} items`, 'success');
                this.loadInventory();
              } catch (error) {
                console.error('Import error:', error);
                this.showNotification('Failed to import inventory', 'error');
              }
            }
          };
          input.click();
        },

        getStockClass(item) {
          if (item.stockQuantity === 0) return 'out-of-stock';
          if (item.stockQuantity <= item.lowStockThreshold) return 'low-stock';
          return 'in-stock';
        },

        getStockStatus(item) {
          if (item.stockQuantity === 0) return 'Out of Stock';
          if (item.stockQuantity <= item.lowStockThreshold) return 'Low Stock';
          return 'In Stock';
        },

        formatCurrency(amount) {
          return new Intl.NumberFormat('en-ZM', {
            style: 'currency',
            currency: 'ZMW'
          }).format(amount).replace('ZMW', 'K');
        },

        resetSearch() {
          this.searchQuery = '';
          this.clearFilters();
        },

        toggleAdvancedFilters() {
          this.showAdvancedFilters = !this.showAdvancedFilters;
        },

        clearFilters() {
          this.advancedFilters = {
            category: '',
            form: '',
            stockStatus: '',
            expiryStatus: '',
            supplier: '',
            minPrice: '',
            maxPrice: ''
          };
        },

        refreshInventory() {
          this.loadInventory();
        },

        async syncInventory() {
          try {
            this.showNotification('Syncing inventory with pharmacy...', 'info');
            await window.cashierAPI.syncTenantInventory(this.tenantId);
            await this.loadInventory();
            this.showNotification('Inventory synced successfully', 'success');
          } catch (error) {
            console.error('Sync error:', error);
            this.showNotification('Failed to sync inventory', 'error');
          }
        },

        exportInventory() {
          this.exportToCSV();
        },

        async exportToCSV() {
          try {
            const blob = await window.cashierAPI.exportInventoryCSV();
            const url = window.URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `inventory_export_${new Date().toISOString().split('T')[0]}.csv`;
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            window.URL.revokeObjectURL(url);
            this.showNotification('Inventory exported successfully', 'success');
          } catch (error) {
            console.error('Export error:', error);
            this.showNotification('Failed to export inventory', 'error');
          }
        },

        openAddModal() {
          this.showAddModal = true;
          this.resetItemForm();
        },

        resetItemForm() {
          this.itemForm = {
            brandName: '',
            genericName: '',
            strength: '',
            form: '',
            category: '',
            unitSize: '',
            supplier: '',
            lowStockThreshold: '',
            manufactureDate: '',
            batchNumber: '',
            licenseNumber: '',
            zambiaRegNumber: '',
            packingType: '',
            barcode: '',
            costPrice: '',
            sellingPrice: '',
            stockQuantity: '',
            expiryDate: '',
            description: ''
          };
        },

        async saveItem() {
          try {
            if (this.editingItem) {
              await window.cashierAPI.updateInventoryItem(this.editingItem.id, this.itemForm);
              this.showNotification('Item updated successfully', 'success');
            } else {
              await window.cashierAPI.createInventoryItem(this.itemForm);
              this.showNotification('Item added successfully', 'success');
            }
            this.showAddModal = false;
            this.editingItem = null;
            this.loadInventory();
          } catch (error) {
            console.error('Save error:', error);
            this.showNotification('Failed to save item', 'error');
          }
        },

        editItem(item) {
          this.editingItem = item;
          this.itemForm = { ...item };
          this.showAddModal = true;
        },

        async deleteItem(item) {
          if (confirm(`Are you sure you want to delete ${item.medicineName}?`)) {
            try {
              await window.cashierAPI.deleteInventoryItem(item.id);
              this.showNotification('Item deleted successfully', 'success');
              this.loadInventory();
            } catch (error) {
              console.error('Delete error:', error);
              this.showNotification('Failed to delete item', 'error');
            }
          }
        },

        openStockAdjustment(item) {
          this.adjustingItem = item;
          this.stockForm = {
            adjustmentType: 'add',
            quantity: '',
            reason: '',
            notes: ''
          };
          this.showStockModal = true;
        },

        async saveStockAdjustment() {
          try {
            await window.cashierAPI.adjustStock(this.adjustingItem.id, this.stockForm);
            this.showNotification('Stock adjusted successfully', 'success');
            this.showStockModal = false;
            this.adjustingItem = null;
            this.loadInventory();
          } catch (error) {
            console.error('Stock adjustment error:', error);
            this.showNotification('Failed to adjust stock', 'error');
          }
        },

        async viewHistory(item) {
          this.historyItem = item;
          this.loading.history = true;
          try {
            const historyData = await window.cashierAPI.getInventoryHistory(item.id);
            this.itemHistory = historyData.data || historyData || [];
          } catch (error) {
            console.error('History error:', error);
            this.itemHistory = [];
          } finally {
            this.loading.history = false;
          }
          this.showHistoryModal = true;
        },

        // Barcode Scanner Functionality
        async scanBarcode() {
          try {
            // Check if the browser supports camera access
            if (!navigator.mediaDevices || !navigator.mediaDevices.getUserMedia) {
              this.showNotification('Camera not supported on this device', 'error');
              return;
            }

            // Create a modal for barcode scanning
            this.showBarcodeScanner = true;
            
            // Start camera stream
            await this.startBarcodeScanner();
          } catch (error) {
            console.error('Barcode scanner error:', error);
            this.showNotification('Failed to start barcode scanner', 'error');
          }
        },

        async startBarcodeScanner() {
          try {
            const stream = await navigator.mediaDevices.getUserMedia({ 
              video: { facingMode: 'environment' } 
            });
            
            this.scannerStream = stream;
            
            // Initialize barcode scanner library (you'll need to add this)
            // For now, we'll simulate with a manual input
            setTimeout(() => {
              this.simulateBarcodeScan();
            }, 1000);
          } catch (error) {
            console.error('Camera access error:', error);
            this.showNotification('Camera access denied', 'error');
          }
        },

        simulateBarcodeScan() {
          // This would be replaced with actual barcode scanner implementation
          this.showNotification('Barcode scanner not yet implemented', 'info');
          this.closeBarcodeScanner();
        },

        async lookupProductByBarcode(barcode) {
          try {
            const product = await window.cashierAPI.getProductByBarcode(barcode);
            if (product) {
              // Auto-fill form with existing product data
              this.itemForm = { ...this.itemForm, ...product };
              this.showNotification('Product found and auto-filled', 'success');
            }
          } catch (error) {
            console.log('Product not found for barcode:', barcode);
            // Product not found, continue with manual entry
          }
        },

        closeBarcodeScanner() {
          if (this.scannerStream) {
            this.scannerStream.getTracks().forEach(track => track.stop());
            this.scannerStream = null;
          }
          this.showBarcodeScanner = false;
        },

        showNotification(message, type = 'info') {
          const notification = document.createElement('div');
          notification.className = `notification notification-${type}`;
          notification.textContent = message;
          notification.style.cssText = `
            position: fixed;
            top: 20px;
            right: 20px;
            padding: 1rem 1.5rem;
            border-radius: 8px;
            color: white;
            font-weight: 500;
            z-index: 10000;
            transform: translateX(100%);
            transition: transform 0.3s ease;
            ${type === 'success' ? 'background: #22c55e;' : ''}
            ${type === 'error' ? 'background: #ef4444;' : ''}
            ${type === 'info' ? 'background: #3b82f6;' : ''}
          `;
          
          document.body.appendChild(notification);
          
          setTimeout(() => {
            notification.style.transform = 'translateX(0)';
          }, 100);
          
          setTimeout(() => {
            notification.style.transform = 'translateX(100%)';
            setTimeout(() => {
              document.body.removeChild(notification);
            }, 300);
          }, 3000);
        },

        logout() {
          window.cashierAPI.logout()
            .then(() => {
              window.location.href = '../public/admin-signin.html';
            })
            .catch(error => {
              console.error('Logout error:', error);
              window.location.href = '../public/admin-signin.html';
            });
        }
      }
    }
  </script>

  <!-- Include API and Data Sync Services -->
  <script src="../shared/js/data-sync.js"></script>
  <script src="../shared/js/role-based-access.js"></script>
  <script src="../admin/js/admin-api.js"></script>
  <script src="js/cashier-api.js"></script>

  <script>
  document.addEventListener('DOMContentLoaded', () => {
    const inventoryApp = Alpine.data('inventorySystem', inventorySystem);
    inventoryApp.init();
  });
</script>

  <script defer src="https://cdn.jsdelivr.net/npm/alpinejs@3.x.x/dist/cdn.min.js"></script>
</body>
</html>
