<!DOCTYPE html>
<html lang="en" x-data="queueSystem()">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Queue Management - Umi Health Information Systems</title>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@100;400;500;600;700&family=Varela+Round&family=Nunito:wght@400;600;700&display=swap" rel="stylesheet">
  <link href="https://fonts.googleapis.com/css2?family=Material+Symbols+Rounded:wght@300;400;500;600;700&display=swap" rel="stylesheet">
  <script src="https://cdn.tailwindcss.com"></script>
  <style>
    :root {
      --color-primary: #000000;
      --color-accent: #14B8A6;
      --color-success: #22c55e;
      --color-warning: #ef4444;
      --color-text-primary: #000000;
      --color-text-secondary: #6b7280;
      --color-text-muted: #9ca3af;
      --color-background: #ffffff;
      --color-surface: #f9fafb;
      --color-border: #e5e7eb;
      --font-primary: 'Inter', sans-serif;
      --sidebar-width: 280px;
    }

    * {
      box-sizing: border-box;
      margin: 0;
      padding: 0;
    }

    body {
      background: var(--color-background);
      color: var(--color-text-primary);
      font-family: 'Nunito', 'Varela Round', sans-serif;
      line-height: 1.5;
      overflow-x: hidden;
    }

    /* Sidebar Styles */
    .sidebar {
      position: fixed;
      left: 0;
      top: 0;
      width: var(--sidebar-width);
      height: 100vh;
      background: var(--color-text-primary);
      color: var(--color-accent);
      z-index: 1000;
      transition: transform 0.3s ease;
      display: flex;
      flex-direction: column;
      overflow-y: auto;
      overflow-x: hidden;
    }

    .sidebar-header {
      padding: 1.5rem;
      border-bottom: 1px solid rgba(255, 255, 255, 0.1);
    }

    .logo-section {
      display: flex;
      align-items: center;
      gap: 0.75rem;
    }

    .logo-icon {
      width: 40px;
      height: 40px;
      background: rgba(255, 255, 255, 0.2);
      border-radius: 10px;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 1.5rem;
    }

    .logo-text {
      font-size: 1.25rem;
      font-weight: 700;
      font-family: 'Inter', sans-serif;
    }

    .nav-menu {
      padding: 1rem 0;
      flex: 1;
      overflow-y: auto;
    }

    .nav-item {
      display: flex;
      align-items: center;
      gap: 1rem;
      padding: 0.875rem 1.5rem;
      color: rgba(255, 255, 255, 0.8);
      text-decoration: none;
      transition: all 0.2s ease;
      cursor: pointer;
      font-size: 0.9rem;
      font-weight: 500;
    }

    .nav-item:hover {
      background: rgba(255, 255, 255, 0.1);
      color: var(--color-accent);
    }

    .nav-item.active {
      background: rgba(255, 255, 255, 0.15);
      color: var(--color-accent);
      border-left: 3px solid var(--color-accent);
    }

    .nav-icon {
      font-size: 1.25rem;
    }

    /* Main Content Area */
    .main-content {
      margin-left: var(--sidebar-width);
      min-height: 100vh;
      transition: margin-left 0.3s ease;
    }

    /* Header Styles */
    .header {
      background: white;
      border-bottom: 1px solid #e2e8f0;
      padding: 1rem 2rem;
      display: flex;
      justify-content: space-between;
      align-items: center;
      position: sticky;
      top: 0;
      z-index: 100;
    }

    .header-left {
      display: flex;
      align-items: center;
      gap: 1rem;
    }

    .page-title-section {
      margin-right: 2rem;
    }

    .page-title-section .page-title {
      font-size: 1.5rem;
      font-weight: 700;
      color: var(--color-text-primary);
      margin: 0;
      font-family: 'Inter', sans-serif;
    }

    .mobile-menu-toggle {
      display: none;
      background: none;
      border: none;
      font-size: 1.5rem;
      color: var(--color-text-secondary);
      cursor: pointer;
    }

    .header-right {
      display: flex;
      align-items: center;
      gap: 1rem;
    }

    .user-profile {
      display: flex;
      align-items: center;
      gap: 0.75rem;
      padding: 0.5rem;
      border-radius: 16px;
      cursor: pointer;
      transition: all 0.3s ease;
    }

    .user-profile:hover {
      background: var(--color-surface);
    }

    .user-avatar {
      width: 36px;
      height: 36px;
      background: var(--color-text-primary);
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      color: var(--color-accent);
      font-weight: 600;
      font-size: 0.875rem;
      box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
    }

    .user-info {
      display: flex;
      flex-direction: column;
    }

    .user-name {
      font-size: 0.875rem;
      font-weight: 600;
      color: var(--color-text-primary);
    }

    .user-role {
      font-size: 0.75rem;
      color: var(--color-text-secondary);
    }

    /* Queue Content */
    .queue-content {
      padding: 2rem;
      max-width: 1400px;
      margin: 0 auto;
    }

    /* Queue Stats */
    .queue-stats {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
      gap: 1.5rem;
      margin-bottom: 2rem;
    }

    .stat-card {
      background: var(--color-background);
      border-radius: 20px;
      border: 1px solid var(--color-border);
      padding: 1.5rem;
      box-shadow: 0 2px 8px rgba(0, 0, 0, 0.04);
      transition: all 0.3s ease;
    }

    .stat-card:hover {
      transform: translateY(-4px);
      box-shadow: 0 12px 24px rgba(0, 0, 0, 0.1);
    }

    .stat-header {
      display: flex;
      align-items: center;
      justify-content: space-between;
      margin-bottom: 1rem;
    }

    .stat-title {
      font-size: 0.875rem;
      font-weight: 600;
      color: var(--color-text-secondary);
    }

    .stat-icon {
      width: 40px;
      height: 40px;
      background: rgba(0, 0, 0, 0.1);
      border-radius: 10px;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 1.25rem;
      color: var(--color-text-primary);
    }

    .stat-value {
      font-size: 2rem;
      font-weight: 700;
      color: var(--color-primary);
      margin-bottom: 0.5rem;
      font-family: 'Inter', sans-serif;
    }

    .stat-description {
      color: var(--color-text-secondary);
      font-size: 0.875rem;
    }

    /* Queue Sections */
    .queue-grid {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 2rem;
      margin-bottom: 2rem;
    }

    .queue-section {
      background: var(--color-background);
      border-radius: 20px;
      border: 1px solid var(--color-border);
      padding: 1.5rem;
      box-shadow: 0 2px 8px rgba(0, 0, 0, 0.04);
    }

    .section-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 1.5rem;
    }

    .section-title {
      font-size: 1.25rem;
      font-weight: 600;
      color: var(--color-text-primary);
      font-family: 'Inter', sans-serif;
    }

    .queue-count {
      background: var(--color-primary);
      color: var(--color-accent);
      padding: 0.25rem 0.75rem;
      border-radius: 12px;
      font-size: 0.875rem;
      font-weight: 600;
    }

    /* Queue Items */
    .queue-list {
      max-height: 400px;
      overflow-y: auto;
    }

    .queue-item {
      display: flex;
      align-items: center;
      padding: 1rem;
      background: var(--color-surface);
      border-radius: 12px;
      margin-bottom: 0.75rem;
      transition: all 0.2s ease;
      cursor: pointer;
    }

    .queue-item:hover {
      transform: translateX(4px);
      box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
    }

    .queue-number {
      width: 40px;
      height: 40px;
      background: var(--color-primary);
      color: var(--color-accent);
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      font-weight: 700;
      font-size: 1.125rem;
      margin-right: 1rem;
    }

    .queue-item.serving .queue-number {
      background: var(--color-success);
      color: white;
      animation: pulse 2s infinite;
    }

    @keyframes pulse {
      0% { box-shadow: 0 0 0 0 rgba(34, 197, 94, 0.7); }
      70% { box-shadow: 0 0 0 10px rgba(34, 197, 94, 0); }
      100% { box-shadow: 0 0 0 0 rgba(34, 197, 94, 0); }
    }

    .queue-patient-info {
      flex: 1;
    }

    .patient-name {
      font-weight: 600;
      color: var(--color-text-primary);
      margin-bottom: 0.25rem;
    }

    .patient-details {
      font-size: 0.875rem;
      color: var(--color-text-secondary);
    }

    .queue-time {
      font-size: 0.75rem;
      color: var(--color-text-muted);
      margin-left: auto;
    }

    .queue-actions {
      display: flex;
      gap: 0.5rem;
      margin-left: 1rem;
    }

    /* Button Styles */
    .btn {
      padding: 0.75rem 1.5rem;
      border-radius: 12px;
      font-size: 0.875rem;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.3s ease;
      border: none;
      display: flex;
      align-items: center;
      gap: 0.5rem;
    }

    .btn-primary {
      background: var(--color-primary);
      color: var(--color-accent);
      box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
    }

    .btn-primary:hover {
      background: var(--color-text-secondary);
      transform: translateY(-2px);
      box-shadow: 0 8px 24px rgba(0, 0, 0, 0.2);
    }

    .btn-success {
      background: var(--color-success);
      color: white;
      box-shadow: 0 2px 8px rgba(34, 197, 94, 0.2);
    }

    .btn-success:hover {
      background: #16a34a;
      transform: translateY(-2px);
      box-shadow: 0 8px 24px rgba(34, 197, 94, 0.3);
    }

    .btn-danger {
      background: var(--color-warning);
      color: white;
      box-shadow: 0 2px 8px rgba(239, 68, 68, 0.2);
    }

    .btn-danger:hover {
      background: #dc2626;
      transform: translateY(-2px);
      box-shadow: 0 8px 24px rgba(239, 68, 68, 0.3);
    }

    .btn-sm {
      padding: 0.5rem 1rem;
      font-size: 0.75rem;
    }

    .action-btn {
      padding: 0.5rem;
      background: var(--color-surface);
      border: 1px solid var(--color-border);
      border-radius: 8px;
      cursor: pointer;
      transition: all 0.2s ease;
      color: var(--color-text-secondary);
    }

    .action-btn:hover {
      background: var(--color-border);
      color: var(--color-text-primary);
    }

    /* Status Badge */
    .status-badge {
      display: inline-flex;
      align-items: center;
      gap: 0.25rem;
      padding: 0.25rem 0.75rem;
      border-radius: 12px;
      font-size: 0.75rem;
      font-weight: 600;
    }

    .status-badge.waiting {
      background: rgba(251, 191, 36, 0.1);
      color: #f59e0b;
    }

    .status-badge.serving {
      background: rgba(34, 197, 94, 0.1);
      color: var(--color-success);
    }

    .status-badge.completed {
      background: rgba(59, 130, 246, 0.1);
      color: #3b82f6;
    }

    /* Loading States */
    .loading-state {
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      padding: 3rem;
      text-align: center;
    }

    .loading-spinner {
      width: 40px;
      height: 40px;
      border: 4px solid var(--color-border);
      border-top: 4px solid var(--color-primary);
      border-radius: 50%;
      animation: spin 1s linear infinite;
      margin-bottom: 1rem;
    }

    @keyframes spin {
      0% { transform: rotate(0deg); }
      100% { transform: rotate(360deg); }
    }

    .loading-state p {
      color: var(--color-text-secondary);
      font-size: 0.875rem;
      margin: 0;
    }

    .logout-section {
      padding: 1rem;
      border-top: 1px solid rgba(255, 255, 255, 0.1);
      margin-top: auto;
    }

    .logout-button {
      display: flex;
      align-items: center;
      gap: 1rem;
      padding: 0.875rem 1.5rem;
      color: rgba(255, 255, 255, 0.8);
      text-decoration: none;
      transition: all 0.2s ease;
      cursor: pointer;
      font-size: 0.9rem;
      font-weight: 500;
      width: 100%;
      border: none;
      background: transparent;
      text-align: left;
    }

    .logout-button:hover {
      background: rgba(239, 68, 68, 0.1);
      color: var(--color-warning);
    }

    .logout-icon {
      font-size: 1.25rem;
    }

    /* Priority Badges */
    .priority-badge {
      display: inline-flex;
      align-items: center;
      gap: 0.25rem;
      padding: 0.125rem 0.5rem;
      border-radius: 8px;
      font-size: 0.625rem;
      font-weight: 600;
      text-transform: uppercase;
    }

    .priority-badge.normal {
      background: rgba(34, 197, 94, 0.1);
      color: #22c55e;
    }

    .priority-badge.urgent {
      background: rgba(251, 191, 36, 0.1);
      color: #f59e0b;
    }

    .priority-badge.emergency {
      background: rgba(239, 68, 68, 0.1);
      color: #ef4444;
    }

    /* Bulk Actions Bar */
    .bulk-actions-bar {
      animation: slideDown 0.3s ease-out;
    }

    @keyframes slideDown {
      from {
        opacity: 0;
        transform: translateY(-10px);
      }
      to {
        opacity: 1;
        transform: translateY(0);
      }
    }

    /* Selected State */
    .queue-item.selected {
      background: rgba(59, 130, 246, 0.1);
      border-color: #3b82f6;
    }

    /* Drag and Drop */
    .queue-item.dragging {
      opacity: 0.5;
      transform: rotate(2deg);
    }

    .queue-item.drag-over {
      border-color: #3b82f6;
      background: rgba(59, 130, 246, 0.05);
    }

    /* Enhanced Queue Item Styles */
    .queue-item {
      display: flex;
      align-items: center;
      padding: 1rem;
      background: var(--color-surface);
      border-radius: 12px;
      margin-bottom: 0.75rem;
      transition: all 0.2s ease;
      cursor: pointer;
      border: 2px solid transparent;
    }

    .queue-item:hover {
      transform: translateX(4px);
      box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
    }

    /* Enhanced Status Badge */
    .status-badge {
      display: inline-flex;
      align-items: center;
      gap: 0.25rem;
      padding: 0.25rem 0.75rem;
      border-radius: 12px;
      font-size: 0.75rem;
      font-weight: 600;
    }

    .status-badge.waiting {
      background: rgba(251, 191, 36, 0.1);
      color: #f59e0b;
    }

    .status-badge.serving {
      background: rgba(34, 197, 94, 0.1);
      color: var(--color-success);
    }

    .status-badge.completed {
      background: rgba(59, 130, 246, 0.1);
      color: #3b82f6;
    }

    /* Responsive Grid for Analytics */
    .analytics-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
      gap: 1rem;
    }

    /* Settings Panel Styles */
    .settings-panel {
      max-height: 400px;
      overflow-y: auto;
    }

    .settings-group {
      margin-bottom: 1.5rem;
    }

    .settings-group h3 {
      font-size: 1rem;
      font-weight: 600;
      margin-bottom: 0.75rem;
      color: var(--color-text-primary);
    }

    .setting-item {
      display: flex;
      align-items: center;
      justify-content: space-between;
      padding: 0.5rem 0;
      border-bottom: 1px solid var(--color-border);
    }

    .setting-item:last-child {
      border-bottom: none;
    }

    .setting-item label {
      font-size: 0.875rem;
      color: var(--color-text-secondary);
    }

    /* Enhanced Button Styles */
    .btn-sm {
      padding: 0.375rem 0.75rem;
      font-size: 0.75rem;
      font-weight: 500;
    }

    .btn-outline {
      background: transparent;
      border: 1px solid var(--color-border);
      color: var(--color-text-secondary);
    }

    .btn-outline:hover {
      background: var(--color-surface);
      color: var(--color-text-primary);
    }

    /* Search and Filter Styles */
    .search-filter-container {
      background: var(--color-background);
      border-radius: 12px;
      padding: 1rem;
      margin-bottom: 1rem;
    }

    .filter-row {
      display: flex;
      gap: 1rem;
      align-items: center;
      flex-wrap: wrap;
    }

    .filter-row input,
    .filter-row select {
      flex: 1;
      min-width: 150px;
    }

    /* Emergency Queue Styles */
    .emergency-queue {
      border: 2px solid #ef4444;
      background: rgba(239, 68, 68, 0.05);
    }

    .emergency-queue .queue-item {
      background: rgba(239, 68, 68, 0.1);
      border-color: #ef4444;
    }

    .emergency-queue .queue-item:hover {
      background: rgba(239, 68, 68, 0.2);
    }

    /* Loading Enhancements */
    .loading-overlay {
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background: rgba(255, 255, 255, 0.8);
      display: flex;
      align-items: center;
      justify-content: center;
      z-index: 10;
    }

    /* Notification Toast Enhancements */
    .notification {
      position: fixed;
      top: 20px;
      right: 20px;
      padding: 1rem 1.5rem;
      border-radius: 8px;
      color: white;
      font-weight: 500;
      z-index: 10000;
      transform: translateX(100%);
      transition: all 0.3s ease;
      box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
    }

    .notification.show {
      transform: translateX(0);
    }

    .notification.success {
      background: #22c55e;
    }

    .notification.error {
      background: #ef4444;
    }

    .notification.info {
      background: #3b82f6;
    }

    .notification.warning {
      background: #f59e0b;
    }

    /* Responsive Enhancements */
    @media (max-width: 768px) {
      .filter-row {
        flex-direction: column;
      }

      .filter-row input,
      .filter-row select {
        width: 100%;
      }

      .bulk-actions-bar {
        flex-direction: column;
        gap: 1rem;
      }

      .queue-actions {
        flex-wrap: wrap;
        gap: 0.25rem;
      }

      .queue-actions select {
        width: 100%;
        margin-bottom: 0.5rem;
      }
    }

    @media (max-width: 768px) {
      .sidebar {
        transform: translateX(-100%);
      }

      .sidebar.open {
        transform: translateX(0);
      }

      .main-content {
        margin-left: 0;
      }

      .mobile-menu-toggle {
        display: block;
      }

      .page-title-section {
        display: none;
      }

      .queue-content {
        padding: 1rem;
      }

      .queue-stats {
        grid-template-columns: 1fr;
      }

      .queue-grid {
        grid-template-columns: 1fr;
      }
    }
  </style>
</head>
<body>
  <!-- Sidebar -->
  <aside class="sidebar" :class="sidebarOpen ? 'open' : ''">
    <div class="sidebar-header">
      <div class="logo-section">
        <div class="logo-icon">
          <span class="material-symbols-rounded">medication</span>
        </div>
        <div class="logo-text">Umi Health</div>
      </div>
    </div>

    <nav class="nav-menu">
      <a href="home.html" class="nav-item">
        <span class="material-symbols-rounded nav-icon">home</span>
        <span>Home</span>
      </a>
      <a href="point-of-sale.html" class="nav-item">
        <span class="material-symbols-rounded nav-icon">point_of_sale</span>
        <span>Point of Sale</span>
      </a>
      <a href="patients.html" class="nav-item">
        <span class="material-symbols-rounded nav-icon">people</span>
        <span>Patients</span>
      </a>
      <a href="sales.html" class="nav-item">
        <span class="material-symbols-rounded nav-icon">receipt_long</span>
        <span>Sales</span>
      </a>
      <a href="payments.html" class="nav-item">
        <span class="material-symbols-rounded nav-icon">payments</span>
        <span>Payments</span>
      </a>
      <a href="inventory-quick.html" class="nav-item">
        <span class="material-symbols-rounded nav-icon">inventory</span>
        <span>Inventory</span>
      </a>
      <a href="queue-management.html" class="nav-item active">
        <span class="material-symbols-rounded nav-icon">queue</span>
        <span>Queue</span>
      </a>
      <a href="shift-management.html" class="nav-item">
        <span class="material-symbols-rounded nav-icon">schedule</span>
        <span>Shift Management</span>
      </a>
      <a href="reports.html" class="nav-item">
        <span class="material-symbols-rounded nav-icon">summarize</span>
        <span>Reports</span>
      </a>
      <a href="help.html" class="nav-item">
        <span class="material-symbols-rounded nav-icon">help</span>
        <span>Help & Training</span>
      </a>
      <a href="account.html" class="nav-item">
        <span class="material-symbols-rounded nav-icon">settings</span>
        <span>Account</span>
      </a>
    </nav>
    
    <div class="logout-section">
      <button class="logout-button" @click="logout()">
        <span class="material-symbols-rounded logout-icon">logout</span>
        <span>Logout</span>
      </button>
    </div>
  </aside>

  <!-- Main Content -->
  <main class="main-content">
    <!-- Header -->
    <header class="header">
      <div class="header-left">
        <button class="mobile-menu-toggle" @click="sidebarOpen = !sidebarOpen">
          <span class="material-symbols-rounded">menu</span>
        </button>
        
        <div class="page-title-section">
          <h1 class="page-title">Queue Management</h1>
        </div>
      </div>

      <div class="header-right">
        <!-- User profile removed -->
      </div>
    </header>

    <!-- Queue Content -->
    <div class="queue-content">
      <!-- Search and Filter Bar -->
      <div class="queue-section mb-4">
        <div class="section-header">
          <h2 class="section-title">Search & Filter</h2>
          <div class="flex gap-2">
            <button class="btn btn-sm btn-primary" @click="showAnalytics = !showAnalytics">
              <span class="material-symbols-rounded">analytics</span>
              <span>Analytics</span>
            </button>
            <button class="btn btn-sm btn-primary" @click="loadHistory()">
              <span class="material-symbols-rounded">history</span>
              <span>History</span>
            </button>
            <button class="btn btn-sm btn-primary" @click="showSettings = !showSettings">
              <span class="material-symbols-rounded">settings</span>
              <span>Settings</span>
            </button>
          </div>
        </div>
        
        <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4">
          <div>
            <input type="text" x-model="searchQuery" @keyup.enter="searchPatients()" 
                   placeholder="Search patients..." 
                   class="w-full rounded-md border border-gray-300 px-3 py-2 focus:border-blue-500 focus:outline-none">
          </div>
          <div>
            <select x-model="filters.status" @change="applyFilters()" 
                    class="w-full rounded-md border border-gray-300 px-3 py-2 focus:border-blue-500 focus:outline-none">
              <option value="">All Status</option>
              <option value="waiting">Waiting</option>
              <option value="serving">Serving</option>
              <option value="completed">Completed</option>
            </select>
          </div>
          <div>
            <select x-model="filters.priority" @change="applyFilters()" 
                    class="w-full rounded-md border border-gray-300 px-3 py-2 focus:border-blue-500 focus:outline-none">
              <option value="">All Priority</option>
              <option value="normal">Normal</option>
              <option value="urgent">Urgent</option>
              <option value="emergency">Emergency</option>
            </select>
          </div>
          <div>
            <select x-model="filters.provider" @change="applyFilters()" 
                    class="w-full rounded-md border border-gray-300 px-3 py-2 focus:border-blue-500 focus:outline-none">
              <option value="">All Providers</option>
              <template x-for="provider in providers" :key="provider.id">
                <option :value="provider.id" x-text="provider.name"></option>
              </template>
            </select>
          </div>
        </div>
        
        <div class="flex gap-2 mt-4">
          <button class="btn btn-sm btn-primary" @click="searchPatients()">
            <span class="material-symbols-rounded">search</span>
            <span>Search</span>
          </button>
          <button class="btn btn-sm" @click="clearFilters()">
            <span class="material-symbols-rounded">clear</span>
            <span>Clear</span>
          </button>
          <button class="btn btn-sm btn-primary" @click="exportQueue('pdf')">
            <span class="material-symbols-rounded">download</span>
            <span>Export PDF</span>
          </button>
          <button class="btn btn-sm btn-primary" @click="exportQueue('excel')">
            <span class="material-symbols-rounded">table_chart</span>
            <span>Export Excel</span>
          </button>
        </div>
      </div>

      <!-- Emergency Queue Section -->
      <div class="queue-section mb-4" x-show="emergencyQueue.length > 0">
        <div class="section-header">
          <h2 class="section-title text-red-600">
            <span class="material-symbols-rounded text-red-600">emergency</span>
            Emergency Queue
          </h2>
          <span class="queue-count bg-red-600 text-white" x-text="emergencyQueue.length"></span>
        </div>
        
        <div class="queue-list">
          <template x-for="patient in emergencyQueue" :key="patient.id">
            <div class="queue-item border-red-500 bg-red-50">
              <div class="queue-number bg-red-600 text-white">
                <span class="material-symbols-rounded">emergency</span>
              </div>
              <div class="queue-patient-info">
                <div class="patient-name font-bold text-red-800" x-text="patient.name"></div>
                <div class="patient-details text-red-600">
                  <span x-text="patient.age + ' years'"></span> • 
                  <span x-text="patient.complaint"></span>
                </div>
              </div>
              <div class="queue-time" x-text="formatTime(patient.joinTime)"></div>
              <div class="queue-actions">
                <button class="action-btn bg-red-100 hover:bg-red-200" @click="servePatient(patient)" title="Serve Emergency">
                  <span class="material-symbols-rounded text-red-600">play_arrow</span>
                </button>
                <button class="action-btn" @click="viewPatientDetails(patient)" title="Details">
                  <span class="material-symbols-rounded">info</span>
                </button>
              </div>
            </div>
          </template>
        </div>
      </div>

      <!-- Analytics Panel -->
      <div class="queue-section mb-4" x-show="showAnalytics">
        <div class="section-header">
          <h2 class="section-title">Queue Analytics</h2>
          <button class="btn btn-sm" @click="showAnalytics = false">
            <span class="material-symbols-rounded">close</span>
          </button>
        </div>
        
        <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4">
          <div class="stat-card">
            <h3 class="stat-title">Avg Wait Time</h3>
            <div class="stat-value" x-text="analytics.waitTimes.length > 0 ? Math.round(analytics.waitTimes.reduce((a, b) => a + b.waitTime, 0) / analytics.waitTimes.length) + ' min' : 'N/A'"></div>
          </div>
          <div class="stat-card">
            <h3 class="stat-title">Peak Hour</h3>
            <div class="stat-value" x-text="analytics.peakHours.length > 0 ? analytics.peakHours[0].hour + ':00' : 'N/A'"></div>
          </div>
          <div class="stat-card">
            <h3 class="stat-title">Today's Patients</h3>
            <div class="stat-value" x-text="stats.completedCount"></div>
          </div>
          <div class="stat-card">
            <h3 class="stat-title">Forecast Tomorrow</h3>
            <div class="stat-value" x-text="analytics.forecast.length > 0 ? analytics.forecast[0].predicted + ' patients' : 'N/A'"></div>
          </div>
        </div>
      </div>

      <!-- Settings Panel -->
      <div class="queue-section mb-4" x-show="showSettings">
        <div class="section-header">
          <h2 class="section-title">Settings</h2>
          <button class="btn btn-sm" @click="showSettings = false">
            <span class="material-symbols-rounded">close</span>
          </button>
        </div>
        
        <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
          <div>
            <h3 class="font-semibold mb-3">Sound Settings</h3>
            <div class="space-y-3">
              <div class="flex items-center justify-between">
                <label>Enable Sounds</label>
                <input type="checkbox" x-model="soundEnabled" class="rounded">
              </div>
              <div class="flex items-center justify-between">
                <label>Volume</label>
                <input type="range" x-model="soundVolume" min="0" max="1" step="0.1" @change="updateSoundSettings()" 
                       class="w-32">
              </div>
            </div>
          </div>
          
          <div>
            <h3 class="font-semibold mb-3">Notification Settings</h3>
            <div class="space-y-3">
              <div class="flex items-center justify-between">
                <label>SMS Notifications</label>
                <input type="checkbox" x-model="notificationSettings.sms" @change="updateNotificationSettings()" class="rounded">
              </div>
              <div class="flex items-center justify-between">
                <label>WhatsApp Notifications</label>
                <input type="checkbox" x-model="notificationSettings.whatsapp" @change="updateNotificationSettings()" class="rounded">
              </div>
              <div class="flex items-center justify-between">
                <label>Sound Notifications</label>
                <input type="checkbox" x-model="notificationSettings.sound" @change="updateNotificationSettings()" class="rounded">
              </div>
            </div>
          </div>
          
          <div>
            <h3 class="font-semibold mb-3">Queue Settings</h3>
            <div class="space-y-3">
              <div class="flex items-center justify-between">
                <label>Target Wait Time (minutes)</label>
                <input type="number" x-model="queueSettings.targetWaitTime" min="1" max="120" 
                       @change="updateQueueSettings()" class="w-20 rounded border px-2 py-1">
              </div>
              <div class="flex items-center justify-between">
                <label>Auto-Escalate After (minutes)</label>
                <input type="number" x-model="queueSettings.autoEscalateWaitTime" min="5" max="180" 
                       @change="updateQueueSettings()" class="w-20 rounded border px-2 py-1">
              </div>
              <div class="flex items-center justify-between">
                <label>Max Queue Size</label>
                <input type="number" x-model="queueSettings.maxQueueSize" min="10" max="200" 
                       @change="updateQueueSettings()" class="w-20 rounded border px-2 py-1">
              </div>
              <div class="flex items-center justify-between">
                <label>Auto Notifications</label>
                <input type="checkbox" x-model="queueSettings.enableAutoNotifications" @change="updateQueueSettings()" class="rounded">
              </div>
            </div>
          </div>
          
          <div>
            <h3 class="font-semibold mb-3">Current Performance</h3>
            <div class="space-y-3">
              <div class="flex items-center justify-between">
                <label>Current Avg Wait Time</label>
                <span class="font-medium" x-text="stats.averageWaitTime + ' min'"></span>
              </div>
              <div class="flex items-center justify-between">
                <label>Status vs Target</label>
                <span class="font-medium" 
                      :class="parseFloat(stats.averageWaitTime) <= queueSettings.targetWaitTime ? 'text-green-600' : 'text-red-600'"
                      x-text="parseFloat(stats.averageWaitTime) <= queueSettings.targetWaitTime ? 'On Target' : 'Above Target'">
                </span>
              </div>
              <div class="flex items-center justify-between">
                <label>Patients Waiting</label>
                <span class="font-medium" x-text="stats.waitingCount + ' / ' + queueSettings.maxQueueSize"></span>
              </div>
            </div>
          </div>
        </div>
      </div>

      <!-- Queue Stats -->
      <div class="queue-stats">
        <div class="stat-card">
          <div class="stat-header">
            <h3 class="stat-title">Currently Waiting</h3>
            <div class="stat-icon">
              <span class="material-symbols-rounded">hourglass_top</span>
            </div>
          </div>
          <div class="stat-value" x-text="stats.waitingCount"></div>
          <div class="stat-description">Patients waiting in queue</div>
        </div>

        <div class="stat-card">
          <div class="stat-header">
            <h3 class="stat-title">Now Serving</h3>
            <div class="stat-icon">
              <span class="material-symbols-rounded">person</span>
            </div>
          </div>
          <div class="stat-value" x-text="stats.servingCount"></div>
          <div class="stat-description">Currently being served</div>
        </div>

        <div class="stat-card">
          <div class="stat-header">
            <h3 class="stat-title">Completed Today</h3>
            <div class="stat-icon">
              <span class="material-symbols-rounded">check_circle</span>
            </div>
          </div>
          <div class="stat-value" x-text="stats.completedCount"></div>
          <div class="stat-description">Patients served today</div>
        </div>

        <div class="stat-card">
          <div class="stat-header">
            <h3 class="stat-title">Average Wait Time</h3>
            <div class="stat-icon">
              <span class="material-symbols-rounded">schedule</span>
            </div>
          </div>
          <div class="stat-value" x-text="stats.averageWaitTime"></div>
          <div class="stat-description">Minutes per patient</div>
        </div>
      </div>

      <!-- Queue Sections -->
      <div class="queue-grid">
        <!-- Current Queue -->
        <div class="queue-section">
          <div class="section-header">
            <h2 class="section-title">Current Queue</h2>
            <div class="flex items-center gap-2">
              <input type="checkbox" x-model="selectedPatients.length === currentQueue.length && currentQueue.length > 0" 
                     @change="selectAllPatients()" class="rounded">
              <span class="queue-count" x-text="currentQueue.length"></span>
            </div>
          </div>

          <!-- Bulk Actions Bar -->
          <div x-show="showBulkActions" class="bulk-actions-bar bg-blue-50 border border-blue-200 rounded-lg p-3 mb-4">
            <div class="flex items-center justify-between">
              <span class="text-blue-800 font-medium">
                <span x-text="selectedPatients.length"></span> patients selected
              </span>
              <div class="flex gap-2">
                <button class="btn btn-sm btn-success" @click="bulkServe()">
                  <span class="material-symbols-rounded">play_arrow</span>
                  <span>Bulk Serve</span>
                </button>
                <button class="btn btn-sm btn-danger" @click="bulkRemove()">
                  <span class="material-symbols-rounded">delete</span>
                  <span>Bulk Remove</span>
                </button>
                <button class="btn btn-sm btn-primary" @click="bulkAssignProvider()">
                  <span class="material-symbols-rounded">person_add</span>
                  <span>Assign Provider</span>
                </button>
                <button class="btn btn-sm" @click="selectedPatients = []; showBulkActions = false">
                  <span class="material-symbols-rounded">close</span>
                  <span>Cancel</span>
                </button>
              </div>
            </div>
          </div>

          <!-- Loading State -->
          <div x-show="loading.queue" class="loading-state">
            <div class="loading-spinner"></div>
            <p>Loading queue data...</p>
          </div>
          
          <!-- Queue List -->
          <div x-show="!loading.queue">
            <div class="queue-list">
              <template x-for="(patient, index) in currentQueue" :key="patient.id">
                <div class="queue-item" 
                     :class="{
                       'serving': patient.status === 'serving',
                       'border-red-500 bg-red-50': patient.priority === 'emergency',
                       'border-orange-500 bg-orange-50': patient.priority === 'urgent',
                       'selected': selectedPatients.includes(patient.id)
                     }"
                     draggable="true"
                     @dragstart="startDrag($event, index)"
                     @dragover="allowDrop($event)"
                     @drop="drop($event, index)">
                  
                  <!-- Selection Checkbox -->
                  <div class="flex items-center mr-2">
                    <input type="checkbox" :checked="selectedPatients.includes(patient.id)" 
                           @change="togglePatientSelection(patient.id)" class="rounded">
                  </div>
                  
                  <!-- Priority Indicator -->
                  <div class="queue-number" 
                       :class="{
                         'bg-red-600': patient.priority === 'emergency',
                         'bg-orange-500': patient.priority === 'urgent',
                         'bg-green-600': patient.priority === 'normal'
                       }"
                       x-text="patient.queueNumber">
                  </div>
                  
                  <div class="queue-patient-info">
                    <div class="patient-name flex items-center gap-2">
                      <span x-text="patient.name"></span>
                      <span class="priority-badge" 
                            :class="patient.priority"
                            x-text="patient.priority">
                      </span>
                    </div>
                    <div class="patient-details">
                      <span x-text="patient.age + ' years'"></span> • 
                      <span x-text="patient.complaint"></span>
                      <template x-if="patient.provider">
                        • <span class="text-blue-600" x-text="'Dr. ' + patient.provider.name"></span>
                      </template>
                    </div>
                  </div>
                  
                  <div class="queue-time" x-text="formatTime(patient.joinTime)"></div>
                  
                  <div class="queue-actions">
                    <select x-model="patient.providerId" @change="assignProvider(patient.id, patient.providerId)"
                            class="text-xs border rounded px-1 py-1 mr-1">
                      <option value="">Assign Provider</option>
                      <template x-for="provider in providers" :key="provider.id">
                        <option :value="provider.id" x-text="provider.name"></option>
                      </template>
                    </select>
                    
                    <select x-model="patient.priority" @change="updatePriority(patient.id, patient.priority)"
                            class="text-xs border rounded px-1 py-1 mr-1">
                      <option value="normal">Normal</option>
                      <option value="urgent">Urgent</option>
                      <option value="emergency">Emergency</option>
                    </select>
                    
                    <button class="action-btn" @click="servePatient(patient)" title="Serve">
                      <span class="material-symbols-rounded">play_arrow</span>
                    </button>
                    <button class="action-btn" @click="viewPatientDetails(patient)" title="Details">
                      <span class="material-symbols-rounded">info</span>
                    </button>
                    <button class="action-btn" @click="sendNotification(patient.id, 'sms')" title="Send SMS">
                      <span class="material-symbols-rounded">sms</span>
                    </button>
                    <button class="action-btn" @click="sendNotification(patient.id, 'whatsapp')" title="Send WhatsApp">
                      <span class="material-symbols-rounded">chat</span>
                    </button>
                    <button class="action-btn" @click="printQueueSlip(patient.id)" title="Print Slip">
                      <span class="material-symbols-rounded">print</span>
                    </button>
                    <button class="action-btn text-red-600" @click="removePatient(patient)" title="Remove">
                      <span class="material-symbols-rounded">close</span>
                    </button>
                  </div>
                </div>
              </template>
            </div>
          </div>
        </div>

        <!-- Recently Completed -->
        <div class="queue-section">
          <div class="section-header">
            <h2 class="section-title">Recently Completed</h2>
            <span class="queue-count" x-text="completedQueue.length"></span>
          </div>

          <!-- Completed List -->
          <div class="queue-list">
            <template x-for="patient in completedQueue" :key="patient.id">
              <div class="queue-item">
                <div class="queue-number" style="background: var(--color-success); color: white;">
                  <span class="material-symbols-rounded">check</span>
                </div>
                <div class="queue-patient-info">
                  <div class="patient-name" x-text="patient.name"></div>
                  <div class="patient-details">
                    <span x-text="patient.service"></span> • 
                    <span x-text="'Served by ' + patient.servedBy"></span>
                  </div>
                </div>
                <div class="queue-time" x-text="formatTime(patient.completeTime)"></div>
                <div class="queue-actions">
                  <button class="action-btn" @click="viewPatientDetails(patient)" title="Details">
                    <span class="material-symbols-rounded">info</span>
                  </button>
                </div>
              </div>
            </template>
          </div>
        </div>
      </div>

      <!-- Quick Actions -->
      <div class="queue-section">
        <div class="section-header">
          <h2 class="section-title">Quick Actions</h2>
        </div>
        <div style="display: flex; gap: 1rem; flex-wrap: wrap;">
          <button class="btn btn-primary" @click="addToQueue()">
            <span class="material-symbols-rounded">person_add</span>
            <span>Add Patient to Queue</span>
          </button>
          <button class="btn btn-danger" @click="addToEmergencyQueue()">
            <span class="material-symbols-rounded">emergency</span>
            <span>Add Emergency Patient</span>
          </button>
          <button class="btn btn-success" @click="callNextPatient()">
            <span class="material-symbols-rounded">next_plan</span>
            <span>Call Next Patient</span>
          </button>
          <button class="btn btn-danger" @click="clearQueue()">
            <span class="material-symbols-rounded">clear_all</span>
            <span>Clear Queue</span>
          </button>
          <button class="btn btn-primary" @click="printDailyReport()">
            <span class="material-symbols-rounded">print</span>
            <span>Print Daily Report</span>
          </button>
        </div>
      </div>
    </div>
  </main>

  <!-- Add Patient Modal -->
  <div x-show="showAddPatientModal" 
       x-transition:enter="transition ease-out duration-300"
       x-transition:enter-start="opacity-0"
       x-transition:enter-end="opacity-100"
       x-transition:leave="transition ease-in duration-200"
       x-transition:leave-start="opacity-100"
       x-transition:leave-end="opacity-0"
       class="fixed inset-0 z-50 overflow-y-auto bg-black bg-opacity-50"
       style="display: none;">
    <div class="flex min-h-screen items-center justify-center px-4">
      <div x-show="showAddPatientModal"
           x-transition:enter="transition ease-out duration-300"
           x-transition:enter-start="opacity-0 scale-95"
           x-transition:enter-end="opacity-100 scale-100"
           x-transition:leave="transition ease-in duration-200"
           x-transition:leave-start="opacity-100 scale-100"
           x-transition:leave-end="opacity-0 scale-95"
           class="relative w-full max-w-md rounded-lg bg-white p-6 shadow-xl">
        
        <div class="mb-4 flex items-center justify-between">
          <h3 class="text-lg font-semibold text-gray-900">Add Patient to Queue</h3>
          <button @click="showAddPatientModal = false" 
                  class="text-gray-400 hover:text-gray-600">
            <span class="material-symbols-rounded">close</span>
          </button>
        </div>

        <form @submit.prevent="submitAddPatient()">
          <div class="space-y-4">
            <div>
              <label class="block text-sm font-medium text-gray-700 mb-1">Patient Name *</label>
              <input type="text" x-model="newPatient.name" required
                     class="w-full rounded-md border border-gray-300 px-3 py-2 focus:border-blue-500 focus:outline-none focus:ring-1 focus:ring-blue-500">
            </div>

            <div class="grid grid-cols-2 gap-4">
              <div>
                <label class="block text-sm font-medium text-gray-700 mb-1">Age *</label>
                <input type="number" x-model="newPatient.age" required min="0" max="150"
                       class="w-full rounded-md border border-gray-300 px-3 py-2 focus:border-blue-500 focus:outline-none focus:ring-1 focus:ring-blue-500">
              </div>
              <div>
                <label class="block text-sm font-medium text-gray-700 mb-1">Gender *</label>
                <select x-model="newPatient.gender" required
                        class="w-full rounded-md border border-gray-300 px-3 py-2 focus:border-blue-500 focus:outline-none focus:ring-1 focus:ring-blue-500">
                  <option value="">Select</option>
                  <option value="male">Male</option>
                  <option value="female">Female</option>
                  <option value="other">Other</option>
                </select>
              </div>
            </div>

            <div>
              <label class="block text-sm font-medium text-gray-700 mb-1">Phone Number</label>
              <input type="tel" x-model="newPatient.phone"
                     class="w-full rounded-md border border-gray-300 px-3 py-2 focus:border-blue-500 focus:outline-none focus:ring-1 focus:ring-blue-500">
            </div>

            <div>
              <label class="block text-sm font-medium text-gray-700 mb-1">Complaint/Reason for Visit *</label>
              <textarea x-model="newPatient.complaint" required rows="3"
                        class="w-full rounded-md border border-gray-300 px-3 py-2 focus:border-blue-500 focus:outline-none focus:ring-1 focus:ring-blue-500"></textarea>
            </div>

            <div>
              <label class="block text-sm font-medium text-gray-700 mb-1">Priority</label>
              <select x-model="newPatient.priority"
                      class="w-full rounded-md border border-gray-300 px-3 py-2 focus:border-blue-500 focus:outline-none focus:ring-1 focus:ring-blue-500">
                <option value="normal">Normal</option>
                <option value="urgent">Urgent</option>
                <option value="emergency">Emergency</option>
              </select>
            </div>
          </div>

          <div class="mt-6 flex gap-3">
            <button type="button" @click="showAddPatientModal = false"
                    class="flex-1 rounded-md border border-gray-300 px-4 py-2 text-gray-700 hover:bg-gray-50">
              Cancel
            </button>
            <button type="submit"
                    class="flex-1 rounded-md bg-blue-600 px-4 py-2 text-white hover:bg-blue-700">
              Add to Queue
            </button>
          </div>
        </form>
      </div>
    </div>
  </div>

  <!-- Patient Details Modal -->
  <div x-show="showPatientDetailsModal" 
       x-transition:enter="transition ease-out duration-300"
       x-transition:enter-start="opacity-0"
       x-transition:enter-end="opacity-100"
       x-transition:leave="transition ease-in duration-200"
       x-transition:leave-start="opacity-100"
       x-transition:leave-end="opacity-0"
       class="fixed inset-0 z-50 overflow-y-auto bg-black bg-opacity-50"
       style="display: none;">
    <div class="flex min-h-screen items-center justify-center px-4">
      <div x-show="showPatientDetailsModal"
           x-transition:enter="transition ease-out duration-300"
           x-transition:enter-start="opacity-0 scale-95"
           x-transition:enter-end="opacity-100 scale-100"
           x-transition:leave="transition ease-in duration-200"
           x-transition:leave-start="opacity-100 scale-100"
           x-transition:leave-end="opacity-0 scale-95"
           class="relative w-full max-w-lg rounded-lg bg-white p-6 shadow-xl">
        
        <div class="mb-4 flex items-center justify-between">
          <h3 class="text-lg font-semibold text-gray-900">Patient Details</h3>
          <button @click="showPatientDetailsModal = false" 
                  class="text-gray-400 hover:text-gray-600">
            <span class="material-symbols-rounded">close</span>
          </button>
        </div>

        <div x-show="selectedPatient" class="space-y-4">
          <div class="flex items-center space-x-4">
            <div class="h-16 w-16 rounded-full bg-blue-100 flex items-center justify-center">
              <span class="material-symbols-rounded text-blue-600 text-2xl">person</span>
            </div>
            <div>
              <h4 class="text-lg font-semibold" x-text="selectedPatient.name"></h4>
              <p class="text-sm text-gray-500">Queue Number: <span x-text="selectedPatient.queueNumber"></span></p>
            </div>
          </div>

          <div class="grid grid-cols-2 gap-4">
            <div>
              <p class="text-sm text-gray-500">Age</p>
              <p class="font-medium" x-text="selectedPatient.age + ' years'"></p>
            </div>
            <div>
              <p class="text-sm text-gray-500">Gender</p>
              <p class="font-medium capitalize" x-text="selectedPatient.gender"></p>
            </div>
            <div>
              <p class="text-sm text-gray-500">Phone</p>
              <p class="font-medium" x-text="selectedPatient.phone || 'Not provided'"></p>
            </div>
            <div>
              <p class="text-sm text-gray-500">Priority</p>
              <p class="font-medium capitalize" x-text="selectedPatient.priority"></p>
            </div>
          </div>

          <div>
            <p class="text-sm text-gray-500 mb-1">Complaint/Reason for Visit</p>
            <p class="font-medium" x-text="selectedPatient.complaint"></p>
          </div>

          <div>
            <p class="text-sm text-gray-500 mb-1">Time in Queue</p>
            <p class="font-medium" x-text="formatTime(selectedPatient.joinTime)"></p>
          </div>

          <div>
            <p class="text-sm text-gray-500 mb-1">Status</p>
            <div class="inline-flex items-center">
              <span class="status-badge" :class="selectedPatient.status" x-text="selectedPatient.status"></span>
            </div>
          </div>
        </div>

        <div class="mt-6 flex gap-3">
          <button @click="showPatientDetailsModal = false"
                  class="flex-1 rounded-md border border-gray-300 px-4 py-2 text-gray-700 hover:bg-gray-50">
            Close
          </button>
          <button x-show="selectedPatient && selectedPatient.status === 'waiting'" 
                  @click="serveSelectedPatient()"
                  class="flex-1 rounded-md bg-green-600 px-4 py-2 text-white hover:bg-green-700">
            Serve Patient
          </button>
        </div>
      </div>
    </div>
  </div>

  <!-- History Modal -->
  <div x-show="showHistory" 
       x-transition:enter="transition ease-out duration-300"
       x-transition:enter-start="opacity-0"
       x-transition:enter-end="opacity-100"
       x-transition:leave="transition ease-in duration-200"
       x-transition:leave-start="opacity-100"
       x-transition:leave-end="opacity-0"
       class="fixed inset-0 z-50 overflow-y-auto bg-black bg-opacity-50"
       style="display: none;">
    <div class="flex min-h-screen items-center justify-center px-4">
      <div x-show="showHistory"
           x-transition:enter="transition ease-out duration-300"
           x-transition:enter-start="opacity-0 scale-95"
           x-transition:enter-end="opacity-100 scale-100"
           x-transition:leave="transition ease-in duration-200"
           x-transition:leave-start="opacity-100 scale-100"
           x-transition:leave-end="opacity-0 scale-95"
           class="relative w-full max-w-4xl rounded-lg bg-white p-6 shadow-xl">
        
        <div class="mb-4 flex items-center justify-between">
          <h3 class="text-lg font-semibold text-gray-900">Queue History & Audit Trail</h3>
          <button class="btn btn-sm" @click="showHistory = false">
            <span class="material-symbols-rounded">close</span>
          </button>
        </div>

        <div class="mb-4 flex gap-2">
          <input type="date" x-model="historyFilters.dateFrom" @change="loadHistory()" 
                 class="rounded border px-3 py-2">
          <input type="date" x-model="historyFilters.dateTo" @change="loadHistory()" 
                 class="rounded border px-3 py-2">
          <select x-model="historyFilters.action" @change="loadHistory()" 
                  class="rounded border px-3 py-2">
            <option value="">All Actions</option>
            <option value="add">Add Patient</option>
            <option value="serve">Serve Patient</option>
            <option value="remove">Remove Patient</option>
            <option value="complete">Complete Service</option>
            <option value="escalate">Escalate Priority</option>
          </select>
          <button class="btn btn-sm btn-primary" @click="loadHistory()">
            <span class="material-symbols-rounded">search</span>
            <span>Filter</span>
          </button>
          <button class="btn btn-sm" @click="clearHistoryFilters()">
            <span class="material-symbols-rounded">clear</span>
            <span>Clear</span>
          </button>
        </div>

        <div class="history-table-container">
          <table class="history-table">
            <thead>
              <tr>
                <th>Date/Time</th>
                <th>Action</th>
                <th>Patient</th>
                <th>Queue #</th>
                <th>User</th>
                <th>Details</th>
              </tr>
            </thead>
            <tbody>
              <template x-for="record in history" :key="record.id">
                <tr>
                  <td x-text="new Date(record.timestamp).toLocaleString()"></td>
                  <td>
                    <span class="action-badge" :class="record.action.toLowerCase()" x-text="record.action"></span>
                  </td>
                  <td x-text="record.patientName || '-'"></td>
                  <td x-text="record.queueNumber || '-'"></td>
                  <td x-text="record.userName || '-'"></td>
                  <td x-text="record.details || '-'"></td>
                </tr>
              </template>
              <tr x-show="history.length === 0">
                <td colspan="6" style="text-align: center; padding: 2rem;">No history records found</td>
              </tr>
            </tbody>
          </table>
        </div>

        <div class="mt-4 flex justify-between">
          <div class="text-sm text-gray-500">
            Showing <span x-text="history.length"></span> records
          </div>
          <div class="flex gap-2">
            <button class="btn btn-sm btn-primary" @click="exportHistory()">
              <span class="material-symbols-rounded">download</span>
              <span>Export</span>
            </button>
            <button class="btn btn-sm" @click="showHistory = false">
              <span class="material-symbols-rounded">close</span>
              <span>Close</span>
            </button>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Include API and Data Manager -->
  <script src="js/cashier-api.js"></script>
  <script src="js/data-manager.js"></script>

  <!-- Alpine.js Component -->
  <script>
    function queueSystem() {
      return {
        sidebarOpen: false,
        userInfo: {
          name: '',
          role: 'Cashier',
          initials: ''
        },
        currentQueue: [],
        completedQueue: [],
        stats: {
          waitingCount: 0,
          servingCount: 0,
          completedCount: 0,
          averageWaitTime: '12'
        },
        loading: {
          queue: true
        },
        showAddPatientModal: false,
        showPatientDetailsModal: false,
        newPatient: {
          name: '',
          age: '',
          gender: '',
          phone: '',
          complaint: '',
          priority: 'normal'
        },
        selectedPatient: null,
        providers: [],
        emergencyQueue: [],
        searchQuery: '',
        filters: {
          status: '',
          priority: '',
          provider: '',
          dateFrom: '',
          dateTo: ''
        },
        selectedPatients: [],
        showBulkActions: false,
        showAnalytics: false,
        showHistory: false,
        showSettings: false,
        soundEnabled: true,
        soundVolume: 0.5,
        analytics: {
          waitTimes: [],
          peakHours: [],
          providerStats: [],
          forecast: []
        },
        history: [],
        notificationSettings: {
          sms: false,
          whatsapp: false,
          sound: true
        },
        queueSettings: {
          targetWaitTime: 15, // minutes
          autoEscalateWaitTime: 30, // minutes
          maxQueueSize: 50,
          enableAutoNotifications: false
        },
        dragStartIndex: null,
        historyFilters: {
          dateFrom: '',
          dateTo: '',
          action: ''
        },

        async init() {
          await this.loadUserInfo();
          await Promise.all([
            this.loadQueueData(),
            this.loadProviders(),
            this.loadEmergencyQueue(),
            this.loadAnalytics(),
            this.loadSettings()
          ]);
          
          // Start real-time updates
          setInterval(() => this.loadQueueData(), 30000); // Update every 30 seconds
          setInterval(() => this.loadEmergencyQueue(), 30000);
          
          // Subscribe to data changes from other pages
          if (window.umiDataManager) {
            window.umiDataManager.subscribe('queue', (data) => {
              this.loadQueueData();
            });
          }
        },

        async loadUserInfo() {
          try {
            const profile = await window.cashierAPI.getUserProfile();
            this.userInfo = {
              name: `${profile.firstName || ''} ${profile.lastName || ''}`.trim() || 'Cashier',
              role: 'Cashier',
              initials: this.getInitials(profile.firstName, profile.lastName)
            };
          } catch (error) {
            console.error('Error loading user info:', error);
            this.userInfo = {
              name: 'Cashier',
              role: 'Cashier',
              initials: 'C'
            };
          }
        },

        getInitials(firstName, lastName) {
          const first = firstName ? firstName.charAt(0).toUpperCase() : '';
          const last = lastName ? lastName.charAt(0).toUpperCase() : '';
          return (first + last) || 'C';
        },

        async loadQueueData() {
          this.loading.queue = true;
          try {
            const [queueData, statsData] = await Promise.all([
              window.cashierAPI.getQueueData(),
              window.cashierAPI.getQueueStats()
            ]);
            
            this.currentQueue = queueData.current || [];
            this.completedQueue = queueData.completed || [];
            this.stats = {
              waitingCount: statsData.waitingCount || 0,
              servingCount: statsData.servingCount || 0,
              completedCount: statsData.completedCount || 0,
              averageWaitTime: statsData.averageWaitTime || '0'
            };
          } catch (error) {
            console.error('Error loading queue data:', error);
            this.showNotification('Failed to load queue data', 'error');
            this.currentQueue = [];
            this.completedQueue = [];
            this.stats = {
              waitingCount: 0,
              servingCount: 0,
              completedCount: 0,
              averageWaitTime: '0'
            };
          } finally {
            this.loading.queue = false;
          }
        },


        formatTime(timeString) {
          const date = new Date(timeString);
          return date.toLocaleTimeString('en-US', { 
            hour: '2-digit', 
            minute: '2-digit'
          });
        },

        async servePatient(patient) {
          try {
            const result = await window.cashierAPI.servePatient(patient.id);
            if (result.success) {
              patient.status = 'serving';
              await this.loadQueueData();
              this.showNotification(`Now serving ${patient.name}`, 'success');
              this.playQueueSound('serve');
            } else {
              this.showNotification(result.message || 'Failed to serve patient', 'error');
            }
          } catch (error) {
            console.error('Error serving patient:', error);
            this.showNotification('Failed to serve patient', 'error');
          }
        },

        async removePatient(patient) {
          if (confirm(`Remove ${patient.name} from the queue?`)) {
            try {
              const result = await window.cashierAPI.removePatient(patient.id);
              if (result.success) {
                await this.loadQueueData();
                this.showNotification('Patient removed from queue', 'info');
              } else {
                this.showNotification(result.message || 'Failed to remove patient', 'error');
              }
            } catch (error) {
              console.error('Error removing patient:', error);
              this.showNotification('Failed to remove patient', 'error');
            }
          }
        },

        async addToQueue() {
          this.showAddPatientModal = true;
          this.newPatient = {
            name: '',
            age: '',
            gender: '',
            phone: '',
            complaint: '',
            priority: 'normal'
          };
        },

        async callNextPatient() {
          try {
            const result = await window.cashierAPI.callNextPatient();
            if (result.success) {
              await this.loadQueueData();
              this.showNotification(`Calling next patient: ${result.patient?.name || 'Patient'}`, 'success');
            } else {
              this.showNotification(result.message || 'No patients waiting in queue', 'info');
            }
          } catch (error) {
            console.error('Error calling next patient:', error);
            this.showNotification('Failed to call next patient', 'error');
          }
        },

        async clearQueue() {
          if (confirm('Clear all patients from the current queue? This action cannot be undone.')) {
            try {
              const result = await window.cashierAPI.clearQueue();
              if (result.success) {
                await this.loadQueueData();
                this.showNotification('Queue cleared successfully', 'success');
              } else {
                this.showNotification(result.message || 'Failed to clear queue', 'error');
              }
            } catch (error) {
              console.error('Error clearing queue:', error);
              this.showNotification('Failed to clear queue', 'error');
            }
          }
        },

        viewPatientDetails(patient) {
          this.selectedPatient = patient;
          this.showPatientDetailsModal = true;
        },

        async submitAddPatient() {
          try {
            const result = await window.cashierAPI.addToQueue(this.newPatient);
            if (result.success) {
              this.showAddPatientModal = false;
              await this.loadQueueData();
              
              // Sync data across pages
              if (window.umiDataManager) {
                window.umiDataManager.notifySubscribers('queue', { action: 'add', patient: result.patient });
              }
              
              this.showNotification('Patient added to queue successfully', 'success');
              this.playQueueSound('add');
              
              // Reset form
              this.newPatient = {
                name: '',
                age: '',
                gender: '',
                phone: '',
                complaint: '',
                priority: 'normal'
              };
            } else {
              this.showNotification(result.message || 'Failed to add patient to queue', 'error');
            }
          } catch (error) {
            console.error('Error adding patient to queue:', error);
            this.showNotification('Failed to add patient to queue', 'error');
          }
        },

        async serveSelectedPatient() {
          if (this.selectedPatient) {
            await this.servePatient(this.selectedPatient);
            this.showPatientDetailsModal = false;
          }
        },

        // New feature methods
        async loadProviders() {
          try {
            const providersData = await window.cashierAPI.getProviders();
            this.providers = providersData.data || providersData || [];
          } catch (error) {
            console.error('Error loading providers:', error);
            this.providers = [];
          }
        },

        async loadEmergencyQueue() {
          try {
            const emergencyData = await window.cashierAPI.getEmergencyQueue();
            this.emergencyQueue = emergencyData.data || emergencyData || [];
          } catch (error) {
            console.error('Error loading emergency queue:', error);
            this.emergencyQueue = [];
          }
        },

        async loadAnalytics() {
          try {
            const [waitTimes, peakHours, providerStats, forecast] = await Promise.all([
              window.cashierAPI.getWaitTimeAnalytics(30),
              window.cashierAPI.getPeakHourAnalysis(30),
              window.cashierAPI.getProviderAnalytics('', 30),
              window.cashierAPI.getQueueForecast(7)
            ]);
            
            this.analytics = {
              waitTimes: waitTimes.data || waitTimes || [],
              peakHours: peakHours.data || peakHours || [],
              providerStats: providerStats.data || providerStats || [],
              forecast: forecast.data || forecast || []
            };
          } catch (error) {
            console.error('Error loading analytics:', error);
          }
        },

        async loadSettings() {
          try {
            const [soundVolume, notificationSettings] = await Promise.all([
              window.cashierAPI.getSoundVolume(),
              window.cashierAPI.getNotificationSettings()
            ]);
            
            this.soundVolume = soundVolume.volume || 0.5;
            this.notificationSettings = notificationSettings.data || notificationSettings || {
              sms: false,
              whatsapp: false,
              sound: true
            };
            
            // Load queue settings from localStorage
            const savedQueueSettings = localStorage.getItem('umi_queue_settings');
            if (savedQueueSettings) {
              this.queueSettings = JSON.parse(savedQueueSettings);
            }
          } catch (error) {
            console.error('Error loading settings:', error);
          }
        },

        async loadHistory() {
          try {
            const historyData = await window.cashierAPI.getQueueHistory(this.historyFilters);
            this.history = historyData.data || historyData || [];
            this.showHistory = true;
          } catch (error) {
            console.error('Error loading history:', error);
            this.showNotification('Failed to load history', 'error');
          }
        },

        clearHistoryFilters() {
          this.historyFilters = {
            dateFrom: '',
            dateTo: '',
            action: ''
          };
          this.loadHistory();
        },

        async exportHistory() {
          try {
            const csvContent = this.generateHistoryCSV();
            const blob = new Blob([csvContent], { type: 'text/csv' });
            const url = window.URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `queue-history-${new Date().toISOString().split('T')[0]}.csv`;
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            window.URL.revokeObjectURL(url);
            this.showNotification('History exported successfully', 'success');
          } catch (error) {
            console.error('Error exporting history:', error);
            this.showNotification('Failed to export history', 'error');
          }
        },

        generateHistoryCSV() {
          const headers = ['Date/Time', 'Action', 'Patient', 'Queue #', 'User', 'Details'];
          const rows = this.history.map(record => [
            new Date(record.timestamp).toLocaleString(),
            record.action,
            record.patientName || '',
            record.queueNumber || '',
            record.userName || '',
            record.details || ''
          ]);
          
          const csvContent = [
            headers.join(','),
            ...rows.map(row => row.map(cell => `"${cell}"`).join(','))
          ].join('\n');
          
          return csvContent;
        },

        playQueueSound(soundType) {
          if (this.soundEnabled && this.notificationSettings.sound) {
            window.cashierAPI.playSound(soundType);
          }
        },

        async searchPatients() {
          if (!this.searchQuery.trim()) {
            await this.loadQueueData();
            return;
          }
          
          try {
            const searchResults = await window.cashierAPI.searchPatients(this.searchQuery, this.filters);
            this.currentQueue = searchResults.data || searchResults || [];
          } catch (error) {
            console.error('Error searching patients:', error);
            this.showNotification('Search failed', 'error');
          }
        },

        async applyFilters() {
          try {
            const filteredResults = await window.cashierAPI.filterQueue(this.filters);
            this.currentQueue = filteredResults.data || filteredResults || [];
          } catch (error) {
            console.error('Error applying filters:', error);
            this.showNotification('Filter failed', 'error');
          }
        },

        clearFilters() {
          this.filters = {
            status: '',
            priority: '',
            provider: '',
            dateFrom: '',
            dateTo: ''
          };
          this.searchQuery = '';
          this.loadQueueData();
        },

        togglePatientSelection(patientId) {
          const index = this.selectedPatients.indexOf(patientId);
          if (index > -1) {
            this.selectedPatients.splice(index, 1);
          } else {
            this.selectedPatients.push(patientId);
          }
          this.showBulkActions = this.selectedPatients.length > 0;
        },

        selectAllPatients() {
          if (this.selectedPatients.length === this.currentQueue.length) {
            this.selectedPatients = [];
          } else {
            this.selectedPatients = this.currentQueue.map(p => p.id);
          }
          this.showBulkActions = this.selectedPatients.length > 0;
        },

        async bulkServe() {
          if (this.selectedPatients.length === 0) return;
          
          if (confirm(`Serve ${this.selectedPatients.length} selected patients?`)) {
            try {
              const result = await window.cashierAPI.bulkServePatients(this.selectedPatients);
              if (result.success) {
                await this.loadQueueData();
                this.selectedPatients = [];
                this.showBulkActions = false;
                this.showNotification('Patients served successfully', 'success');
                this.playQueueSound('serve');
              }
            } catch (error) {
              console.error('Error in bulk serve:', error);
              this.showNotification('Bulk serve failed', 'error');
            }
          }
        },

        async bulkRemove() {
          if (this.selectedPatients.length === 0) return;
          
          if (confirm(`Remove ${this.selectedPatients.length} selected patients?`)) {
            try {
              const result = await window.cashierAPI.bulkRemovePatients(this.selectedPatients);
              if (result.success) {
                await this.loadQueueData();
                this.selectedPatients = [];
                this.showBulkActions = false;
                this.showNotification('Patients removed successfully', 'info');
              }
            } catch (error) {
              console.error('Error in bulk remove:', error);
              this.showNotification('Bulk remove failed', 'error');
            }
          }
        },

        async bulkAssignProvider() {
          if (this.selectedPatients.length === 0) return;
          
          const providerId = prompt('Enter provider ID to assign:');
          if (!providerId) return;
          
          try {
            const result = await window.cashierAPI.bulkAssignProvider(this.selectedPatients, providerId);
            if (result.success) {
              await this.loadQueueData();
              this.selectedPatients = [];
              this.showBulkActions = false;
              this.showNotification('Provider assigned successfully', 'success');
            }
          } catch (error) {
            console.error('Error in bulk assign:', error);
            this.showNotification('Bulk assign failed', 'error');
          }
        },

        async assignProvider(patientId, providerId) {
          try {
            const result = await window.cashierAPI.assignPatientToProvider(patientId, providerId);
            if (result.success) {
              await this.loadQueueData();
              this.showNotification('Provider assigned successfully', 'success');
            }
          } catch (error) {
            console.error('Error assigning provider:', error);
            this.showNotification('Failed to assign provider', 'error');
          }
        },

        async updatePriority(patientId, priority) {
          try {
            const result = await window.cashierAPI.updatePatientPriority(patientId, priority);
            if (result.success) {
              await this.loadQueueData();
              this.showNotification('Priority updated successfully', 'success');
              if (priority === 'emergency') {
                this.playQueueSound('emergency');
              }
            }
          } catch (error) {
            console.error('Error updating priority:', error);
            this.showNotification('Failed to update priority', 'error');
          }
        },

        async addToEmergencyQueue() {
          // Similar to addToQueue but for emergency
          this.showAddPatientModal = true;
          this.newPatient.priority = 'emergency';
        },

        async exportQueue(format = 'pdf') {
          try {
            const blob = await window.cashierAPI.exportQueue(format, this.filters);
            const url = window.URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `queue-export.${format}`;
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            window.URL.revokeObjectURL(url);
            this.showNotification('Queue exported successfully', 'success');
          } catch (error) {
            console.error('Error exporting queue:', error);
            this.showNotification('Export failed', 'error');
          }
        },

        async printDailyReport() {
          try {
            const reportData = {
              date: new Date().toISOString().split('T')[0],
              stats: this.stats,
              currentQueue: this.currentQueue,
              completedQueue: this.completedQueue,
              emergencyQueue: this.emergencyQueue,
              settings: this.queueSettings,
              analytics: this.analytics
            };
            
            const result = await window.cashierAPI.printDailyReport(reportData.date);
            if (result.success) {
              this.showNotification('Daily report sent to printer successfully', 'success');
              
              // Also create a downloadable version
              this.createDailyReportPDF(reportData);
            } else {
              this.showNotification('Failed to print daily report', 'error');
            }
          } catch (error) {
            console.error('Error printing daily report:', error);
            this.showNotification('Failed to print daily report', 'error');
          }
        },

        createDailyReportPDF(reportData) {
          // Create a simple HTML report for download
          const reportHTML = `
            <!DOCTYPE html>
            <html>
            <head>
              <title>Daily Queue Report - ${reportData.date}</title>
              <style>
                body { font-family: Arial, sans-serif; margin: 20px; }
                .header { text-align: center; margin-bottom: 30px; }
                .stats { display: grid; grid-template-columns: repeat(4, 1fr); gap: 20px; margin-bottom: 30px; }
                .stat-card { border: 1px solid #ddd; padding: 15px; border-radius: 8px; text-align: center; }
                .section { margin-bottom: 30px; }
                table { width: 100%; border-collapse: collapse; margin-bottom: 20px; }
                th, td { border: 1px solid #ddd; padding: 8px; text-align: left; }
                th { background-color: #f5f5f5; }
                .priority-emergency { color: #ef4444; font-weight: bold; }
                .priority-urgent { color: #f59e0b; font-weight: bold; }
                .priority-normal { color: #22c55e; }
              </style>
            </head>
            <body>
              <div class="header">
                <h1>Umi Health - Daily Queue Report</h1>
                <p>Date: ${reportData.date}</p>
                <p>Generated: ${new Date().toLocaleString()}</p>
              </div>
              
              <div class="stats">
                <div class="stat-card">
                  <h3>Currently Waiting</h3>
                  <p style="font-size: 24px; font-weight: bold;">${reportData.stats.waitingCount}</p>
                </div>
                <div class="stat-card">
                  <h3>Now Serving</h3>
                  <p style="font-size: 24px; font-weight: bold;">${reportData.stats.servingCount}</p>
                </div>
                <div class="stat-card">
                  <h3>Completed Today</h3>
                  <p style="font-size: 24px; font-weight: bold;">${reportData.stats.completedCount}</p>
                </div>
                <div class="stat-card">
                  <h3>Avg Wait Time</h3>
                  <p style="font-size: 24px; font-weight: bold;">${reportData.stats.averageWaitTime} min</p>
                  <p>Target: ${reportData.settings.targetWaitTime} min</p>
                </div>
              </div>
              
              <div class="section">
                <h2>Current Queue</h2>
                <table>
                  <thead>
                    <tr>
                      <th>Queue #</th>
                      <th>Patient Name</th>
                      <th>Priority</th>
                      <th>Wait Time</th>
                      <th>Status</th>
                    </tr>
                  </thead>
                  <tbody>
                    ${reportData.currentQueue.map(patient => `
                      <tr>
                        <td>${patient.queueNumber}</td>
                        <td>${patient.name}</td>
                        <td class="priority-${patient.priority}">${patient.priority.toUpperCase()}</td>
                        <td>${this.calculateWaitTime(patient.joinTime)} min</td>
                        <td>${patient.status}</td>
                      </tr>
                    `).join('')}
                  </tbody>
                </table>
              </div>
              
              <div class="section">
                <h2>Emergency Queue</h2>
                <table>
                  <thead>
                    <tr>
                      <th>Queue #</th>
                      <th>Patient Name</th>
                      <th>Complaint</th>
                      <th>Wait Time</th>
                    </tr>
                  </thead>
                  <tbody>
                    ${reportData.emergencyQueue.map(patient => `
                      <tr class="priority-emergency">
                        <td>${patient.queueNumber}</td>
                        <td>${patient.name}</td>
                        <td>${patient.complaint}</td>
                        <td>${this.calculateWaitTime(patient.joinTime)} min</td>
                      </tr>
                    `).join('')}
                  </tbody>
                </table>
              </div>
              
              <div class="section">
                <h2>Performance Summary</h2>
                <p><strong>Target Wait Time:</strong> ${reportData.settings.targetWaitTime} minutes</p>
                <p><strong>Actual Average Wait Time:</strong> ${reportData.stats.averageWaitTime} minutes</p>
                <p><strong>Performance:</strong> ${parseFloat(reportData.stats.averageWaitTime) <= reportData.settings.targetWaitTime ? '✅ On Target' : '⚠️ Above Target'}</p>
                <p><strong>Auto-Escalation Threshold:</strong> ${reportData.settings.autoEscalateWaitTime} minutes</p>
                <p><strong>Max Queue Size:</strong> ${reportData.settings.maxQueueSize} patients</p>
              </div>
            </body>
            </html>
          `;
          
          // Create download link
          const blob = new Blob([reportHTML], { type: 'text/html' });
          const url = window.URL.createObjectURL(blob);
          const a = document.createElement('a');
          a.href = url;
          a.download = `queue-report-${reportData.date}.html`;
          document.body.appendChild(a);
          a.click();
          document.body.removeChild(a);
          window.URL.revokeObjectURL(url);
        },

        calculateWaitTime(joinTime) {
          const now = Date.now();
          const join = new Date(joinTime).getTime();
          return Math.round((now - join) / (1000 * 60)); // Convert to minutes
        },

        async printQueueSlip(patientId) {
          try {
            const result = await window.cashierAPI.printQueueSlip(patientId);
            if (result.success) {
              this.showNotification('Queue slip printed successfully', 'success');
            }
          } catch (error) {
            console.error('Error printing queue slip:', error);
            this.showNotification('Print failed', 'error');
          }
        },

        async sendNotification(patientId, type = 'sms') {
          const message = prompt(`Enter ${type.toUpperCase()} message:`);
          if (!message) return;
          
          try {
            const result = type === 'sms' 
              ? await window.cashierAPI.sendSMSNotification(patientId, message)
              : await window.cashierAPI.sendWhatsAppNotification(patientId, message);
              
            if (result.success) {
              this.showNotification(`${type.toUpperCase()} sent successfully`, 'success');
            }
          } catch (error) {
            console.error(`Error sending ${type}:`, error);
            this.showNotification(`Failed to send ${type}`, 'error');
          }
        },

        async updateSoundSettings() {
          try {
            await window.cashierAPI.setSoundVolume(this.soundVolume);
            this.showNotification('Sound settings updated', 'success');
          } catch (error) {
            console.error('Error updating sound settings:', error);
            this.showNotification('Failed to update sound settings', 'error');
          }
        },

        async updateNotificationSettings() {
          try {
            await window.cashierAPI.updateNotificationSettings(this.notificationSettings);
            this.showNotification('Notification settings updated', 'success');
          } catch (error) {
            console.error('Error updating notification settings:', error);
            this.showNotification('Failed to update notification settings', 'error');
          }
        },

        async updateQueueSettings() {
          try {
            // Save queue settings to localStorage for persistence
            localStorage.setItem('umi_queue_settings', JSON.stringify(this.queueSettings));
            
            // Check if we need to escalate any patients based on new settings
            await this.checkWaitTimeEscalation();
            
            this.showNotification('Queue settings updated', 'success');
          } catch (error) {
            console.error('Error updating queue settings:', error);
            this.showNotification('Failed to update queue settings', 'error');
          }
        },

        async checkWaitTimeEscalation() {
          if (!this.queueSettings.enableAutoNotifications) return;
          
          const now = Date.now();
          const escalationThreshold = this.queueSettings.autoEscalateWaitTime * 60 * 1000; // Convert to milliseconds
          
          for (const patient of this.currentQueue) {
            if (patient.status === 'waiting') {
              const waitTime = now - new Date(patient.joinTime).getTime();
              if (waitTime > escalationThreshold && patient.priority !== 'emergency') {
                // Auto-escalate to urgent priority
                await this.updatePriority(patient.id, 'urgent');
                this.showNotification(`Auto-escalated ${patient.name} to urgent priority`, 'warning');
              }
            }
          }
        },

        // Drag and drop functionality
        startDrag(event, index) {
          this.dragStartIndex = index;
          event.dataTransfer.effectAllowed = 'move';
        },

        allowDrop(event) {
          event.preventDefault();
        },

        drop(event, dropIndex) {
          event.preventDefault();
          if (this.dragStartIndex !== null && this.dragStartIndex !== dropIndex) {
            const draggedPatient = this.currentQueue[this.dragStartIndex];
            this.currentQueue.splice(this.dragStartIndex, 1);
            this.currentQueue.splice(dropIndex, 0, draggedPatient);
            
            // Update positions in backend
            this.updateQueuePosition(draggedPatient.id, dropIndex + 1);
          }
          this.dragStartIndex = null;
        },

        async updateQueuePosition(patientId, newPosition) {
          try {
            await window.cashierAPI.updateQueuePosition(patientId, newPosition);
          } catch (error) {
            console.error('Error updating queue position:', error);
          }
        },

        showNotification(message, type = 'info') {
          const notification = document.createElement('div');
          notification.className = `notification notification-${type}`;
          notification.textContent = message;
          notification.style.cssText = `
            position: fixed;
            top: 20px;
            right: 20px;
            padding: 1rem 1.5rem;
            border-radius: 8px;
            color: white;
            font-weight: 500;
            z-index: 10000;
            transform: translateX(100%);
            transition: transform 0.3s ease;
            ${type === 'success' ? 'background: #22c55e;' : ''}
            ${type === 'error' ? 'background: #ef4444;' : ''}
            ${type === 'info' ? 'background: #3b82f6;' : ''}
          `;
          
          document.body.appendChild(notification);
          
          setTimeout(() => {
            notification.style.transform = 'translateX(0)';
          }, 100);
          
          setTimeout(() => {
            notification.style.transform = 'translateX(100%)';
            setTimeout(() => {
              document.body.removeChild(notification);
            }, 300);
          }, 3000);
        },

        logout() {
          window.cashierAPI.logout()
            .then(() => {
              window.location.href = '../public/admin-signin.html';
            })
            .catch(error => {
              console.error('Logout error:', error);
              window.location.href = '../public/admin-signin.html';
            });
        }
      }
    }
  </script>

  <!-- Include API and Data Manager -->
  <script src="js/cashier-api.js"></script>
  <script src="js/data-manager.js"></script>

  <script defer src="https://cdn.jsdelivr.net/npm/alpinejs@3.x.x/dist/cdn.min.js"></script>
</body>
</html>
