<!DOCTYPE html>
<html lang="en" x-data="prescriptionsSystem()" x-init="init()">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Prescriptions - Umi Health Information Systems</title>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@100;400;500;600;700&family=Varela+Round&family=Nunito:wght@400;600;700&display=swap" rel="stylesheet">
  <link href="https://fonts.googleapis.com/css2?family=Material+Symbols+Rounded:wght@300;400;500;600;700&display=swap" rel="stylesheet">
  <script src="https://cdn.tailwindcss.com"></script>
  <style>
    :root {
      --color-primary: #000000;
      --color-accent: #14B8A6;
      --color-success: #22c55e;
      --color-warning: #ef4444;
      --color-text-primary: #000000;
      --color-text-secondary: #6b7280;
      --color-text-muted: #9ca3af;
      --color-background: #ffffff;
      --color-surface: #f9fafb;
      --color-border: #e5e7eb;
      --font-primary: 'Inter', sans-serif;
      --sidebar-width: 280px;
    }

    * {
      box-sizing: border-box;
      margin: 0;
      padding: 0;
    }

    body {
      background: var(--color-background);
      color: var(--color-text-primary);
      font-family: 'Nunito', 'Varela Round', sans-serif;
      font-size: 13px;
      line-height: 1.4;
      overflow-x: hidden;
    }

    /* Sidebar Styles */
    .sidebar {
      position: fixed;
      left: 0;
      top: 0;
      width: var(--sidebar-width);
      height: 100vh;
      background: var(--color-text-primary);
      color: var(--color-accent);
      z-index: 1000;
      transition: transform 0.3s ease;
      display: flex;
      flex-direction: column;
      overflow-y: auto;
      overflow-x: hidden;
    }

    .sidebar-header {
      padding: 1.5rem;
      border-bottom: 1px solid rgba(255, 255, 255, 0.1);
    }

    .logo-section {
      display: flex;
      align-items: center;
      gap: 0.75rem;
    }

    .logo-icon {
      width: 32px;
      height: 32px;
      background: rgba(255, 255, 255, 0.2);
      border-radius: 8px;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 1.2rem;
    }

    .logo-text {
      font-size: 1rem;
      font-weight: 600;
      font-family: 'Inter', sans-serif;
    }

    .nav-menu {
      padding: 1rem 0;
      flex: 1;
      overflow-y: auto;
    }

    .nav-item {
      display: flex;
      align-items: center;
      gap: 0.75rem;
      padding: 0.75rem 1.25rem;
      color: rgba(255, 255, 255, 0.8);
      text-decoration: none;
      transition: all 0.2s ease;
      cursor: pointer;
      font-size: 0.8rem;
      font-weight: 500;
    }

    .nav-item:hover {
      background: rgba(255, 255, 255, 0.1);
      color: var(--color-accent);
    }

    .nav-item.active {
      background: rgba(255, 255, 255, 0.15);
      color: var(--color-accent);
      border-left: 3px solid var(--color-accent);
    }

    .nav-icon {
      font-size: 1rem;
    }

    /* Main Content Area */
    .main-content {
      margin-left: var(--sidebar-width);
      min-height: 100vh;
      transition: margin-left 0.3s ease;
    }

    /* Header Styles */
    .header {
      background: white;
      border-bottom: 1px solid #e2e8f0;
      padding: 1rem 2rem;
      display: flex;
      justify-content: space-between;
      align-items: center;
      position: sticky;
      top: 0;
      z-index: 100;
    }

    .header-left {
      display: flex;
      align-items: center;
      gap: 1rem;
    }

    .page-title {
      font-size: 1.25rem;
      font-weight: 600;
      color: var(--color-text-primary);
      margin: 0;
      font-family: 'Inter', sans-serif;
    }

    .mobile-menu-toggle {
      display: none;
      background: none;
      border: none;
      font-size: 1.25rem;
      color: var(--color-text-secondary);
      cursor: pointer;
    }

    /* Prescriptions Content */
    .prescriptions-content {
      padding: 1.25rem;
      max-width: 1400px;
      margin: 0 auto;
      font-size: 13px;
    }

    /* Advanced Filter Section */
    .filter-section {
      background: var(--color-surface);
      border-radius: 12px;
      padding: 0.875rem;
      margin-bottom: 1.25rem;
      border: 1px solid var(--color-border);
      font-size: 13px;
    }

    .filter-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
      gap: 1rem;
      align-items: end;
    }

    /* Status Badge */
    .status-badge {
      padding: 0.25rem 0.5rem;
      border-radius: 8px;
      font-size: 0.625rem;
      font-weight: 600;
      display: inline-flex;
      align-items: center;
      gap: 0.25rem;
    }

    .status-badge.submitted {
      background: rgba(107, 114, 128, 0.1);
      color: #6b7280;
    }

    .status-badge.pending {
      background: rgba(251, 191, 36, 0.1);
      color: #d97706;
    }

    .status-badge.verified {
      background: rgba(59, 130, 246, 0.1);
      color: #2563eb;
    }

    .status-badge.filling {
      background: rgba(251, 191, 36, 0.1);
      color: #d97706;
    }

    .status-badge.filled {
      background: rgba(34, 197, 94, 0.1);
      color: #16a34a;
    }

    .status-badge.ready-for-pickup {
      background: rgba(16, 185, 129, 0.1);
      color: #059669;
    }

    .status-badge.dispensed {
      background: rgba(16, 185, 129, 0.1);
      color: #059669;
    }

    .status-badge.completed {
      background: rgba(107, 114, 128, 0.1);
      color: #6b7280;
    }

    .status-badge.on-hold {
      background: rgba(251, 146, 60, 0.1);
      color: #ea580c;
    }

    .status-badge.cancelled {
      background: rgba(239, 68, 68, 0.1);
      color: #dc2626;
    }

    .status-badge.requires-verification {
      background: rgba(168, 85, 247, 0.1);
      color: #9333ea;
    }

    /* Priority Badge */
    .priority-badge {
      padding: 0.25rem 0.375rem;
      border-radius: 6px;
      font-size: 0.5rem;
      font-weight: 700;
      text-transform: uppercase;
    }

    .priority-high {
      background: #fee2e2;
      color: #dc2626;
    }

    .priority-medium {
      background: #fed7aa;
      color: #ea580c;
    }

    .priority-low {
      background: #dbeafe;
      color: #2563eb;
    }

    /* Prescription Cards */
    .prescriptions-grid {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
      gap: 1rem;
      margin-bottom: 1.5rem;
    }

    .prescription-card {
      background: white;
      border-radius: 10px;
      padding: 0.875rem;
      border: 1px solid var(--color-border);
      box-shadow: 0 1px 3px rgba(0, 0, 0, 0.04);
      transition: all 0.3s ease;
      cursor: pointer;
    }

    .prescription-card:hover {
      transform: translateY(-1px);
      box-shadow: 0 4px 12px rgba(0, 0, 0, 0.08);
    }

    .prescription-header {
      display: flex;
      justify-content: space-between;
      align-items: flex-start;
      margin-bottom: 0.75rem;
    }

    .prescription-id {
      font-size: 0.625rem;
      color: var(--color-text-secondary);
      font-weight: 500;
    }

    .prescription-patient {
      font-size: 0.875rem;
      font-weight: 600;
      color: var(--color-text-primary);
      margin-bottom: 0.125rem;
    }

    .prescription-date {
      font-size: 0.5rem;
      color: var(--color-text-muted);
    }

    .prescription-medications {
      margin: 1rem 0;
    }

    .medication-item {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 0.5rem 0;
      border-bottom: 1px solid #f3f4f6;
    }

    .medication-item:last-child {
      border-bottom: none;
    }

    .medication-name {
      font-weight: 500;
      color: var(--color-text-primary);
    }

    .medication-dosage {
      font-size: 0.75rem;
      color: var(--color-text-secondary);
    }

    .prescription-actions {
      display: flex;
      gap: 0.5rem;
      margin-top: 1rem;
    }

    .btn-small {
      padding: 0.25rem 0.5rem;
      font-size: 0.625rem;
    }

    /* Table View */
    .table-container {
      background: white;
      border-radius: 12px;
      border: 1px solid var(--color-border);
      overflow: hidden;
      box-shadow: 0 1px 6px rgba(0, 0, 0, 0.04);
    }

    .prescriptions-table {
      width: 100%;
      border-collapse: collapse;
    }

    .prescriptions-table th {
      background: var(--color-surface);
      padding: 0.75rem;
      text-align: left;
      font-weight: 600;
      color: var(--color-text-primary);
      font-size: 0.75rem;
      border-bottom: 1px solid var(--color-border);
    }

    .prescriptions-table td {
      padding: 0.75rem;
      border-bottom: 1px solid #f3f4f6;
      font-size: 0.75rem;
    }

    .prescriptions-table tbody tr:hover {
      background: #fafafa;
    }

    /* Spreadsheet Table Styles */
    .spreadsheet-table {
      width: 100%;
      border-collapse: collapse;
      background: white;
      border-radius: 8px;
      overflow: hidden;
      box-shadow: 0 1px 4px rgba(0, 0, 0, 0.04);
    }

    .spreadsheet-table th {
      background: var(--color-surface);
      padding: 0.5rem;
      text-align: left;
      font-weight: 600;
      color: var(--color-text-primary);
      border-bottom: 2px solid var(--color-border);
      font-size: 0.625rem;
    }

    .spreadsheet-table td {
      padding: 0.5rem;
      border-bottom: 1px solid var(--color-border);
      font-size: 0.625rem;
      vertical-align: top;
    }

    .spreadsheet-table .table-row {
      cursor: pointer;
      transition: background-color 0.2s ease;
    }

    .spreadsheet-table .table-row:hover {
      background: var(--color-surface);
    }

    .spreadsheet-table .rx-number {
      font-family: monospace;
      font-weight: 600;
      color: var(--color-primary);
    }

    .spreadsheet-table .patient-name {
      font-weight: 500;
    }

    .action-buttons {
      display: flex;
      gap: 0.25rem;
      flex-wrap: wrap;
    }

    /* Modal Styles */
    .modal-overlay {
      position: fixed;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background: rgba(0, 0, 0, 0.5);
      display: flex;
      align-items: center;
      justify-content: center;
      z-index: 1000;
    }

    .modal-content {
      background: white;
      border-radius: 12px;
      padding: 1.25rem;
      max-width: 600px;
      width: 90%;
      max-height: 90vh;
      overflow-y: auto;
      font-size: 12px;
    }

    .modal-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 1rem;
    }

    .modal-title {
      font-size: 0.875rem;
      font-weight: 600;
      color: var(--color-text-primary);
    }

    .modal-close {
      background: none;
      border: none;
      font-size: 0.875rem;
      color: var(--color-text-secondary);
      cursor: pointer;
      padding: 0.25rem;
    }

    /* Button Styles */
    .btn {
      padding: 0.375rem 0.875rem;
      border-radius: 6px;
      font-size: 0.625rem;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.3s ease;
      border: none;
      display: inline-flex;
      align-items: center;
      gap: 0.25rem;
      text-decoration: none;
    }

    .btn-primary {
      background: var(--color-primary);
      color: var(--color-accent);
    }

    .btn-primary:hover {
      background: #333;
      transform: translateY(-0.5px);
    }

    .btn-secondary {
      background: var(--color-surface);
      color: var(--color-text-secondary);
      border: 1px solid var(--color-border);
    }

    .btn-secondary:hover {
      background: var(--color-border);
    }

    .btn-success {
      background: var(--color-success);
      color: white;
    }

    .btn-success:hover {
      background: #16a34a;
    }

    .btn-danger {
      background: var(--color-warning);
      color: white;
    }

    .btn-danger:hover {
      background: #dc2626;
    }

    .btn-small {
      padding: 0.25rem 0.5rem;
      font-size: 0.625rem;
    }

    
    /* Popup Styles */
    .popup-overlay {
      position: fixed;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background: rgba(0, 0, 0, 0.5);
      display: flex;
      align-items: center;
      justify-content: center;
      z-index: 1000;
    }

    .popup-content {
      background: white;
      border-radius: 10px;
      padding: 0.875rem;
      max-width: 500px;
      width: 90%;
      max-height: 80vh;
      overflow-y: auto;
      box-shadow: 0 8px 20px rgba(0, 0, 0, 0.15);
      font-size: 12px;
    }

    .popup-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 0.75rem;
      padding-bottom: 0.5rem;
      border-bottom: 1px solid var(--color-border);
    }

    .popup-title {
      font-size: 0.875rem;
      font-weight: 600;
      color: var(--color-text-primary);
    }

    .popup-close {
      background: none;
      border: none;
      font-size: 0.875rem;
      color: var(--color-text-secondary);
      cursor: pointer;
      padding: 0.25rem;
    }

    .popup-body {
      margin-bottom: 0.5rem;
      font-size: 12px;
    }

    .popup-footer {
      display: flex;
      gap: 0.5rem;
      justify-content: flex-end;
      padding-top: 0.5rem;
      border-top: 1px solid var(--color-border);
    }

    /* Search Suggestions */
    .search-suggestions {
      position: absolute;
      top: 100%;
      left: 0;
      right: 0;
      background: white;
      border: 1px solid var(--color-border);
      border-top: none;
      border-radius: 0 0 8px 8px;
      max-height: 200px;
      overflow-y: auto;
      z-index: 100;
    }

    .suggestion-item {
      padding: 0.375rem 0.5rem;
      cursor: pointer;
      font-size: 0.75rem;
      border-bottom: 1px solid #f3f4f6;
    }

    .suggestion-item:hover {
      background: var(--color-surface);
    }

    .suggestion-item:last-child {
      border-bottom: none;
    }

    /* Signature Box Styles */
    .signature-box {
      border: 1px solid #e5e7eb;
      border-radius: 6px;
      background: white;
      padding: 0.75rem;
    }

    .signature-box canvas {
      display: block;
      max-width: 100%;
      height: auto;
    }

    .signature-box .mt-2 {
      margin-top: 0.5rem;
      display: flex;
      gap: 0.5rem;
    }

    /* Form Grid for better organization */
    .form-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
      gap: 1rem;
    }

    .form-group {
      display: flex;
      flex-direction: column;
    }

    .form-group.full-width {
      grid-column: 1 / -1;
    }

    .form-label {
      font-size: 0.75rem;
      font-weight: 500;
      color: var(--color-text-primary);
      margin-bottom: 0.25rem;
    }

    .form-input {
      padding: 0.375rem 0.5rem;
      border: 1px solid var(--color-border);
      border-radius: 4px;
      font-size: 0.75rem;
      transition: border-color 0.2s ease;
    }

    .form-input:focus {
      outline: none;
      border-color: var(--color-primary);
      box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.1);
    }

    .form-select {
      padding: 0.375rem 0.5rem;
      border: 1px solid var(--color-border);
      border-radius: 4px;
      font-size: 0.75rem;
      background: white;
      transition: border-color 0.2s ease;
    }

    .form-select:focus {
      outline: none;
      border-color: var(--color-primary);
      box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.1);
    }

    .form-textarea {
      resize: vertical;
      min-height: 60px;
    }

    .mb-6 {
      margin-bottom: 1.5rem;
    }

    .text-lg {
      font-size: 1rem;
      font-weight: 600;
      color: var(--color-primary);
    }

    /* View Toggle */
    .view-toggle {
      display: flex;
      gap: 0.5rem;
      background: var(--color-surface);
      padding: 0.25rem;
      border-radius: 12px;
    }

    .view-btn {
      padding: 0.375rem 0.75rem;
      border: none;
      background: transparent;
      color: var(--color-text-secondary);
      border-radius: 6px;
      cursor: pointer;
      transition: all 0.2s ease;
      font-size: 0.75rem;
      font-weight: 500;
    }

    .view-btn.active {
      background: white;
      color: var(--color-primary);
      box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
    }

    /* Stats Cards */
    .stats-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(160px, 1fr));
      gap: 0.75rem;
      margin-bottom: 1.5rem;
    }

    .stat-card {
      background: white;
      border-radius: 8px;
      padding: 0.75rem;
      border: 1px solid var(--color-border);
      box-shadow: 0 1px 3px rgba(0, 0, 0, 0.04);
      font-size: 13px;
    }

    .stat-label {
      font-size: 0.625rem;
      color: var(--color-text-secondary);
      margin-bottom: 0.25rem;
    }

    .stat-value {
      font-size: 1rem;
      font-weight: 700;
      color: var(--color-text-primary);
    }

    .stat-change {
      font-size: 0.5rem;
      margin-top: 0.25rem;
    }

    .stat-change.positive {
      color: var(--color-success);
    }

    .stat-change.negative {
      color: var(--color-warning);
    }

    /* Logout Section */
    .logout-section {
      padding: 1rem;
      border-top: 1px solid rgba(255, 255, 255, 0.1);
      margin-top: auto;
    }

    .logout-button {
      display: flex;
      align-items: center;
      gap: 0.75rem;
      padding: 0.75rem 1.25rem;
      color: rgba(255, 255, 255, 0.8);
      text-decoration: none;
      transition: all 0.2s ease;
      cursor: pointer;
      font-size: 0.8rem;
      font-weight: 500;
      width: 100%;
      border: none;
      background: transparent;
      text-align: left;
    }

    .logout-button:hover {
      background: rgba(239, 68, 68, 0.1);
      color: var(--color-warning);
    }

    /* Clinical Decision Support Alerts */
    .cds-alert {
      padding: 0.5rem;
      border-radius: 6px;
      margin: 0.375rem 0;
      display: flex;
      align-items: flex-start;
      gap: 0.375rem;
      font-size: 0.75rem;
    }

    .cds-alert.critical {
      background: rgba(239, 68, 68, 0.1);
      border: 1px solid rgba(239, 68, 68, 0.3);
      color: #dc2626;
    }

    .cds-alert.warning {
      background: rgba(251, 191, 36, 0.1);
      border: 1px solid rgba(251, 191, 36, 0.3);
      color: #d97706;
    }

    .cds-alert.info {
      background: rgba(59, 130, 246, 0.1);
      border: 1px solid rgba(59, 130, 246, 0.3);
      color: #2563eb;
    }

    /* Workflow Timeline */
    .workflow-timeline {
      display: flex;
      align-items: center;
      margin: 1rem 0;
      position: relative;
    }

    .workflow-step {
      flex: 1;
      text-align: center;
      position: relative;
      z-index: 2;
    }

    .workflow-step::before {
      content: '';
      position: absolute;
      top: 20px;
      left: 50%;
      right: -50%;
      height: 2px;
      background: #e5e7eb;
      z-index: -1;
    }

    .workflow-step:last-child::before {
      display: none;
    }

    .workflow-step.completed::before {
      background: var(--color-success);
    }

    .workflow-icon {
      width: 32px;
      height: 32px;
      border-radius: 50%;
      background: #e5e7eb;
      display: flex;
      align-items: center;
      justify-content: center;
      margin: 0 auto 0.375rem;
      font-size: 0.875rem;
    }

    .workflow-step.completed .workflow-icon {
      background: var(--color-success);
      color: white;
    }

    .workflow-step.active .workflow-icon {
      background: var(--color-primary);
      color: var(--color-accent);
    }

    .workflow-label {
      font-size: 0.625rem;
      color: var(--color-text-secondary);
      font-weight: 500;
    }

    /* Insurance Status */
    .insurance-status {
      display: flex;
      align-items: center;
      gap: 0.375rem;
      padding: 0.375rem;
      border-radius: 6px;
      font-size: 0.75rem;
    }

    .insurance-status.approved {
      background: rgba(34, 197, 94, 0.1);
      color: #16a34a;
    }

    .insurance-status.pending {
      background: rgba(251, 191, 36, 0.1);
      color: #d97706;
    }

    .insurance-status.rejected {
      background: rgba(239, 68, 68, 0.1);
      color: #dc2626;
    }

    /* Inventory Status */
    .inventory-status {
      display: flex;
      align-items: center;
      gap: 0.375rem;
      font-size: 0.75rem;
    }

    .inventory-status.in-stock {
      color: var(--color-success);
    }

    .inventory-status.low-stock {
      color: #d97706;
    }

    .inventory-status.out-of-stock {
      color: var(--color-warning);
    }

    /* Patient Risk Factors */
    .risk-factors {
      display: flex;
      flex-wrap: wrap;
      gap: 0.5rem;
      margin: 0.5rem 0;
    }

    .risk-tag {
      padding: 0.125rem 0.375rem;
      border-radius: 4px;
      font-size: 0.625rem;
      font-weight: 500;
      background: rgba(251, 146, 60, 0.1);
      color: #ea580c;
    }

    /* Action Buttons */
    .action-buttons {
      display: flex;
      gap: 0.5rem;
      flex-wrap: wrap;
    }

    .action-btn {
      padding: 0.375rem 0.75rem;
      border-radius: 6px;
      border: none;
      font-size: 0.75rem;
      font-weight: 500;
      cursor: pointer;
      transition: all 0.2s ease;
      display: inline-flex;
      align-items: center;
      gap: 0.125rem;
    }

    .action-btn.primary {
      background: var(--color-primary);
      color: var(--color-accent);
    }

    .action-btn.secondary {
      background: var(--color-surface);
      color: var(--color-text-secondary);
      border: 1px solid var(--color-border);
    }

    .action-btn.success {
      background: var(--color-success);
      color: white;
    }

    .action-btn.warning {
      background: #f59e0b;
      color: white;
    }

    .action-btn.danger {
      background: var(--color-warning);
      color: white;
    }

    /* Compounding Section */
    .compounding-section {
      background: #f8fafc;
      border: 1px solid #e2e8f0;
      border-radius: 6px;
      padding: 0.75rem;
      margin: 0.75rem 0;
    }

    .compound-ingredient {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 0.5rem 0;
      border-bottom: 1px solid #e2e8f0;
    }

    .compound-ingredient:last-child {
      border-bottom: none;
    }

    /* Med Sync Badge */
    .med-sync-badge {
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      color: white;
      padding: 0.125rem 0.5rem;
      border-radius: 8px;
      font-size: 0.625rem;
      font-weight: 600;
      display: inline-flex;
      align-items: center;
      gap: 0.125rem;
    }

    /* Quick Actions Panel */
    .quick-actions {
      position: fixed;
      right: 1.5rem;
      top: 50%;
      transform: translateY(-50%);
      background: rgba(0, 0, 0, 0.3);
      backdrop-filter: blur(10px);
      -webkit-backdrop-filter: blur(10px);
      border: 1px solid rgba(255, 255, 255, 0.1);
      border-radius: 12px;
      padding: 0.75rem;
      box-shadow: 0 6px 24px rgba(0, 0, 0, 0.3);
      z-index: 100;
      display: flex;
      flex-direction: column;
      gap: 0.375rem;
      transition: all 0.3s ease;
      cursor: move;
      opacity: 0.4;
    }

    .quick-actions:hover {
      opacity: 1;
      background: rgba(0, 0, 0, 0.4);
    }

    .quick-actions.dragging {
      opacity: 1;
      transform: translateY(-50%) scale(1.05);
    }

    .quick-action-btn {
      width: 40px;
      height: 40px;
      border-radius: 50%;
      border: none;
      background: rgba(255, 255, 255, 0.1);
      backdrop-filter: blur(5px);
      color: white;
      cursor: pointer;
      transition: all 0.2s ease;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 1rem;
    }

    .quick-action-btn:hover {
      background: rgba(255, 255, 255, 0.2);
      color: var(--color-primary);
      transform: scale(1.1);
    }

    /* Responsive Design */
    @media (max-width: 1200px) {
      .spreadsheet-table th {
        font-size: 0.625rem;
        padding: 0.5rem;
      }
      
      .spreadsheet-table td {
        font-size: 0.625rem;
        padding: 0.5rem;
      }
    }

    /* Demo Mode Banner */
    .demo-banner {
      position: fixed;
      top: 0;
      left: 0;
      right: 0;
      background: linear-gradient(90deg, #667eea 0%, #764ba2 100%);
      color: white;
      padding: 0.5rem 1rem;
      text-align: center;
      font-size: 0.875rem;
      font-weight: 500;
      z-index: 10001;
      box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
    }

    .demo-banner .close-btn {
      position: absolute;
      right: 1rem;
      top: 50%;
      transform: translateY(-50%);
      background: none;
      border: none;
      color: white;
      font-size: 1.25rem;
      cursor: pointer;
      opacity: 0.8;
      transition: opacity 0.2s;
    }

    .demo-banner .close-btn:hover {
      opacity: 1;
    }

    @media (max-width: 768px) {
      .sidebar {
        transform: translateX(-100%);
      }

      .sidebar.open {
        transform: translateX(0);
      }

      .main-content {
        margin-left: 0;
      }

      .mobile-menu-toggle {
        display: block;
      }

      .prescriptions-content {
        padding: 1rem;
      }

      .stats-grid {
        grid-template-columns: repeat(2, 1fr);
      }

      .filter-grid {
        grid-template-columns: 1fr;
      }

      .spreadsheet-table {
        font-size: 0.75rem;
      }

      .spreadsheet-table th {
        font-size: 0.625rem;
        padding: 0.375rem;
        white-space: nowrap;
      }

      .spreadsheet-table td {
        padding: 0.375rem;
        font-size: 0.625rem;
      }

      .spreadsheet-table .rx-number {
        font-size: 0.625rem;
      }

      .spreadsheet-table .patient-name {
        font-size: 0.625rem;
      }

      .status-badge, .priority-badge {
        font-size: 0.5rem;
        padding: 0.125rem 0.375rem;
      }

      .insurance-status, .inventory-status {
        font-size: 0.5rem;
      }

      .insurance-status .material-symbols-rounded,
      .inventory-status .material-symbols-rounded {
        font-size: 0.75rem;
      }

      /* Hide less important columns on mobile */
      .spreadsheet-table th:nth-child(7),
      .spreadsheet-table th:nth-child(8),
      .spreadsheet-table th:nth-child(9),
      .spreadsheet-table td:nth-child(7),
      .spreadsheet-table td:nth-child(8),
      .spreadsheet-table td:nth-child(9) {
        display: none;
      }
    }

    @media (max-width: 480px) {
      .stats-grid {
        grid-template-columns: 1fr;
      }

      .spreadsheet-table th {
        font-size: 0.5rem;
        padding: 0.25rem;
      }

      .spreadsheet-table td {
        padding: 0.25rem;
        font-size: 0.5rem;
      }

      /* Hide more columns on very small screens */
      .spreadsheet-table th:nth-child(5),
      .spreadsheet-table th:nth-child(6),
      .spreadsheet-table td:nth-child(5),
      .spreadsheet-table td:nth-child(6) {
        display: none;
      }

      .quick-actions {
        right: 1rem;
        padding: 0.5rem;
      }

      .quick-action-btn {
        width: 40px;
        height: 40px;
        font-size: 1rem;
      }
    }
  </style>
</head>
<body>
  <!-- Sidebar -->
  <aside class="sidebar" :class="sidebarOpen ? 'open' : ''">
    <div class="sidebar-header">
      <div class="logo-section">
        <div class="logo-icon">
          <span class="material-symbols-rounded">medication</span>
        </div>
        <div class="logo-text">Umi Health</div>
      </div>
    </div>

    <nav class="nav-menu">
      <a href="home.html" class="nav-item">
        <span class="material-symbols-rounded nav-icon">home</span>
        <span>Home</span>
      </a>
      <a href="patients.html" class="nav-item">
        <span class="material-symbols-rounded nav-icon">people</span>
        <span>Patients</span>
      </a>
      <a href="prescriptions.html" class="nav-item active">
        <span class="material-symbols-rounded nav-icon">prescriptions</span>
        <span>Prescriptions</span>
      </a>
      <a href="inventory.html" class="nav-item">
        <span class="material-symbols-rounded nav-icon">inventory</span>
        <span>Inventory</span>
      </a>
      <a href="clinical.html" class="nav-item">
        <span class="material-symbols-rounded nav-icon">medical_services</span>
        <span>Clinical</span>
      </a>
      <a href="compliance.html" class="nav-item">
        <span class="material-symbols-rounded nav-icon">verified</span>
        <span>Compliance</span>
      </a>
      <a href="reports.html" class="nav-item">
        <span class="material-symbols-rounded nav-icon">analytics</span>
        <span>Reports</span>
      </a>
      <a href="suppliers.html" class="nav-item">
        <span class="material-symbols-rounded nav-icon">local_shipping</span>
        <span>Suppliers</span>
      </a>
      <a href="help.html" class="nav-item">
        <span class="material-symbols-rounded nav-icon">help</span>
        <span>Help & Training</span>
      </a>
      <a href="account.html" class="nav-item">
        <span class="material-symbols-rounded nav-icon">person</span>
        <span>Account</span>
      </a>
    </nav>
    
    <div class="logout-section">
      <button class="logout-button" @click="logout()">
        <span class="material-symbols-rounded logout-icon">logout</span>
        <span>Logout</span>
      </button>
    </div>
  </aside>

  <!-- Main Content -->
  <main class="main-content">
    <!-- Header -->
    <header class="header">
      <div class="header-left">
        <button class="mobile-menu-toggle" @click="sidebarOpen = !sidebarOpen">
          <span class="material-symbols-rounded">menu</span>
        </button>
        <h1 class="page-title">Prescriptions Management</h1>
      </div>
    </header>

    <!-- Prescriptions Content -->
    <div class="prescriptions-content">
      <!-- Quick Actions Panel -->
      <div class="quick-actions">
        <button class="quick-action-btn" @click="newPrescription" title="New Prescription">
          <span class="material-symbols-rounded">add</span>
        </button>
        <button class="quick-action-btn" @click="scanPrescription" title="Scan Prescription">
          <span class="material-symbols-rounded">qr_code_scanner</span>
        </button>
        <button class="quick-action-btn" @click="patientLookup" title="Patient Lookup">
          <span class="material-symbols-rounded">person_search</span>
        </button>
        <button class="quick-action-btn" @click="drugInteractionCheck" title="Drug Interaction Check">
          <span class="material-symbols-rounded">medication</span>
        </button>
        <button class="quick-action-btn" @click="inventoryCheck" title="Inventory Check">
          <span class="material-symbols-rounded">inventory</span>
        </button>
        <button class="quick-action-btn" @click="compoundingWizard" title="Compounding Wizard">
          <span class="material-symbols-rounded">science</span>
        </button>
        <button class="quick-action-btn" @click="reports" title="Reports">
          <span class="material-symbols-rounded">analytics</span>
        </button>
      </div>
      <!-- Stats Cards -->
      <div class="stats-grid">
        <div class="stat-card">
          <div class="stat-label">Submitted</div>
          <div class="stat-value" x-text="stats.submitted"></div>
          <div class="stat-change positive"></div>
        </div>
        <div class="stat-card">
          <div class="stat-label">Require Verification</div>
          <div class="stat-value" x-text="stats.requiresVerification"></div>
          <div class="stat-change negative"></div>
        </div>
        <div class="stat-card">
          <div class="stat-label">Ready for Dispensing</div>
          <div class="stat-value" x-text="stats.readyForDispensing"></div>
          <div class="stat-change positive"></div>
        </div>
        <div class="stat-card">
          <div class="stat-label">Dispensed Today</div>
          <div class="stat-value" x-text="stats.dispensedToday"></div>
          <div class="stat-change positive"></div>
        </div>
        <div class="stat-card">
          <div class="stat-label">Insurance Pending</div>
          <div class="stat-value" x-text="stats.insurancePending"></div>
          <div class="stat-change negative"></div>
        </div>
        <div class="stat-card">
          <div class="stat-label">Low Stock Alerts</div>
          <div class="stat-value" x-text="stats.lowStockAlerts"></div>
          <div class="stat-change warning"></div>
        </div>
      </div>

      <!-- Filter Section -->
      <div class="filter-section">
        <div class="filter-grid">
          <div class="form-group">
            <label class="form-label">Search</label>
            <input type="text" class="form-input" placeholder="Patient name, RX number, or medication" x-model="filters.search">
          </div>
          <div class="form-group">
            <label class="form-label">Status</label>
            <select class="form-select" x-model="filters.status">
              <option value="">All Status</option>
              <option value="pending">Pending</option>
              <option value="submitted">Submitted</option>
              <option value="requires-verification">Requires Verification</option>
              <option value="verified">Verified</option>
              <option value="filling">Filling</option>
              <option value="filled">Filled</option>
              <option value="ready-for-pickup">Ready for Pickup</option>
              <option value="dispensed">Dispensed</option>
              <option value="completed">Completed</option>
              <option value="on-hold">On Hold</option>
              <option value="cancelled">Cancelled</option>
            </select>
          </div>
          <div class="form-group">
            <label class="form-label">Priority</label>
            <select class="form-select" x-model="filters.priority">
              <option value="">All Priorities</option>
              <option value="high">High</option>
              <option value="medium">Medium</option>
              <option value="low">Low</option>
            </select>
          </div>
          <div class="form-group">
            <label class="form-label">Insurance Status</label>
            <select class="form-select" x-model="filters.insuranceStatus">
              <option value="">All Insurance</option>
              <option value="approved">Approved</option>
              <option value="pending">Pending</option>
              <option value="rejected">Rejected</option>
              <option value="cash">Cash Pay</option>
            </select>
          </div>
          <div class="form-group">
            <label class="form-label">Inventory Status</label>
            <select class="form-select" x-model="filters.inventoryStatus">
              <option value="">All Inventory</option>
              <option value="in-stock">In Stock</option>
              <option value="low-stock">Low Stock</option>
              <option value="out-of-stock">Out of Stock</option>
            </select>
          </div>
          <div class="form-group">
            <label class="form-label">Date Range</label>
            <select class="form-select" x-model="filters.dateRange">
              <option value="today">Today</option>
              <option value="week">This Week</option>
              <option value="month">This Month</option>
              <option value="all">All Time</option>
            </select>
          </div>
          <div class="form-group">
            <button class="btn btn-primary" @click="applyFilters">
              <span class="material-symbols-rounded">search</span>
              Search
            </button>
          </div>
        </div>
      </div>

      <!-- Spreadsheet Table View -->
      <div class="table-container">
        <table class="spreadsheet-table">
          <thead>
            <tr>
              <th>RX #</th>
              <th>Patient Name</th>
              <th>Date</th>
              <th>Status</th>
              <th>Priority</th>
              <th>Medications</th>
              <th>Insurance</th>
              <th>Inventory</th>
              <th>Prescriber</th>
            </tr>
          </thead>
          <tbody>
            <template x-for="prescription in filteredPrescriptions" :key="prescription.id">
              <tr class="table-row" @click="openPrescriptionDetails(prescription)">
                <td class="rx-number" x-text="`RX-${prescription.id}`"></td>
                <td class="patient-name">
                  <div x-text="prescription.patientName"></div>
                  <div class="text-xs text-gray-500" x-text="prescription.patientPhone"></div>
                </td>
                <td x-text="prescription.date"></td>
                <td>
                  <span class="status-badge" :class="prescription.status" x-text="prescription.status"></span>
                </td>
                <td>
                  <span class="priority-badge" :class="`priority-${prescription.priority}`" x-text="prescription.priority"></span>
                </td>
                <td>
                  <template x-for="med in prescription.medications.slice(0, 2)" :key="med.name">
                    <div class="text-sm" x-text="med.name"></div>
                  </template>
                  <div x-show="prescription.medications.length > 2" class="text-xs text-gray-500">
                    +<span x-text="prescription.medications.length - 2"></span> more
                  </div>
                </td>
                <td>
                  <div class="insurance-status" :class="prescription.insuranceStatus">
                    <span class="material-symbols-rounded">health_and_safety</span>
                    <span x-text="prescription.insuranceStatus"></span>
                  </div>
                </td>
                <td>
                  <div class="inventory-status" :class="prescription.inventoryStatus">
                    <span class="material-symbols-rounded">inventory_2</span>
                    <span x-text="prescription.inventoryStatus"></span>
                  </div>
                </td>
                <td>
                  <div class="text-sm" x-text="prescription.prescriber"></div>
                  <div class="text-xs text-gray-500" x-text="prescription.prescriberLicense"></div>
                </td>
              </tr>
            </template>
          </tbody>
        </table>
      </div>
    </div>
  </main>

  <!-- Prescription Details Modal -->
  <div x-show="showDetailsModal" class="modal-overlay" @click.self="showDetailsModal = false">
    <div class="modal-content">
      <div class="modal-header">
        <h2 class="modal-title">Prescription Details - RX-<span x-text="selectedPrescription?.id"></span></h2>
        <button class="modal-close" @click="showDetailsModal = false">
          <span class="material-symbols-rounded">close</span>
        </button>
      </div>
      
      <div x-show="selectedPrescription">
        <!-- Workflow Timeline -->
        <div class="mb-6">
          <h3 class="font-semibold mb-3">Workflow Status</h3>
          <div class="workflow-timeline">
            <div class="workflow-step" :class="selectedPrescription?.workflow?.submitted ? 'completed' : ''">
              <div class="workflow-icon">
                <span class="material-symbols-rounded">receipt_long</span>
              </div>
              <div class="workflow-label">Submitted</div>
            </div>
            <div class="workflow-step" :class="selectedPrescription?.workflow?.verified ? 'completed' : ''">
              <div class="workflow-icon">
                <span class="material-symbols-rounded">verified</span>
              </div>
              <div class="workflow-label">Verified</div>
            </div>
            <div class="workflow-step" :class="selectedPrescription?.workflow?.filled ? 'completed' : ''">
              <div class="workflow-icon">
                <span class="material-symbols-rounded">store</span>
              </div>
              <div class="workflow-label">Filled</div>
            </div>
            <div class="workflow-step" :class="selectedPrescription?.workflow?.dispensed ? 'completed' : ''">
              <div class="workflow-icon">
                <span class="material-symbols-rounded">check_circle</span>
              </div>
              <div class="workflow-label">Dispensed</div>
            </div>
          </div>
        </div>

        <!-- Clinical Decision Support Alerts -->
        <div x-show="selectedPrescription?.cdsAlerts && selectedPrescription.cdsAlerts.length > 0" class="mb-6">
          <h3 class="font-semibold mb-3">Clinical Alerts</h3>
          <template x-for="alert in selectedPrescription.cdsAlerts" :key="alert.type">
            <div class="cds-alert" :class="alert.severity">
              <span class="material-symbols-rounded" x-text="alert.icon"></span>
              <div>
                <strong x-text="alert.title"></strong>
                <div x-text="alert.message"></div>
              </div>
            </div>
          </template>
        </div>

        <!-- Patient Information -->
        <div class="mb-6">
          <h3 class="font-semibold mb-3">Patient Information</h3>
          <div class="grid grid-cols-2 gap-4 mb-4">
            <div>
              <strong>Name:</strong> <span x-text="selectedPrescription?.patientName"></span>
            </div>
            <div>
              <strong>Date of Birth:</strong> <span x-text="selectedPrescription?.patientDOB"></span>
            </div>
            <div>
              <strong>Phone:</strong> <span x-text="selectedPrescription?.patientPhone"></span>
            </div>
            <div>
              <strong>Allergies:</strong> <span x-text="selectedPrescription?.allergies"></span>
            </div>
          </div>
          
          <!-- Risk Factors -->
          <div x-show="selectedPrescription?.riskFactors && selectedPrescription.riskFactors.length > 0">
            <strong class="block mb-2">Risk Factors:</strong>
            <div class="risk-factors">
              <template x-for="risk in selectedPrescription.riskFactors" :key="risk">
                <span class="risk-tag" x-text="risk"></span>
              </template>
            </div>
          </div>
        </div>

        <!-- Insurance Information -->
        <div class="mb-6">
          <h3 class="font-semibold mb-3">Insurance Information</h3>
          <div class="insurance-status" :class="selectedPrescription?.insuranceStatus">
            <span class="material-symbols-rounded">health_and_safety</span>
            <span x-text="selectedPrescription?.insuranceStatus"></span>
          </div>
          <div class="grid grid-cols-2 gap-4 mt-3">
            <div>
              <strong>Provider:</strong> <span x-text="selectedPrescription?.insuranceProvider"></span>
            </div>
            <div>
              <strong>Member ID:</strong> <span x-text="selectedPrescription?.memberId"></span>
            </div>
            <div>
              <strong>Copay:</strong> ZMW <span x-text="selectedPrescription?.copay"></span>
            </div>
            <div>
              <strong>Auth Required:</strong> <span x-text="selectedPrescription?.authRequired ? 'Yes' : 'No'"></span>
            </div>
          </div>
        </div>

        <!-- Medications -->
        <div class="mb-6">
          <h3 class="font-semibold mb-3">Medications</h3>
          <template x-for="med in selectedPrescription?.medications" :key="med.name">
            <div class="border rounded-lg p-3 mb-2">
              <div class="font-medium" x-text="med.name"></div>
              <div class="text-sm text-gray-600" x-text="`Dosage: ${med.dosage} | Quantity: ${med.quantity} | Days Supply: ${med.daysSupply}`"></div>
              <div class="text-sm text-gray-600" x-text="`Instructions: ${med.instructions}`"></div>
              <div class="text-sm text-gray-600" x-text="`Refills: ${med.refills} | NDC: ${med.ndc}`"></div>
              
              <!-- Inventory Status per Medication -->
              <div class="mt-2">
                <div class="inventory-status" :class="med.inventoryStatus">
                  <span class="material-symbols-rounded">inventory_2</span>
                  <span x-text="`${med.inventoryStatus} (${med.stockCount} units)`"></span>
                </div>
              </div>
            </div>
          </template>
        </div>

        <!-- Compounding Section (if applicable) -->
        <div x-show="selectedPrescription?.isCompound" class="compounding-section mb-6">
          <h3 class="font-semibold mb-3">Compounding Details</h3>
          <template x-for="ingredient in selectedPrescription.compoundIngredients" :key="ingredient.name">
            <div class="compound-ingredient">
              <span x-text="ingredient.name"></span>
              <span x-text="`${ingredient.strength} - ${ingredient.quantity}`"></span>
            </div>
          </template>
          <div class="text-sm text-gray-600 mt-2" x-text="`Total Quantity: ${selectedPrescription.compoundTotalQuantity} | Expiration: ${selectedPrescription.compoundExpiration}`"></div>
        </div>

        <!-- Prescriber Information -->
        <div class="mb-6">
          <h3 class="font-semibold mb-3">Prescriber Information</h3>
          <div class="text-sm text-gray-600">
            <div><strong>Dr. </strong><span x-text="selectedPrescription?.prescriber"></span></div>
            <div><strong>License:</strong> <span x-text="selectedPrescription?.prescriberLicense"></span></div>
            <div><strong>DEA:</strong> <span x-text="selectedPrescription?.prescriberDEA"></span></div>
            <div><strong>Phone:</strong> <span x-text="selectedPrescription?.prescriberPhone"></span></div>
          </div>
        </div>

        <!-- Action Buttons -->
        <div class="action-buttons justify-end">
          <button class="action-btn secondary" @click="showDetailsModal = false">Close</button>
          <button class="action-btn warning" @click="putOnHold(selectedPrescription)">
            <span class="material-symbols-rounded">pause</span>
            Put on Hold
          </button>
          <button class="action-btn success" @click="verifyPrescription(selectedPrescription)">
            <span class="material-symbols-rounded">verified</span>
            Verify
          </button>
          <button class="action-btn primary" @click="processPrescription(selectedPrescription)">
            <span class="material-symbols-rounded">check_circle</span>
            Process
          </button>
        </div>
      </div>
    </div>
  </div>

  <!-- Patient Lookup Popup -->
  <div x-show="showPatientLookup" class="popup-overlay" @click.self="showPatientLookup = false">
    <div class="popup-content">
      <div class="popup-header">
        <h3 class="popup-title">Patient Lookup</h3>
        <button class="popup-close" @click="showPatientLookup = false">
          <span class="material-symbols-rounded">close</span>
        </button>
      </div>
      
      <div class="popup-body">
        <div class="form-group position-relative">
          <label class="form-label">Search Patient</label>
          <input 
            type="text" 
            class="form-input" 
            placeholder="Enter patient name, DOB, or phone number"
            x-model="patientSearchQuery"
            @input="searchPatients"
            @focus="showSuggestions = true"
          >
          
          <!-- Search Suggestions -->
          <div x-show="showSuggestions && filteredPatients.length > 0" class="search-suggestions">
            <template x-for="patient in filteredPatients" :key="patient.id">
              <div class="suggestion-item" @click="selectPatient(patient)">
                <div class="font-medium" x-text="patient.name"></div>
                <div class="text-sm text-gray-500" x-text="`DOB: ${patient.dob} | Phone: ${patient.phone}`"></div>
              </div>
            </template>
          </div>
        </div>
      </div>
      
      <div class="popup-footer">
        <button class="btn btn-secondary" @click="showPatientLookup = false">Cancel</button>
        <button class="btn btn-primary" @click="createNewPatient">New Patient</button>
      </div>
    </div>
  </div>

  <!-- New Prescription Entry Popup -->
  <div x-show="showNewPrescription" class="popup-overlay" @click.self="showNewPrescription = false">
    <div class="popup-content" style="max-width: 900px;">
      <div class="popup-header">
        <h3 class="popup-title">New Prescription Entry</h3>
        <button class="popup-close" @click="showNewPrescription = false">
          <span class="material-symbols-rounded">close</span>
        </button>
      </div>
      
      <div class="popup-body">
        <!-- Patient Details Section -->
        <div class="mb-6">
          <h4 class="font-semibold mb-3 text-lg">Patient Details</h4>
          <div class="form-grid">
            <div class="form-group">
              <label class="form-label">Full Name *</label>
              <input type="text" class="form-input" placeholder="Enter patient full name" x-model="newRx.patientName" @input="autoFillPatientData" required>
            </div>
            <div class="form-group">
              <label class="form-label">Date of Birth *</label>
              <input type="date" class="form-input" x-model="newRx.patientDOB" @input="calculateAge" required>
            </div>
            <div class="form-group">
              <label class="form-label">Phone Number *</label>
              <input type="tel" class="form-input" placeholder="+260 123 4567" x-model="newRx.patientPhone" @input="formatPhoneNumber" required>
            </div>
            <div class="form-group">
              <label class="form-label">Email</label>
              <input type="email" class="form-input" placeholder="patient@email.com" x-model="newRx.patientEmail">
            </div>
            <div class="form-group full-width">
              <label class="form-label">Address *</label>
              <input type="text" class="form-input" placeholder="Enter full address" x-model="newRx.patientAddress" required>
            </div>
            <div class="form-group">
              <label class="form-label">City</label>
              <input type="text" class="form-input" placeholder="Enter city" x-model="newRx.patientCity">
            </div>
            <div class="form-group">
              <label class="form-label">State/Province</label>
              <input type="text" class="form-input" placeholder="Enter state" x-model="newRx.patientState">
            </div>
            <div class="form-group">
              <label class="form-label">ZIP Code</label>
              <input type="text" class="form-input" placeholder="Enter ZIP code" x-model="newRx.patientZip" @input="formatZipCode">
            </div>
            <div class="form-group full-width">
              <label class="form-label">Known Allergies</label>
              <textarea class="form-input form-textarea" placeholder="List known allergies (e.g., Penicillin, Sulfa, Latex)" x-model="newRx.patientAllergies" rows="2"></textarea>
            </div>
          </div>
        </div>

        <!-- Prescriber Details Section -->
        <div class="mb-6">
          <h4 class="font-semibold mb-3 text-lg">Prescriber Details</h4>
          <div class="form-grid">
            <div class="form-group">
              <label class="form-label">Full Name *</label>
              <select class="form-select" x-model="newRx.prescriberName" @change="onPrescriberSelect" required>
                <option value="">Select prescriber</option>
                <template x-for="prescriber in availablePrescribers" :key="prescriber.id">
                  <option :value="prescriber.fullName" x-text="`${prescriber.title} ${prescriber.fullName}`"></option>
                </template>
              </select>
            </div>
            <div class="form-group">
              <label class="form-label">Professional Title</label>
              <input type="text" class="form-input" :value="getSelectedPrescriberTitle()" readonly>
            </div>
            <div class="form-group">
              <label class="form-label">NPI Number</label>
              <input type="text" class="form-input" :value="getSelectedPrescriberNPI()" readonly>
            </div>
            <div class="form-group">
              <label class="form-label">DEA Number</label>
              <input type="text" class="form-input" :value="getSelectedPrescriberDEA()" readonly>
            </div>
            <div class="form-group">
              <label class="form-label">Phone Number</label>
              <input type="text" class="form-input" :value="getSelectedPrescriberPhone()" readonly>
            </div>
            <div class="form-group">
              <label class="form-label">Fax Number</label>
              <input type="text" class="form-input" :value="getSelectedPrescriberFax()" readonly>
            </div>
            <div class="form-group full-width">
              <label class="form-label">Address</label>
              <input type="text" class="form-input" :value="getSelectedPrescriberAddress()" readonly>
            </div>
            <div class="form-group">
              <label class="form-label">City</label>
              <input type="text" class="form-input" :value="getSelectedPrescriberCity()" readonly>
            </div>
            <div class="form-group">
              <label class="form-label">State</label>
              <input type="text" class="form-input" :value="getSelectedPrescriberState()" readonly>
            </div>
            <div class="form-group">
              <label class="form-label">ZIP Code</label>
              <input type="text" class="form-input" :value="getSelectedPrescriberZip()" readonly>
            </div>
            <div class="form-group full-width">
              <label class="form-label">Signature</label>
              <div class="signature-box">
                <canvas x-ref="signatureCanvas" width="300" height="100" style="border: 1px solid #ccc; border-radius: 4px; background: white; cursor: crosshair;"></canvas>
                <div class="mt-2">
                  <button type="button" class="btn btn-secondary btn-small" @click="clearSignature">Clear Signature</button>
                  <button type="button" class="btn btn-secondary btn-small" @click="undoSignature">Undo</button>
                </div>
              </div>
            </div>
          </div>
        </div>

        <!-- Medication Details Section -->
        <div class="mb-6">
          <h4 class="font-semibold mb-3 text-lg">Medication Details (Inscription)</h4>
          <div class="form-grid">
            <div class="form-group">
              <label class="form-label">Drug Name *</label>
              <input type="text" class="form-input" placeholder="Enter medication name" x-model="newRx.medicationName" @input="autoFillMedicationData" required>
            </div>
            <div class="form-group">
              <label class="form-label">Strength *</label>
              <input type="text" class="form-input" placeholder="e.g., 500mg, 10mg/mL" x-model="newRx.medicationStrength" required>
            </div>
            <div class="form-group">
              <label class="form-label">Dosage Form *</label>
              <select class="form-select" x-model="newRx.dosageForm" @change="updateDaysSupply" required>
                <option value="">Select form</option>
                <option value="tablet">Tablet</option>
                <option value="capsule">Capsule</option>
                <option value="liquid">Liquid</option>
                <option value="cream">Cream</option>
                <option value="ointment">Ointment</option>
                <option value="inhaler">Inhaler</option>
                <option value="patch">Patch</option>
                <option value="suppository">Suppository</option>
                <option value="injection">Injection</option>
              </select>
            </div>
            <div class="form-group">
              <label class="form-label">Quantity to Dispense *</label>
              <input type="text" class="form-input" placeholder="Enter quantity" x-model="newRx.quantityToDispense" @input="calculateTotalAuthorizedQuantity" required>
            </div>
            <div class="form-group">
              <label class="form-label">Total Authorized Quantity *</label>
              <input type="text" class="form-input" placeholder="Including refills" x-model="newRx.totalAuthorizedQuantity" readonly>
            </div>
            <div class="form-group">
              <label class="form-label">Date Written *</label>
              <input type="date" class="form-input" x-model="newRx.dateWritten" required>
            </div>
            <div class="form-group">
              <label class="form-label">First Fill Date</label>
              <input type="date" class="form-input" x-model="newRx.firstFillDate">
            </div>
          </div>
        </div>

        <!-- Directions for Use (Sig) Section -->
        <div class="mb-6">
          <h4 class="font-semibold mb-3 text-lg">Directions for Use (Sig)</h4>
          <div class="form-grid">
            <div class="form-group">
              <label class="form-label">Route of Administration *</label>
              <select class="form-select" x-model="newRx.route" @change="generateCompleteSig" required>
                <option value="">Select route</option>
                <option value="PO">PO (Oral)</option>
                <option value="IM">IM (Intramuscular)</option>
                <option value="IV">IV (Intravenous)</option>
                <option value="SC">SC (Subcutaneous)</option>
                <option value="TOP">Topical</option>
                <option value="INH">Inhalation</option>
                <option value="SL">Sublingual</option>
                <option value="PR">Rectal</option>
                <option value="PV">Vaginal</option>
              </select>
            </div>
            <div class="form-group">
              <label class="form-label">Frequency *</label>
              <input type="text" class="form-input" placeholder="e.g., twice daily, every 4 hours" x-model="newRx.frequency" @input="generateCompleteSig" required>
            </div>
            <div class="form-group">
              <label class="form-label">Duration</label>
              <input type="text" class="form-input" placeholder="e.g., 7 days, 2 weeks" x-model="newRx.duration" @input="generateCompleteSig">
            </div>
            <div class="form-group">
              <label class="form-label">Additional Instructions</label>
              <textarea class="form-input form-textarea" placeholder="Take with food, avoid alcohol, etc." x-model="newRx.additionalInstructions" @input="generateCompleteSig" rows="2"></textarea>
            </div>
            <div class="form-group full-width">
              <label class="form-label">Complete Sig</label>
              <textarea class="form-input form-textarea" placeholder="Auto-generated from above fields" x-model="newRx.completeSig" rows="2" readonly></textarea>
            </div>
          </div>
        </div>

        <!-- Refills/Subscription Section -->
        <div class="mb-6">
          <h4 class="font-semibold mb-3 text-lg">Refills/Subscription</h4>
          <div class="form-grid">
            <div class="form-group">
              <label class="form-label">Number of Refills *</label>
              <input type="number" class="form-input" placeholder="0-11" min="0" max="11" x-model="newRx.numberOfRefills" required>
            </div>
            <div class="form-group">
              <label class="form-label">Days Supply *</label>
              <input type="number" class="form-input" placeholder="30 days" min="1" x-model="newRx.daysSupply" required>
            </div>
            <div class="form-group">
              <label class="form-label">Generic Substitution *</label>
              <select class="form-select" x-model="newRx.genericSubstitution" required>
                <option value="">Select substitution</option>
                <option value="DAW">Dispense as Written (DAW)</option>
                <option value="GENERIC">Generic Allowed</option>
                <option value="BRAND">Brand Required</option>
                <option value="PHARMACIST">Pharmacist Choice</option>
              </select>
            </div>
            <div class="form-group">
              <label class="form-label">DAW Code</label>
              <input type="text" class="form-input" placeholder="DAW code if applicable" x-model="newRx.dawCode">
            </div>
            <div class="form-group">
              <label class="form-label">Priority</label>
              <select class="form-select" x-model="newRx.priority">
                <option value="low">Low</option>
                <option value="medium">Medium</option>
                <option value="high">High</option>
                <option value="urgent">Urgent</option>
                <option value="stat">Stat</option>
              </select>
            </div>
          </div>
        </div>
      </div>
      
      <div class="popup-footer">
        <button class="btn btn-secondary" @click="showNewPrescription = false">Cancel</button>
        <button class="btn btn-primary" @click="saveNewPrescription">Save Prescription</button>
      </div>
    </div>
  </div>

  <!-- New Patient Form Popup -->
  <div x-show="showNewPatientForm" class="popup-overlay" @click.self="showNewPatientForm = false">
    <div class="popup-content">
      <div class="popup-header">
        <h3 class="popup-title">New Patient Registration</h3>
        <button class="popup-close" @click="showNewPatientForm = false">
          <span class="material-symbols-rounded">close</span>
        </button>
      </div>
      
      <div class="popup-body">
        <div class="form-grid">
          <div class="form-group">
            <label class="form-label">First Name</label>
            <input type="text" class="form-input" placeholder="Enter first name" x-model="newPatient.firstName">
          </div>
          <div class="form-group">
            <label class="form-label">Last Name</label>
            <input type="text" class="form-input" placeholder="Enter last name" x-model="newPatient.lastName">
          </div>
          <div class="form-group">
            <label class="form-label">Date of Birth</label>
            <input type="date" class="form-input" x-model="newPatient.dob">
          </div>
          <div class="form-group">
            <label class="form-label">Phone Number</label>
            <input type="tel" class="form-input" placeholder="(555) 123-4567" x-model="newPatient.phone">
          </div>
          <div class="form-group">
            <label class="form-label">Email</label>
            <input type="email" class="form-input" placeholder="patient@email.com" x-model="newPatient.email">
          </div>
          <div class="form-group">
            <label class="form-label">Address</label>
            <input type="text" class="form-input" placeholder="Enter address" x-model="newPatient.address">
          </div>
          <div class="form-group">
            <label class="form-label">City</label>
            <input type="text" class="form-input" placeholder="Enter city" x-model="newPatient.city">
          </div>
          <div class="form-group">
            <label class="form-label">State</label>
            <input type="text" class="form-input" placeholder="Enter state" x-model="newPatient.state">
          </div>
          <div class="form-group">
            <label class="form-label">ZIP Code</label>
            <input type="text" class="form-input" placeholder="Enter ZIP code" x-model="newPatient.zipCode">
          </div>
          <div class="form-group full-width">
            <label class="form-label">Allergies</label>
            <textarea class="form-input form-textarea" placeholder="List known allergies" x-model="newPatient.allergies"></textarea>
          </div>
          <div class="form-group full-width">
            <label class="form-label">Medical Conditions</label>
            <textarea class="form-input form-textarea" placeholder="List medical conditions" x-model="newPatient.conditions"></textarea>
          </div>
          <div class="form-group">
            <label class="form-label">Insurance Provider</label>
            <input type="text" class="form-input" placeholder="Enter insurance provider" x-model="newPatient.insuranceProvider">
          </div>
          <div class="form-group">
            <label class="form-label">Member ID</label>
            <input type="text" class="form-input" placeholder="Enter member ID" x-model="newPatient.memberId">
          </div>
        </div>
      </div>
      
      <div class="popup-footer">
        <button class="btn btn-secondary" @click="showNewPatientForm = false">Cancel</button>
        <button class="btn btn-primary" @click="saveNewPatient">Save Patient</button>
      </div>
    </div>
  </div>

  <!-- Compounding Wizard Popup -->
  <div x-show="showCompoundingWizard" class="popup-overlay" @click.self="showCompoundingWizard = false">
    <div class="popup-content" style="max-width: 700px;">
      <div class="popup-header">
        <h3 class="popup-title">Compounding Wizard</h3>
        <button class="popup-close" @click="showCompoundingWizard = false">
          <span class="material-symbols-rounded">close</span>
        </button>
      </div>
      
      <div class="popup-body">
        <div class="form-grid">
          <div class="form-group full-width">
            <label class="form-label">Compound Name</label>
            <input type="text" class="form-input" placeholder="Enter compound name" x-model="compound.name">
          </div>
          <div class="form-group full-width">
            <label class="form-label">Formula Type</label>
            <select class="form-select" x-model="compound.formulaType">
              <option value="">Select formula type</option>
              <option value="cream">Cream</option>
              <option value="ointment">Ointment</option>
              <option value="solution">Solution</option>
              <option value="suspension">Suspension</option>
              <option value="capsule">Capsule</option>
              <option value="troche">Troche</option>
            </select>
          </div>
          <div class="form-group">
            <label class="form-label">Total Quantity</label>
            <input type="text" class="form-input" placeholder="e.g., 30g, 60ml" x-model="compound.totalQuantity">
          </div>
          <div class="form-group">
            <label class="form-label">Expiration Date</label>
            <input type="date" class="form-input" x-model="compound.expirationDate">
          </div>
        </div>
        
        <div class="mt-4">
          <h4 class="font-semibold mb-3">Ingredients</h4>
          <template x-for="(ingredient, index) in compound.ingredients" :key="index">
            <div class="form-grid">
              <div class="form-group">
                <label class="form-label">Ingredient Name</label>
                <input type="text" class="form-input" placeholder="Enter ingredient" x-model="ingredient.name">
              </div>
              <div class="form-group">
                <label class="form-label">Strength</label>
                <input type="text" class="form-input" placeholder="e.g., 10%" x-model="ingredient.strength">
              </div>
              <div class="form-group">
                <label class="form-label">Quantity</label>
                <input type="text" class="form-input" placeholder="e.g., 3g" x-model="ingredient.quantity">
              </div>
              <div class="form-group">
                <button class="btn btn-danger btn-small" @click="removeIngredient(index)">
                  <span class="material-symbols-rounded">delete</span>
                </button>
              </div>
            </div>
          </template>
          <button class="btn btn-secondary btn-small mt-2" @click="addIngredient">
            <span class="material-symbols-rounded">add</span>
            Add Ingredient
          </button>
        </div>
        
        <div class="mt-4">
          <h4 class="font-semibold mb-3">Quality Control</h4>
          <div class="form-grid">
            <div class="form-group">
              <label class="form-label">Batch Number</label>
              <input type="text" class="form-input" placeholder="Enter batch number" x-model="compound.batchNumber">
            </div>
            <div class="form-group">
              <label class="form-label">Prepared By</label>
              <input type="text" class="form-input" placeholder="Pharmacist name" x-model="compound.preparedBy">
            </div>
            <div class="form-group">
              <label class="form-label">Verified By</label>
              <input type="text" class="form-input" placeholder="Verifying pharmacist" x-model="compound.verifiedBy">
            </div>
            <div class="form-group">
              <label class="form-label">Scale Used</label>
              <input type="text" class="form-input" placeholder="Scale ID" x-model="compound.scaleUsed">
            </div>
          </div>
        </div>
      </div>
      
      <div class="popup-footer">
        <button class="btn btn-secondary" @click="showCompoundingWizard = false">Cancel</button>
        <button class="btn btn-primary" @click="saveCompound">Save Compound</button>
      </div>
    </div>
  </div>

  <!-- Drug Interaction Checker Popup -->
  <div x-show="showDrugInteractionChecker" class="popup-overlay" @click.self="showDrugInteractionChecker = false">
    <div class="popup-content" style="max-width: 800px;">
      <div class="popup-header">
        <h3 class="popup-title">Drug Interaction Checker</h3>
        <button class="popup-close" @click="showDrugInteractionChecker = false">
          <span class="material-symbols-rounded">close</span>
        </button>
      </div>
      
      <div class="popup-body">
        <div class="form-grid">
          <div class="form-group full-width">
            <label class="form-label">Current Medications</label>
            <textarea class="form-input form-textarea" placeholder="Enter current medications (one per line)" x-model="drugCheck.currentMeds" rows="4"></textarea>
          </div>
          <div class="form-group full-width">
            <label class="form-label">New Medication</label>
            <input type="text" class="form-input" placeholder="Enter new medication to check" x-model="drugCheck.newMed">
          </div>
          <div class="form-group full-width">
            <label class="form-label">Patient Allergies</label>
            <textarea class="form-input form-textarea" placeholder="Enter patient allergies" x-model="drugCheck.allergies" rows="2"></textarea>
          </div>
        </div>
        
        <div class="mt-4">
          <button class="btn btn-primary" @click="checkDrugInteractions">
            <span class="material-symbols-rounded">search</span>
            Check Interactions
          </button>
        </div>
        
        <div x-show="drugCheck.results.length > 0" class="mt-4">
          <h4 class="font-semibold mb-3">Interaction Results</h4>
          <template x-for="result in drugCheck.results" :key="result.id">
            <div class="cds-alert" :class="result.severity">
              <span class="material-symbols-rounded" x-text="result.icon"></span>
              <div>
                <strong x-text="result.title"></strong>
                <div x-text="result.description"></div>
                <div class="text-sm mt-1">
                  <strong>Recommendation:</strong> <span x-text="result.recommendation"></span>
                </div>
              </div>
            </div>
          </template>
        </div>
      </div>
      
      <div class="popup-footer">
        <button class="btn btn-secondary" @click="showDrugInteractionChecker = false">Close</button>
      </div>
    </div>
  </div>

  <script>
    function prescriptionsSystem() {
      return {
        sidebarOpen: false,
        isAuthenticated: true,
        loading: false,
        prescriptions: [
          {
            id: 'RX-2024-0147',
            patientId: 'P-2024-0892',
            patientName: 'Sarah Mwale',
            date: '2024-06-28',
            status: 'filled',
            priority: 'medium',
            medications: [
              { name: 'Amoxicillin 500mg', dosage: '1 capsule 3 times daily', quantity: 21, daysSupply: 7 },
              { name: 'Ibuprofen 400mg', dosage: '1 tablet every 6 hours as needed', quantity: 20, daysSupply: 5 }
            ],
            prescriber: 'Dr. J. Mwansa',
            pharmacist: 'Dr. Chileshe Banda',
            notes: 'Patient allergic to penicillin - amoxicillin prescribed with caution',
            insuranceStatus: 'approved',
            totalCost: 'ZMW 450'
          },
          {
            id: 'RX-2024-0148',
            patientId: 'P-2024-0893',
            patientName: 'James Phiri',
            date: '2024-06-30',
            status: 'pending',
            priority: 'high',
            medications: [
              { name: 'Salbutamol Inhaler 100mcg', dosage: '2 puffs every 4-6 hours as needed', quantity: 1, daysSupply: 30 }
            ],
            prescriber: 'Dr. L. Chanda',
            pharmacist: 'Pending',
            notes: 'Asthma exacerbation - ensure proper inhaler technique',
            insuranceStatus: 'pending',
            totalCost: 'ZMW 280'
          },
          {
            id: 'RX-2024-0149',
            patientId: 'P-2024-0894',
            patientName: 'Mary Banda',
            date: '2024-06-29',
            status: 'ready-for-pickup',
            priority: 'medium',
            medications: [
              { name: 'Lisinopril 10mg', dosage: '1 tablet daily', quantity: 30, daysSupply: 30 },
              { name: 'Amlodipine 5mg', dosage: '1 tablet daily', quantity: 30, daysSupply: 30 }
            ],
            prescriber: 'Dr. K. Phiri',
            pharmacist: 'Dr. Chileshe Banda',
            notes: 'Blood pressure medication - monitor for side effects',
            insuranceStatus: 'approved',
            totalCost: 'ZMW 320'
          },
          {
            id: 'RX-2024-0150',
            patientId: 'P-2024-0895',
            patientName: 'John Tembo',
            date: '2024-06-25',
            status: 'verified',
            priority: 'low',
            medications: [
              { name: 'Vitamin D3 1000IU', dosage: '1 capsule daily', quantity: 30, daysSupply: 30 }
            ],
            prescriber: 'Dr. M. Banda',
            pharmacist: 'Pending verification',
            notes: 'Supplement for vitamin D deficiency',
            insuranceStatus: 'not-covered',
            totalCost: 'ZMW 85'
          },
          {
            id: 'RX-2024-0151',
            patientId: 'P-2024-0896',
            patientName: 'Esther Chanda',
            date: '2024-06-30',
            status: 'submitted',
            priority: 'medium',
            medications: [
              { name: 'Sumatriptan 100mg', dosage: '1 tablet at onset of migraine', quantity: 6, daysSupply: 6 }
            ],
            prescriber: 'Dr. N. Zulu',
            pharmacist: 'Pending',
            notes: 'For migraine attacks - limit to 2 tablets per day',
            insuranceStatus: 'pending',
            totalCost: 'ZMW 180'
          }
        ],
        stats: {
          totalPrescriptions: 1247,
          pending: 12,
          filled: 38,
          readyForPickup: 8,
          expired: 2,
          onHold: 3
        },
        init() {
          // Initialize with mock data
        },
        searchPrescriptions(query) {
          if (!query) return this.prescriptions;
          const searchTerm = query.toLowerCase();
          return this.prescriptions.filter(rx => 
            rx.id.toLowerCase().includes(searchTerm) ||
            rx.patientName.toLowerCase().includes(searchTerm) ||
            rx.status.toLowerCase().includes(searchTerm)
          );
        },
        updatePrescriptionStatus(rxId, newStatus) {
          const rx = this.prescriptions.find(r => r.id === rxId);
          if (rx) {
            rx.status = newStatus;
            alert(`Prescription ${rxId} status updated to ${newStatus}`);
          }
        },
        viewPrescription(rxId) {
          alert(`View prescription details for RX ID: ${rxId}`);
        },
        editPrescription(rxId) {
          alert(`Edit prescription functionality for RX ID: ${rxId}`);
        },
        deletePrescription(rxId) {
          if (confirm('Are you sure you want to delete this prescription?')) {
            this.prescriptions = this.prescriptions.filter(rx => rx.id !== rxId);
            alert(`Prescription ${rxId} deleted successfully`);
          }
        },
        logout() {
          if (confirm('Are you sure you want to logout?')) {
            window.location.href = '../signin.html';
          }
        }
      }
    }
  </script>
</body>
</html>

        
