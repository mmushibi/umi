{
	"info": {
		"_postman_id": "e5f6a7b8-c9d0-1234-ef56-789012345678",
		"name": "Umi Health - Patient Management Tests",
		"description": "Comprehensive test suite for patient management endpoints including patient registration, prescription creation, dispensing, and history tracking.",
		"schema": "https://schema.getpostman.com/json/collection/v2.1.0/collection.json"
	},
	"item": [
		{
			"name": "Patient Registration",
			"item": [
				{
					"name": "Register New Patient",
					"event": [
						{
							"listen": "test",
							"script": {
								"exec": [
									"pm.test(\"Status code is 201\", function () {",
									"    pm.response.to.have.status(201);",
									"});",
									"",
									"pm.test(\"Response contains patient data\", function () {",
									"    const jsonData = pm.response.json();",
									"    pm.expect(jsonData).to.have.property('id');",
									"    pm.expect(jsonData).to.have.property('patientNumber');",
									"    pm.expect(jsonData).to.have.property('firstName');",
									"    pm.expect(jsonData).to.have.property('lastName');",
									"    pm.expect(jsonData).to.have.property('email');",
									"    pm.expect(jsonData).to.have.property('phoneNumber');",
									"});",
									"",
									"pm.test(\"Patient has required properties\", function () {",
									"    const jsonData = pm.response.json();",
									"    pm.expect(jsonData).to.have.property('dateOfBirth');",
									"    pm.expect(jsonData).to.have.property('gender');",
									"    pm.expect(jsonData).to.have.property('address');",
									"    pm.expect(jsonData).to.have.property('emergencyContact');",
									"    pm.expect(jsonData).to.have.property('medicalInfo');",
									"});",
									"",
									"// Store patient data for subsequent tests",
									"if (pm.response.code === 201) {",
									"    const jsonData = pm.response.json();",
									"    pm.environment.set(\"patient_id\", jsonData.id);",
									"    pm.environment.set(\"patient_number\", jsonData.patientNumber);",
									"    pm.environment.set(\"patient_email\", jsonData.email);",
									"}"
								],
								"type": "text/javascript"
							}
						}
					],
					"request": {
						"method": "POST",
						"header": [
							{
								"key": "Content-Type",
								"value": "application/json"
							},
							{
								"key": "Authorization",
								"value": "Bearer {{access_token}}"
							},
							{
								"key": "X-Tenant-Code",
								"value": "{{tenant_code}}"
							}
						],
						"body": {
							"mode": "raw",
							"raw": "{\n  \"firstName\": \"{{patient_firstName}}\",\n  \"lastName\": \"{{patient_lastName}}\",\n  \"email\": \"{{patient_email}}\",\n  \"phoneNumber\": \"+1234567890\",\n  \"dateOfBirth\": \"1985-06-15\",\n  \"gender\": \"M\",\n  \"address\": {\n    \"street\": \"123 Patient Street\",\n    \"city\": \"Patient City\",\n    \"state\": \"Patient State\",\n    \"postalCode\": \"12345\",\n    \"country\": \"USA\"\n  },\n  \"emergencyContact\": {\n    \"name\": \"Jane Doe\",\n    \"relationship\": \"Spouse\",\n    \"phoneNumber\": \"+0987654321\"\n  },\n  \"medicalInfo\": {\n    \"bloodType\": \"O+\",\n    \"allergies\": [\"Penicillin\", \"Peanuts\"],\n    \"medicalConditions\": [\"Hypertension\"],\n    \"currentMedications\": [\"Lisinopril 10mg\"],\n    \"primaryPhysician\": {\n      \"name\": \"Dr. Smith\",\n      \"phone\": \"+1111111111\",\n      \"clinic\": \"Medical Center\"\n    }\n  },\n  \"insuranceInfo\": {\n    \"provider\": \"Health Insurance Co\",\n    \"policyNumber\": \"POL123456\",\n    \"groupNumber\": \"GRP789\",\n    \"validUntil\": \"2025-12-31\"\n  },\n  \"branchId\": \"{{branch_id}}\"\n}"
						},
						"url": {
							"raw": "{{base_url}}/api/v1/patients",
							"host": [
								"{{base_url}}"
							],
							"path": [
								"api",
								"v1",
								"patients"
							]
						}
					},
					"response": []
				},
				{
					"name": "Get Patient Details",
					"event": [
						{
							"listen": "test",
							"script": {
								"exec": [
									"pm.test(\"Status code is 200\", function () {",
									"    pm.response.to.have.status(200);",
									"});",
									"",
									"pm.test(\"Response contains complete patient data\", function () {",
									"    const jsonData = pm.response.json();",
									"    pm.expect(jsonData).to.have.property('id');",
									"    pm.expect(jsonData).to.have.property('patientNumber');",
									"    pm.expect(jsonData).to.have.property('personalInfo');",
									"    pm.expect(jsonData).to.have.property('medicalInfo');",
									"    pm.expect(jsonData).to.have.property('insuranceInfo');",
									"    pm.expect(jsonData).to.have.property('visitHistory');",
									"});",
									"",
									"pm.test(\"Patient matches created data\", function () {",
									"    const jsonData = pm.response.json();",
									"    pm.expect(jsonData.id).to.eql(pm.environment.get(\"patient_id\"));",
									"    pm.expect(jsonData.patientNumber).to.eql(pm.environment.get(\"patient_number\"));",
									"});"
								],
								"type": "text/javascript"
							}
						}
					],
					"request": {
						"method": "GET",
						"header": [
							{
								"key": "Authorization",
								"value": "Bearer {{access_token}}"
							},
							{
								"key": "X-Tenant-Code",
								"value": "{{tenant_code}}"
							}
						],
						"url": {
							"raw": "{{base_url}}/api/v1/patients/{{patient_id}}",
							"host": [
								"{{base_url}}"
							],
							"path": [
								"api",
								"v1",
								"patients",
								"{{patient_id}}"
							]
						}
					},
					"response": []
				},
				{
					"name": "Search Patients",
					"event": [
						{
							"listen": "test",
							"script": {
								"exec": [
									"pm.test(\"Status code is 200\", function () {",
									"    pm.response.to.have.status(200);",
									"});",
									"",
									"pm.test(\"Response contains search results\", function () {",
									"    const jsonData = pm.response.json();",
									"    pm.expect(jsonData).to.have.property('items');",
									"    pm.expect(jsonData.items).to.be.an('array');",
									"    pm.expect(jsonData).to.have.property('totalCount');",
									"    pm.expect(jsonData).to.have.property('page');",
									"});",
									"",
									"pm.test(\"Search results are valid\", function () {",
									"    const jsonData = pm.response.json();",
									"    if (jsonData.items.length > 0) {",
									"        const patient = jsonData.items[0];",
									"        pm.expect(patient).to.have.property('id');",
									"        pm.expect(patient).to.have.property('patientNumber');",
									"        pm.expect(patient).to.have.property('firstName');",
									"        pm.expect(patient).to.have.property('lastName');",
									"    }",
									"});"
								],
								"type": "text/javascript"
							}
						}
					],
					"request": {
						"method": "GET",
						"header": [
							{
								"key": "Authorization",
								"value": "Bearer {{access_token}}"
							},
							{
								"key": "X-Tenant-Code",
								"value": "{{tenant_code}}"
							}
						],
						"url": {
							"raw": "{{base_url}}/api/v1/patients/search?q={{patient_firstName}}&branchId={{branch_id}}&page=1&pageSize=10",
							"host": [
								"{{base_url}}"
							],
							"path": [
								"api",
								"v1",
								"patients",
								"search"
							],
							"query": [
								{
									"key": "q",
									"value": "{{patient_firstName}}"
								},
								{
									"key": "branchId",
									"value": "{{branch_id}}"
								},
								{
									"key": "page",
									"value": "1"
								},
								{
									"key": "pageSize",
									"value": "10"
								}
							]
						}
					},
					"response": []
				},
				{
					"name": "Update Patient Information",
					"event": [
						{
							"listen": "test",
							"script": {
								"exec": [
									"pm.test(\"Status code is 200\", function () {",
									"    pm.response.to.have.status(200);",
									"});",
									"",
									"pm.test(\"Response contains updated patient data\", function () {",
									"    const jsonData = pm.response.json();",
									"    pm.expect(jsonData).to.have.property('id');",
									"    pm.expect(jsonData).to.have.property('firstName');",
									"    pm.expect(jsonData).to.have.property('lastName');",
									"    pm.expect(jsonData.phoneNumber).to.eql('+1234567899');",
									"});"
								],
								"type": "text/javascript"
							}
						}
					],
					"request": {
						"method": "PUT",
						"header": [
							{
								"key": "Content-Type",
								"value": "application/json"
							},
							{
								"key": "Authorization",
								"value": "Bearer {{access_token}}"
							},
							{
								"key": "X-Tenant-Code",
								"value": "{{tenant_code}}"
							}
						],
						"body": {
							"mode": "raw",
							"raw": "{\n  \"firstName\": \"{{patient_firstName}}\",\n  \"lastName\": \"{{patient_lastName}}\",\n  \"phoneNumber\": \"+1234567899\",\n  \"address\": {\n    \"street\": \"456 Updated Street\",\n    \"city\": \"Updated City\",\n    \"state\": \"Patient State\",\n    \"postalCode\": \"12345\",\n    \"country\": \"USA\"\n  },\n  \"medicalInfo\": {\n    \"allergies\": [\"Penicillin\", \"Peanuts\", \"Shellfish\"],\n    \"medicalConditions\": [\"Hypertension\", \"Type 2 Diabetes\"]\n  }\n}"
						},
						"url": {
							"raw": "{{base_url}}/api/v1/patients/{{patient_id}}",
							"host": [
								"{{base_url}}"
							],
							"path": [
								"api",
								"v1",
								"patients",
								"{{patient_id}}"
							]
						}
					},
					"response": []
				}
			]
		},
		{
			"name": "Prescription Creation",
			"item": [
				{
					"name": "Create New Prescription",
					"event": [
						{
							"listen": "test",
							"script": {
								"exec": [
									"pm.test(\"Status code is 201\", function () {",
									"    pm.response.to.have.status(201);",
									"});",
									"",
									"pm.test(\"Response contains prescription data\", function () {",
									"    const jsonData = pm.response.json();",
									"    pm.expect(jsonData).to.have.property('id');",
									"    pm.expect(jsonData).to.have.property('prescriptionNumber');",
									"    pm.expect(jsonData).to.have.property('patientId');",
									"    pm.expect(jsonData).to.have.property('physicianId');",
									"    pm.expect(jsonData).to.have.property('medications');",
									"    pm.expect(jsonData).to.have.property('status');",
									"    pm.expect(jsonData.status).to.eql('active');",
									"});",
									"",
									"pm.test(\"Prescription has required medications\", function () {",
									"    const jsonData = pm.response.json();",
									"    pm.expect(jsonData.medications).to.be.an('array');",
									"    if (jsonData.medications.length > 0) {",
									"        const med = jsonData.medications[0];",
									"        pm.expect(med).to.have.property('productId');",
									"        pm.expect(med).to.have.property('dosage');",
									"        pm.expect(med).to.have.property('frequency');",
									"        pm.expect(med).to.have.property('duration');",
									"        pm.expect(med).to.have.property('quantity');",
									"    }",
									"});",
									"",
									"// Store prescription data for subsequent tests",
									"if (pm.response.code === 201) {",
									"    const jsonData = pm.response.json();",
									"    pm.environment.set(\"prescription_id\", jsonData.id);",
									"    pm.environment.set(\"prescription_number\", jsonData.prescriptionNumber);",
									"}"
								],
								"type": "text/javascript"
							}
						}
					],
					"request": {
						"method": "POST",
						"header": [
							{
								"key": "Content-Type",
								"value": "application/json"
							},
							{
								"key": "Authorization",
								"value": "Bearer {{access_token}}"
							},
							{
								"key": "X-Tenant-Code",
								"value": "{{tenant_code}}"
							}
						],
						"body": {
							"mode": "raw",
							"raw": "{\n  \"patientId\": \"{{patient_id}}\",\n  \"physicianId\": \"phys-12345\",\n  \"physicianInfo\": {\n    \"name\": \"Dr. John Smith\",\n    \"licenseNumber\": \"MD123456\",\n    \"phone\": \"+1111111111\",\n    \"clinic\": \"Medical Center\",\n    \"signature\": \"Dr. John Smith\"\n  },\n  \"medications\": [\n    {\n      \"productId\": \"{{product_id}}\",\n      \"productName\": \"Test Pain Reliever\",\n      \"dosage\": \"500mg\",\n      \"frequency\": \"twice daily\",\n      \"duration\": \"7 days\",\n      \"quantity\": 14,\n      \"instructions\": \"Take with food, avoid alcohol\",\n      \"refillsAllowed\": 2,\n      \"refillsRemaining\": 2\n    },\n    {\n      \"productId\": \"{{product_id_2}}\",\n      \"productName\": \"Test Antibiotic\",\n      \"dosage\": \"250mg\",\n      \"frequency\": \"three times daily\",\n      \"duration\": \"10 days\",\n      \"quantity\": 30,\n      \"instructions\": \"Complete full course\",\n      \"refillsAllowed\": 0,\n      \"refillsRemaining\": 0\n    }\n  ],\n  \"diagnosis\": \"Acute pain and bacterial infection\",\n  \"notes\": \"Patient allergic to penicillin, avoid related medications\",\n  \"branchId\": \"{{branch_id}}\",\n  \"createdBy\": \"{{user_id}}\"\n}"
						},
						"url": {
							"raw": "{{base_url}}/api/v1/prescriptions",
							"host": [
								"{{base_url}}"
							],
							"path": [
								"api",
								"v1",
								"prescriptions"
							]
						}
					},
					"response": []
				},
				{
					"name": "Get Prescription Details",
					"event": [
						{
							"listen": "test",
							"script": {
								"exec": [
									"pm.test(\"Status code is 200\", function () {",
									"    pm.response.to.have.status(200);",
									"});",
									"",
									"pm.test(\"Response contains complete prescription data\", function () {",
									"    const jsonData = pm.response.json();",
									"    pm.expect(jsonData).to.have.property('id');",
									"    pm.expect(jsonData).to.have.property('prescriptionNumber');",
									"    pm.expect(jsonData).to.have.property('patient');",
									"    pm.expect(jsonData).to.have.property('physician');",
									"    pm.expect(jsonData).to.have.property('medications');",
									"    pm.expect(jsonData).to.have.property('dispensingHistory');",
									"});",
									"",
									"pm.test(\"Prescription matches created data\", function () {",
									"    const jsonData = pm.response.json();",
									"    pm.expect(jsonData.id).to.eql(pm.environment.get(\"prescription_id\"));",
									"    pm.expect(jsonData.prescriptionNumber).to.eql(pm.environment.get(\"prescription_number\"));",
									"});"
								],
								"type": "text/javascript"
							}
						}
					],
					"request": {
						"method": "GET",
						"header": [
							{
								"key": "Authorization",
								"value": "Bearer {{access_token}}"
							},
							{
								"key": "X-Tenant-Code",
								"value": "{{tenant_code}}"
							}
						],
						"url": {
							"raw": "{{base_url}}/api/v1/prescriptions/{{prescription_id}}",
							"host": [
								"{{base_url}}"
							],
							"path": [
								"api",
								"v1",
								"prescriptions",
								"{{prescription_id}}"
							]
						}
					},
					"response": []
				},
				{
					"name": "Get Patient Prescriptions",
					"event": [
						{
							"listen": "test",
							"script": {
								"exec": [
									"pm.test(\"Status code is 200\", function () {",
									"    pm.response.to.have.status(200);",
									"});",
									"",
									"pm.test(\"Response contains prescription list\", function () {",
									"    const jsonData = pm.response.json();",
									"    pm.expect(jsonData).to.have.property('items');",
									"    pm.expect(jsonData.items).to.be.an('array');",
									"    pm.expect(jsonData).to.have.property('totalCount');",
									"});",
									"",
									"pm.test(\"Prescription data structure is valid\", function () {",
									"    const jsonData = pm.response.json();",
									"    if (jsonData.items.length > 0) {",
									"        const prescription = jsonData.items[0];",
									"        pm.expect(prescription).to.have.property('id');",
									"        pm.expect(prescription).to.have.property('prescriptionNumber');",
									"        pm.expect(prescription).to.have.property('status');",
									"        pm.expect(prescription).to.have.property('createdAt');",
									"    }",
									"});"
								],
								"type": "text/javascript"
							}
						}
					],
					"request": {
						"method": "GET",
						"header": [
							{
								"key": "Authorization",
								"value": "Bearer {{access_token}}"
							},
							{
								"key": "X-Tenant-Code",
								"value": "{{tenant_code}}"
							}
						],
						"url": {
							"raw": "{{base_url}}/api/v1/prescriptions/patient/{{patient_id}}?status=active",
							"host": [
								"{{base_url}}"
							],
							"path": [
								"api",
								"v1",
								"prescriptions",
								"patient",
								"{{patient_id}}"
							],
							"query": [
								{
									"key": "status",
									"value": "active"
								}
							]
						}
					},
					"response": []
				}
			]
		},
		{
			"name": "Dispensing",
			"item": [
				{
					"name": "Dispense Medication",
					"event": [
						{
							"listen": "test",
							"script": {
								"exec": [
									"pm.test(\"Status code is 201\", function () {",
									"    pm.response.to.have.status(201);",
									"});",
									"",
									"pm.test(\"Response contains dispensing data\", function () {",
									"    const jsonData = pm.response.json();",
									"    pm.expect(jsonData).to.have.property('id');",
									"    pm.expect(jsonData).to.have.property('prescriptionId');",
									"    pm.expect(jsonData).to.have.property('patientId');",
									"    pm.expect(jsonData).to.have.property('medications');",
									"    pm.expect(jsonData).to.have.property('status');",
									"    pm.expect(jsonData.status).to.eql('dispensed');",
									"});",
									"",
									"pm.test(\"Dispensing includes payment information\", function () {",
									"    const jsonData = pm.response.json();",
									"    pm.expect(jsonData).to.have.property('payment');",
									"    pm.expect(jsonData.payment).to.have.property('amount');",
									"    pm.expect(jsonData.payment).to.have.property('method');",
									"});",
									"",
									"// Store dispensing data for subsequent tests",
									"if (pm.response.code === 201) {",
									"    const jsonData = pm.response.json();",
									"    pm.environment.set(\"dispensing_id\", jsonData.id);",
									"    pm.environment.set(\"dispensing_number\", jsonData.dispensingNumber);",
									"}"
								],
								"type": "text/javascript"
							}
						}
					],
					"request": {
						"method": "POST",
						"header": [
							{
								"key": "Content-Type",
								"value": "application/json"
							},
							{
								"key": "Authorization",
								"value": "Bearer {{access_token}}"
							},
							{
								"key": "X-Tenant-Code",
								"value": "{{tenant_code}}"
							}
						],
						"body": {
							"mode": "raw",
							"raw": "{\n  \"prescriptionId\": \"{{prescription_id}}\",\n  \"patientId\": \"{{patient_id}}\",\n  \"branchId\": \"{{branch_id}}\",\n  \"dispensedBy\": \"{{user_id}}\",\n  \"medications\": [\n    {\n      \"productId\": \"{{product_id}}\",\n      \"quantityDispensed\": 14,\n      \"batchNumber\": \"BATCH001\",\n      \"expiryDate\": \"2025-12-31\",\n      \"instructions\": \"Take with food, avoid alcohol\",\n      \"warnings\": [\"May cause drowsiness\", \"Do not operate heavy machinery\"]\n    },\n    {\n      \"productId\": \"{{product_id_2}}\",\n      \"quantityDispensed\": 30,\n      \"batchNumber\": \"BATCH002\",\n      \"expiryDate\": \"2025-06-30\",\n      \"instructions\": \"Complete full course\",\n      \"warnings\": [\"Take with plenty of water\"]\n    }\n  ],\n  \"payment\": {\n    \"method\": \"cash\",\n    \"amount\": 45.99,\n    \"currency\": \"USD\",\n    \"insuranceCoverage\": {\n      \"provider\": \"Health Insurance Co\",\n      \"policyNumber\": \"POL123456\",\n      \"coveredAmount\": 35.99,\n      \"patientResponsibility\": 10.00\n    }\n  },\n  \"notes\": \"Patient counseled on medication usage and potential side effects\",\n  \"counselingProvided\": true,\n  \"counselingNotes\": \"Patient understands dosage instructions and potential interactions\"\n}"
						},
						"url": {
							"raw": "{{base_url}}/api/v1/dispensing",
							"host": [
								"{{base_url}}"
							],
							"path": [
								"api",
								"v1",
								"dispensing"
							]
						}
					},
					"response": []
				},
				{
					"name": "Get Dispensing Details",
					"event": [
						{
							"listen": "test",
							"script": {
								"exec": [
									"pm.test(\"Status code is 200\", function () {",
									"    pm.response.to.have.status(200);",
									"});",
									"",
									"pm.test(\"Response contains complete dispensing data\", function () {",
									"    const jsonData = pm.response.json();",
									"    pm.expect(jsonData).to.have.property('id');",
									"    pm.expect(jsonData).to.have.property('dispensingNumber');",
									"    pm.expect(jsonData).to.have.property('prescription');",
									"    pm.expect(jsonData).to.have.property('patient');",
									"    pm.expect(jsonData).to.have.property('medications');",
									"    pm.expect(jsonData).to.have.property('payment');",
									"});",
									"",
									"pm.test(\"Dispensing matches created data\", function () {",
									"    const jsonData = pm.response.json();",
									"    pm.expect(jsonData.id).to.eql(pm.environment.get(\"dispensing_id\"));",
									"    pm.expect(jsonData.dispensingNumber).to.eql(pm.environment.get(\"dispensing_number\"));",
									"});"
								],
								"type": "text/javascript"
							}
						}
					],
					"request": {
						"method": "GET",
						"header": [
							{
								"key": "Authorization",
								"value": "Bearer {{access_token}}"
							},
							{
								"key": "X-Tenant-Code",
								"value": "{{tenant_code}}"
							}
						],
						"url": {
							"raw": "{{base_url}}/api/v1/dispensing/{{dispensing_id}}",
							"host": [
								"{{base_url}}"
							],
							"path": [
								"api",
								"v1",
								"dispensing",
								"{{dispensing_id}}"
							]
						}
					},
					"response": []
				},
				{
					"name": "Process Refill Request",
					"event": [
						{
							"listen": "test",
							"script": {
								"exec": [
									"pm.test(\"Status code is 201\", function () {",
									"    pm.response.to.have.status(201);",
									"});",
									"",
									"pm.test(\"Response contains refill request data\", function () {",
									"    const jsonData = pm.response.json();",
									"    pm.expect(jsonData).to.have.property('id');",
									"    pm.expect(jsonData).to.have.property('prescriptionId');",
									"    pm.expect(jsonData).to.have.property('patientId');",
									"    pm.expect(jsonData).to.have.property('status');",
									"    pm.expect(jsonData.status).to.eql('pending');",
									"});",
									"",
									"pm.test(\"Refill request has required medications\", function () {",
									"    const jsonData = pm.response.json();",
									"    pm.expect(jsonData).to.have.property('medications');",
									"    pm.expect(jsonData.medications).to.be.an('array');",
									"});"
								],
								"type": "text/javascript"
							}
						}
					],
					"request": {
						"method": "POST",
						"header": [
							{
								"key": "Content-Type",
								"value": "application/json"
							},
							{
								"key": "Authorization",
								"value": "Bearer {{access_token}}"
							},
							{
								"key": "X-Tenant-Code",
								"value": "{{tenant_code}}"
							}
						],
						"body": {
							"mode": "raw",
							"raw": "{\n  \"prescriptionId\": \"{{prescription_id}}\",\n  \"patientId\": \"{{patient_id}}\",\n  \"branchId\": \"{{branch_id}}\",\n  \"requestedBy\": \"{{user_id}}\",\n  \"medications\": [\n    {\n      \"productId\": \"{{product_id}}\",\n      \"quantityRequested\": 14,\n      \"reason\": \"Refill for chronic condition\"\n    }\n  ],\n  \"notes\": \"Patient requesting routine refill for maintenance medication\",\n  \"urgent\": false\n}"
						},
						"url": {
							"raw": "{{base_url}}/api/v1/dispensing/refill-requests",
							"host": [
								"{{base_url}}"
							],
							"path": [
								"api",
								"v1",
								"dispensing",
								"refill-requests"
							]
						}
					},
					"response": []
				}
			]
		},
		{
			"name": "History Tracking",
			"item": [
				{
					"name": "Get Patient Medication History",
					"event": [
						{
							"listen": "test",
							"script": {
								"exec": [
									"pm.test(\"Status code is 200\", function () {",
									"    pm.response.to.have.status(200);",
									"});",
									"",
									"pm.test(\"Response contains medication history\", function () {",
									"    const jsonData = pm.response.json();",
									"    pm.expect(jsonData).to.have.property('medications');",
									"    pm.expect(jsonData.medications).to.be.an('array');",
									"    pm.expect(jsonData).to.have.property('totalCount');",
									"});",
									"",
									"pm.test(\"Medication history entries are valid\", function () {",
									"    const jsonData = pm.response.json();",
									"    if (jsonData.medications.length > 0) {",
									"        const med = jsonData.medications[0];",
									"        pm.expect(med).to.have.property('productName');",
									"        pm.expect(med).to.have.property('dispensedDate');",
									"        pm.expect(med).to.have.property('quantity');",
									"        pm.expect(med).to.have.property('prescribingPhysician');",
									"    }",
									"});"
								],
								"type": "text/javascript"
							}
						}
					],
					"request": {
						"method": "GET",
						"header": [
							{
								"key": "Authorization",
								"value": "Bearer {{access_token}}"
							},
							{
								"key": "X-Tenant-Code",
								"value": "{{tenant_code}}"
							}
						],
						"url": {
							"raw": "{{base_url}}/api/v1/patients/{{patient_id}}/medication-history?startDate=2024-01-01&endDate=2024-12-31",
							"host": [
								"{{base_url}}"
							],
							"path": [
								"api",
								"v1",
								"patients",
								"{{patient_id}}",
								"medication-history"
							],
							"query": [
								{
									"key": "startDate",
									"value": "2024-01-01"
								},
								{
									"key": "endDate",
									"value": "2024-12-31"
								}
							]
						}
					},
					"response": []
				},
				{
					"name": "Get Patient Visit History",
					"event": [
						{
							"listen": "test",
							"script": {
								"exec": [
									"pm.test(\"Status code is 200\", function () {",
									"    pm.response.to.have.status(200);",
									"});",
									"",
									"pm.test(\"Response contains visit history\", function () {",
									"    const jsonData = pm.response.json();",
									"    pm.expect(jsonData).to.have.property('visits');",
									"    pm.expect(jsonData.visits).to.be.an('array');",
									"    pm.expect(jsonData).to.have.property('totalCount');",
									"});",
									"",
									"pm.test(\"Visit history entries are valid\", function () {",
									"    const jsonData = pm.response.json();",
									"    if (jsonData.visits.length > 0) {",
									"        const visit = jsonData.visits[0];",
									"        pm.expect(visit).to.have.property('visitDate');",
									"        pm.expect(visit).to.have.property('visitType');",
									"        pm.expect(visit).to.have.property('prescriptions');",
									"        pm.expect(visit).to.have.property('dispensing');",
									"    }",
									"});"
								],
								"type": "text/javascript"
							}
						}
					],
					"request": {
						"method": "GET",
						"header": [
							{
								"key": "Authorization",
								"value": "Bearer {{access_token}}"
							},
							{
								"key": "X-Tenant-Code",
								"value": "{{tenant_code}}"
							}
						],
						"url": {
							"raw": "{{base_url}}/api/v1/patients/{{patient_id}}/visit-history?page=1&pageSize=10",
							"host": [
								"{{base_url}}"
							],
							"path": [
								"api",
								"v1",
								"patients",
								"{{patient_id}}",
								"visit-history"
							],
							"query": [
								{
									"key": "page",
									"value": "1"
								},
								{
									"key": "pageSize",
									"value": "10"
								}
							]
						}
					},
					"response": []
				},
				{
					"name": "Get Patient Allergy History",
					"event": [
						{
							"listen": "test",
							"script": {
								"exec": [
									"pm.test(\"Status code is 200\", function () {",
									"    pm.response.to.have.status(200);",
									"});",
									"",
									"pm.test(\"Response contains allergy history\", function () {",
									"    const jsonData = pm.response.json();",
									"    pm.expect(jsonData).to.have.property('allergies');",
									"    pm.expect(jsonData.allergies).to.be.an('array');",
									"});",
									"",
									"pm.test(\"Allergy entries are valid\", function () {",
									"    const jsonData = pm.response.json();",
									"    if (jsonData.allergies.length > 0) {",
									"        const allergy = jsonData.allergies[0];",
									"        pm.expect(allergy).to.have.property('allergen');",
									"        pm.expect(allergy).to.have.property('severity');",
									"        pm.expect(allergy).to.have.property('reaction');",
									"        pm.expect(allergy).to.have.property('recordedDate');",
									"    }",
									"});"
								],
								"type": "text/javascript"
							}
						}
					],
					"request": {
						"method": "GET",
						"header": [
							{
								"key": "Authorization",
								"value": "Bearer {{access_token}}"
							},
							{
								"key": "X-Tenant-Code",
								"value": "{{tenant_code}}"
							}
						],
						"url": {
							"raw": "{{base_url}}/api/v1/patients/{{patient_id}}/allergy-history",
							"host": [
								"{{base_url}}"
							],
							"path": [
								"api",
								"v1",
								"patients",
								"{{patient_id}}",
								"allergy-history"
							]
						}
					},
					"response": []
				},
				{
					"name": "Add Allergy Record",
					"event": [
						{
							"listen": "test",
							"script": {
								"exec": [
									"pm.test(\"Status code is 201\", function () {",
									"    pm.response.to.have.status(201);",
									"});",
									"",
									"pm.test(\"Response contains allergy record data\", function () {",
									"    const jsonData = pm.response.json();",
									"    pm.expect(jsonData).to.have.property('id');",
									"    pm.expect(jsonData).to.have.property('patientId');",
									"    pm.expect(jsonData).to.have.property('allergen');",
									"    pm.expect(jsonData).to.have.property('severity');",
									"    pm.expect(jsonData).to.have.property('reaction');",
									"});",
									"",
									"pm.test(\"Allergy record matches request data\", function () {",
									"    const jsonData = pm.response.json();",
									"    pm.expect(jsonData.allergen).to.eql('Shellfish');",
									"    pm.expect(jsonData.severity).to.eql('severe');",
									"});"
								],
								"type": "text/javascript"
							}
						}
					],
					"request": {
						"method": "POST",
						"header": [
							{
								"key": "Content-Type",
								"value": "application/json"
							},
							{
								"key": "Authorization",
								"value": "Bearer {{access_token}}"
							},
							{
								"key": "X-Tenant-Code",
								"value": "{{tenant_code}}"
							}
						],
						"body": {
							"mode": "raw",
							"raw": "{\n  \"allergen\": \"Shellfish\",\n  \"severity\": \"severe\",\n  \"reaction\": \"Anaphylaxis, hives, difficulty breathing\",\n  \"onsetType\": \"immediate\",\n  \"firstObserved\": \"2020-03-15\",\n  \"source\": \"patient_reported\",\n  \"notes\": \"Patient experienced severe reaction after eating shrimp\",\n  \"recordedBy\": \"{{user_id}}\",\n  \"branchId\": \"{{branch_id}}\"\n}"
						},
						"url": {
							"raw": "{{base_url}}/api/v1/patients/{{patient_id}}/allergies",
							"host": [
								"{{base_url}}"
							],
							"path": [
								"api",
								"v1",
								"patients",
								"{{patient_id}}",
								"allergies"
							]
						}
					},
					"response": []
				}
			]
		}
	],
	"event": [
		{
			"listen": "prerequest",
			"script": {
				"type": "text/javascript",
				"exec": [
					"// Generate unique test data if not set",
					"if (!pm.environment.get(\"patient_firstName\")) {",
					"    const timestamp = Date.now();",
					"    pm.environment.set(\"patient_firstName\", `John${timestamp}`);",
					"    pm.environment.set(\"patient_lastName\", `Doe${timestamp}`);",
					"    pm.environment.set(\"patient_email\", `john.doe${timestamp}@example.com`);",
					"}"
				]
			}
		},
		{
			"listen": "test",
			"script": {
				"type": "text/javascript",
				"exec": [
					"// Global test for response time",
					"pm.test(\"Response time is less than 2000ms\", function () {",
					"    pm.expect(pm.response.responseTime).to.be.below(2000);",
					"});",
					"",
					"// Global test for content type",
					"pm.test(\"Response has JSON content type\", function () {",
					"    pm.expect(pm.response.headers.get(\"Content-Type\")).to.include(\"application/json\");",
					"});"
				]
			}
		}
	]
}
