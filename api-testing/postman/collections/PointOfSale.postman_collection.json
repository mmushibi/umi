{
	"info": {
		"_postman_id": "d4e5f6a7-b8c9-0123-def4-567890123456",
		"name": "Umi Health - Point of Sale Tests",
		"description": "Comprehensive test suite for POS endpoints including sale processing, payment handling, receipt generation, and return processing.",
		"schema": "https://schema.getpostman.com/json/collection/v2.1.0/collection.json"
	},
	"item": [
		{
			"name": "Sale Processing",
			"item": [
				{
					"name": "Create New Sale",
					"event": [
						{
							"listen": "test",
							"script": {
								"exec": [
									"pm.test(\"Status code is 201\", function () {",
									"    pm.response.to.have.status(201);",
									"});",
									"",
									"pm.test(\"Response contains sale data\", function () {",
									"    const jsonData = pm.response.json();",
									"    pm.expect(jsonData).to.have.property('id');",
									"    pm.expect(jsonData).to.have.property('saleNumber');",
									"    pm.expect(jsonData).to.have.property('customerId');",
									"    pm.expect(jsonData).to.have.property('items');",
									"    pm.expect(jsonData).to.have.property('subtotal');",
									"    pm.expect(jsonData).to.have.property('total');",
									"    pm.expect(jsonData).to.have.property('status');",
									"    pm.expect(jsonData.status).to.eql('pending');",
									"});",
									"",
									"pm.test(\"Sale items are valid\", function () {",
									"    const jsonData = pm.response.json();",
									"    pm.expect(jsonData.items).to.be.an('array');",
									"    if (jsonData.items.length > 0) {",
									"        const item = jsonData.items[0];",
									"        pm.expect(item).to.have.property('productId');",
									"        pm.expect(item).to.have.property('quantity');",
									"        pm.expect(item).to.have.property('unitPrice');",
									"        pm.expect(item).to.have.property('total');",
									"    }",
									"});",
									"",
									"// Store sale data for subsequent tests",
									"if (pm.response.code === 201) {",
									"    const jsonData = pm.response.json();",
									"    pm.environment.set(\"sale_id\", jsonData.id);",
									"    pm.environment.set(\"sale_number\", jsonData.saleNumber);",
									"}"
								],
								"type": "text/javascript"
							}
						}
					],
					"request": {
						"method": "POST",
						"header": [
							{
								"key": "Content-Type",
								"value": "application/json"
							},
							{
								"key": "Authorization",
								"value": "Bearer {{access_token}}"
							},
							{
								"key": "X-Tenant-Code",
								"value": "{{tenant_code}}"
							}
						],
						"body": {
							"mode": "raw",
							"raw": "{\n  \"customerId\": \"{{customer_id}}\",\n  \"branchId\": \"{{branch_id}}\",\n  \"cashierId\": \"{{user_id}}\",\n  \"items\": [\n    {\n      \"productId\": \"{{product_id}}\",\n      \"quantity\": 2,\n      \"unitPrice\": 15.99,\n      \"discount\": 0,\n      \"prescriptionRequired\": false,\n      \"batchNumber\": \"BATCH001\"\n    },\n    {\n      \"productId\": \"{{product_id_2}}\",\n      \"quantity\": 1,\n      \"unitPrice\": 25.50,\n      \"discount\": 10,\n      \"prescriptionRequired\": true,\n      \"prescriptionNumber\": \"RX123456\",\n      \"batchNumber\": \"BATCH002\"\n    }\n  ],\n  \"notes\": \"Customer requested additional information about product usage\"\n}"
						},
						"url": {
							"raw": "{{base_url}}/api/v1/pos/sales",
							"host": [
								"{{base_url}}"
							],
							"path": [
								"api",
								"v1",
								"pos",
								"sales"
							]
						}
					},
					"response": []
				},
				{
					"name": "Get Sale Details",
					"event": [
						{
							"listen": "test",
							"script": {
								"exec": [
									"pm.test(\"Status code is 200\", function () {",
									"    pm.response.to.have.status(200);",
									"});",
									"",
									"pm.test(\"Response contains complete sale data\", function () {",
									"    const jsonData = pm.response.json();",
									"    pm.expect(jsonData).to.have.property('id');",
									"    pm.expect(jsonData).to.have.property('saleNumber');",
									"    pm.expect(jsonData).to.have.property('customer');",
									"    pm.expect(jsonData).to.have.property('items');",
									"    pm.expect(jsonData).to.have.property('payments');",
									"    pm.expect(jsonData).to.have.property('timestamps');",
									"});",
									"",
									"pm.test(\"Sale matches created data\", function () {",
									"    const jsonData = pm.response.json();",
									"    pm.expect(jsonData.id).to.eql(pm.environment.get(\"sale_id\"));",
									"    pm.expect(jsonData.saleNumber).to.eql(pm.environment.get(\"sale_number\"));",
									"});"
								],
								"type": "text/javascript"
							}
						}
					],
					"request": {
						"method": "GET",
						"header": [
							{
								"key": "Authorization",
								"value": "Bearer {{access_token}}"
							},
							{
								"key": "X-Tenant-Code",
								"value": "{{tenant_code}}"
							}
						],
						"url": {
							"raw": "{{base_url}}/api/v1/pos/sales/{{sale_id}}",
							"host": [
								"{{base_url}}"
							],
							"path": [
								"api",
								"v1",
								"pos",
								"sales",
								"{{sale_id}}"
							]
						}
					},
					"response": []
				},
				{
					"name": "List Sales",
					"event": [
						{
							"listen": "test",
							"script": {
								"exec": [
									"pm.test(\"Status code is 200\", function () {",
									"    pm.response.to.have.status(200);",
									"});",
									"",
									"pm.test(\"Response contains sales list\", function () {",
									"    const jsonData = pm.response.json();",
									"    pm.expect(jsonData).to.have.property('items');",
									"    pm.expect(jsonData.items).to.be.an('array');",
									"    pm.expect(jsonData).to.have.property('totalCount');",
									"    pm.expect(jsonData).to.have.property('page');",
									"});",
									"",
									"pm.test(\"Sales data structure is valid\", function () {",
									"    const jsonData = pm.response.json();",
									"    if (jsonData.items.length > 0) {",
									"        const sale = jsonData.items[0];",
									"        pm.expect(sale).to.have.property('id');",
									"        pm.expect(sale).to.have.property('saleNumber');",
									"        pm.expect(sale).to.have.property('total');",
									"        pm.expect(sale).to.have.property('status');",
									"        pm.expect(sale).to.have.property('createdAt');",
									"    }",
									"});"
								],
								"type": "text/javascript"
							}
						}
					],
					"request": {
						"method": "GET",
						"header": [
							{
								"key": "Authorization",
								"value": "Bearer {{access_token}}"
							},
							{
								"key": "X-Tenant-Code",
								"value": "{{tenant_code}}"
							}
						],
						"url": {
							"raw": "{{base_url}}/api/v1/pos/sales?branchId={{branch_id}}&status=completed&page=1&pageSize=10",
							"host": [
								"{{base_url}}"
							],
							"path": [
								"api",
								"v1",
								"pos",
								"sales"
							],
							"query": [
								{
									"key": "branchId",
									"value": "{{branch_id}}"
								},
								{
									"key": "status",
									"value": "completed"
								},
								{
									"key": "page",
									"value": "1"
								},
								{
									"key": "pageSize",
									"value": "10"
								}
							]
						}
					},
					"response": []
				},
				{
					"name": "Update Sale Status",
					"event": [
						{
							"listen": "test",
							"script": {
								"exec": [
									"pm.test(\"Status code is 200\", function () {",
									"    pm.response.to.have.status(200);",
									"});",
									"",
									"pm.test(\"Response contains updated sale data\", function () {",
									"    const jsonData = pm.response.json();",
									"    pm.expect(jsonData).to.have.property('id');",
									"    pm.expect(jsonData).to.have.property('status');",
									"    pm.expect(jsonData.status).to.eql('completed');",
									"});"
								],
								"type": "text/javascript"
							}
						}
					],
					"request": {
						"method": "PUT",
						"header": [
							{
								"key": "Content-Type",
								"value": "application/json"
							},
							{
								"key": "Authorization",
								"value": "Bearer {{access_token}}"
							},
							{
								"key": "X-Tenant-Code",
								"value": "{{tenant_code}}"
							}
						],
						"body": {
							"mode": "raw",
							"raw": "{\n  \"status\": \"completed\",\n  \"notes\": \"Sale completed successfully\"\n}"
						},
						"url": {
							"raw": "{{base_url}}/api/v1/pos/sales/{{sale_id}}/status",
							"host": [
								"{{base_url}}"
							],
							"path": [
								"api",
								"v1",
								"pos",
								"sales",
								"{{sale_id}}",
								"status"
							]
						}
					},
					"response": []
				}
			]
		},
		{
			"name": "Payment Handling",
			"item": [
				{
					"name": "Add Payment to Sale",
					"event": [
						{
							"listen": "test",
							"script": {
								"exec": [
									"pm.test(\"Status code is 201\", function () {",
									"    pm.response.to.have.status(201);",
									"});",
									"",
									"pm.test(\"Response contains payment data\", function () {",
									"    const jsonData = pm.response.json();",
									"    pm.expect(jsonData).to.have.property('id');",
									"    pm.expect(jsonData).to.have.property('saleId');",
									"    pm.expect(jsonData).to.have.property('paymentMethod');",
									"    pm.expect(jsonData).to.have.property('amount');",
									"    pm.expect(jsonData).to.have.property('status');",
									"    pm.expect(jsonData.status).to.eql('completed');",
									"});",
									"",
									"pm.test(\"Payment amount is correct\", function () {",
									"    const jsonData = pm.response.json();",
									"    pm.expect(jsonData.amount).to.eql(67.48);",
									"});",
									"",
									"// Store payment data for subsequent tests",
									"if (pm.response.code === 201) {",
									"    const jsonData = pm.response.json();",
									"    pm.environment.set(\"payment_id\", jsonData.id);",
									"}"
								],
								"type": "text/javascript"
							}
						}
					],
					"request": {
						"method": "POST",
						"header": [
							{
								"key": "Content-Type",
								"value": "application/json"
							},
							{
								"key": "Authorization",
								"value": "Bearer {{access_token}}"
							},
							{
								"key": "X-Tenant-Code",
								"value": "{{tenant_code}}"
							}
						],
						"body": {
							"mode": "raw",
							"raw": "{\n  \"saleId\": \"{{sale_id}}\",\n  \"paymentMethod\": \"cash\",\n  \"amount\": 67.48,\n  \"currency\": \"USD\",\n  \"tenderedAmount\": 70.00,\n  \"changeAmount\": 2.52,\n  \"reference\": \"CASH-001\",\n  \"processedBy\": \"{{user_id}}\"\n}"
						},
						"url": {
							"raw": "{{base_url}}/api/v1/pos/payments",
							"host": [
								"{{base_url}}"
							],
							"path": [
								"api",
								"v1",
								"pos",
								"payments"
							]
						}
					},
					"response": []
				},
				{
					"name": "Process Card Payment",
					"event": [
						{
							"listen": "test",
							"script": {
								"exec": [
									"pm.test(\"Status code is 201\", function () {",
									"    pm.response.to.have.status(201);",
									"});",
									"",
									"pm.test(\"Response contains card payment data\", function () {",
									"    const jsonData = pm.response.json();",
									"    pm.expect(jsonData).to.have.property('id');",
									"    pm.expect(jsonData).to.have.property('paymentMethod');",
									"    pm.expect(jsonData.paymentMethod).to.eql('card');",
									"    pm.expect(jsonData).to.have.property('cardDetails');",
									"});",
									"",
									"pm.test(\"Card details are masked\", function () {",
									"    const jsonData = pm.response.json();",
									"    if (jsonData.cardDetails) {",
									"        pm.expect(jsonData.cardDetails.last4).to.be.a('string');",
									"        pm.expect(jsonData.cardDetails.last4).to.have.lengthOf(4);",
									"    }",
									"});"
								],
								"type": "text/javascript"
							}
						}
					],
					"request": {
						"method": "POST",
						"header": [
							{
								"key": "Content-Type",
								"value": "application/json"
							},
							{
								"key": "Authorization",
								"value": "Bearer {{access_token}}"
							},
							{
								"key": "X-Tenant-Code",
								"value": "{{tenant_code}}"
							}
						],
						"body": {
							"mode": "raw",
							"raw": "{\n  \"saleId\": \"{{sale_id}}\",\n  \"paymentMethod\": \"card\",\n  \"amount\": 67.48,\n  \"currency\": \"USD\",\n  \"cardDetails\": {\n    \"cardNumber\": \"4111111111111111\",\n    \"expiryMonth\": \"12\",\n    \"expiryYear\": \"2026\",\n    \"cvv\": \"123\",\n    \"cardholderName\": \"Moses Mushibi\"\n  },\n  \"billingAddress\": {\n    \"street\": \"123 Billing St\",\n    \"city\": \"Billing City\",\n    \"state\": \"Billing State\",\n    \"postalCode\": \"12345\",\n    \"country\": \"USA\"\n  },\n  \"processedBy\": \"{{user_id}}\"\n}"
						},
						"url": {
							"raw": "{{base_url}}/api/v1/pos/payments",
							"host": [
								"{{base_url}}"
							],
							"path": [
								"api",
								"v1",
								"pos",
								"payments"
							]
						}
					},
					"response": []
				},
				{
					"name": "Process Mobile Payment",
					"event": [
						{
							"listen": "test",
							"script": {
								"exec": [
									"pm.test(\"Status code is 201\", function () {",
									"    pm.response.to.have.status(201);",
									"});",
									"",
									"pm.test(\"Response contains mobile payment data\", function () {",
									"    const jsonData = pm.response.json();",
									"    pm.expect(jsonData).to.have.property('paymentMethod');",
									"    pm.expect(jsonData.paymentMethod).to.eql('mobile');",
									"    pm.expect(jsonData).to.have.property('mobileProvider');",
									"});"
								],
								"type": "text/javascript"
							}
						}
					],
					"request": {
						"method": "POST",
						"header": [
							{
								"key": "Content-Type",
								"value": "application/json"
							},
							{
								"key": "Authorization",
								"value": "Bearer {{access_token}}"
							},
							{
								"key": "X-Tenant-Code",
								"value": "{{tenant_code}}"
							}
						],
						"body": {
							"mode": "raw",
							"raw": "{\n  \"saleId\": \"{{sale_id}}\",\n  \"paymentMethod\": \"mobile\",\n  \"amount\": 67.48,\n  \"currency\": \"USD\",\n  \"mobileProvider\": \"paypal\",\n  \"phoneNumber\": \"+1234567890\",\n  \"reference\": \"MOBILE-001\",\n  \"processedBy\": \"{{user_id}}\"\n}"
						},
						"url": {
							"raw": "{{base_url}}/api/v1/pos/payments",
							"host": [
								"{{base_url}}"
							],
							"path": [
								"api",
								"v1",
								"pos",
								"payments"
							]
						}
					},
					"response": []
				},
				{
					"name": "Get Payment Details",
					"event": [
						{
							"listen": "test",
							"script": {
								"exec": [
									"pm.test(\"Status code is 200\", function () {",
									"    pm.response.to.have.status(200);",
									"});",
									"",
									"pm.test(\"Response contains payment details\", function () {",
									"    const jsonData = pm.response.json();",
									"    pm.expect(jsonData).to.have.property('id');",
									"    pm.expect(jsonData).to.have.property('saleId');",
									"    pm.expect(jsonData).to.have.property('paymentMethod');",
									"    pm.expect(jsonData).to.have.property('amount');",
									"    pm.expect(jsonData).to.have.property('status');",
									"    pm.expect(jsonData).to.have.property('createdAt');",
									"});",
									"",
									"pm.test(\"Payment matches created data\", function () {",
									"    const jsonData = pm.response.json();",
									"    pm.expect(jsonData.id).to.eql(pm.environment.get(\"payment_id\"));",
									"});"
								],
								"type": "text/javascript"
							}
						}
					],
					"request": {
						"method": "GET",
						"header": [
							{
								"key": "Authorization",
								"value": "Bearer {{access_token}}"
							},
							{
								"key": "X-Tenant-Code",
								"value": "{{tenant_code}}"
							}
						],
						"url": {
							"raw": "{{base_url}}/api/v1/pos/payments/{{payment_id}}",
							"host": [
								"{{base_url}}"
							],
							"path": [
								"api",
								"v1",
								"pos",
								"payments",
								"{{payment_id}}"
							]
						}
					},
					"response": []
				}
			]
		},
		{
			"name": "Receipt Generation",
			"item": [
				{
					"name": "Generate Receipt",
					"event": [
						{
							"listen": "test",
							"script": {
								"exec": [
									"pm.test(\"Status code is 200\", function () {",
									"    pm.response.to.have.status(200);",
									"});",
									"",
									"pm.test(\"Response contains receipt data\", function () {",
									"    const jsonData = pm.response.json();",
									"    pm.expect(jsonData).to.have.property('id');",
									"    pm.expect(jsonData).to.have.property('saleId');",
									"    pm.expect(jsonData).to.have.property('receiptNumber');",
									"    pm.expect(jsonData).to.have.property('format');",
									"    pm.expect(jsonData).to.have.property('content');",
									"});",
									"",
									"pm.test(\"Receipt contains required information\", function () {",
									"    const jsonData = pm.response.json();",
									"    pm.expect(jsonData.content).to.have.property('header');",
									"    pm.expect(jsonData.content).to.have.property('items');",
									"    pm.expect(jsonData.content).to.have.property('summary');",
									"    pm.expect(jsonData.content).to.have.property('footer');",
									"});",
									"",
									"// Store receipt data for subsequent tests",
									"if (pm.response.code === 200) {",
									"    const jsonData = pm.response.json();",
									"    pm.environment.set(\"receipt_id\", jsonData.id);",
									"    pm.environment.set(\"receipt_number\", jsonData.receiptNumber);",
									"}"
								],
								"type": "text/javascript"
							}
						}
					],
					"request": {
						"method": "POST",
						"header": [
							{
								"key": "Content-Type",
								"value": "application/json"
							},
							{
								"key": "Authorization",
								"value": "Bearer {{access_token}}"
							},
							{
								"key": "X-Tenant-Code",
								"value": "{{tenant_code}}"
							}
						],
						"body": {
							"mode": "raw",
							"raw": "{\n  \"saleId\": \"{{sale_id}}\",\n  \"format\": \"json\",\n  \"includeTaxBreakdown\": true,\n  \"includePaymentDetails\": true,\n  \"includeCustomerInfo\": true,\n  \"printOptions\": {\n    \"duplicate\": false,\n    \"includeHeader\": true,\n    \"includeFooter\": true,\n    \"includeBarcode\": true\n  }\n}"
						},
						"url": {
							"raw": "{{base_url}}/api/v1/pos/receipts",
							"host": [
								"{{base_url}}"
							],
							"path": [
								"api",
								"v1",
								"pos",
								"receipts"
							]
						}
					},
					"response": []
				},
				{
					"name": "Generate PDF Receipt",
					"event": [
						{
							"listen": "test",
							"script": {
								"exec": [
									"pm.test(\"Status code is 200\", function () {",
									"    pm.response.to.have.status(200);",
									"});",
									"",
									"pm.test(\"Response contains PDF receipt\", function () {",
									"    const jsonData = pm.response.json();",
									"    pm.expect(jsonData).to.have.property('id');",
									"    pm.expect(jsonData).to.have.property('format');",
									"    pm.expect(jsonData.format).to.eql('pdf');",
									"    pm.expect(jsonData).to.have.property('downloadUrl');",
									"});",
									"",
									"pm.test(\"PDF download URL is valid\", function () {",
									"    const jsonData = pm.response.json();",
									"    pm.expect(jsonData.downloadUrl).to.be.a('string');",
									"    pm.expect(jsonData.downloadUrl).to.include('.pdf');",
									"});"
								],
								"type": "text/javascript"
							}
						}
					],
					"request": {
						"method": "POST",
						"header": [
							{
								"key": "Content-Type",
								"value": "application/json"
							},
							{
								"key": "Authorization",
								"value": "Bearer {{access_token}}"
							},
							{
								"key": "X-Tenant-Code",
								"value": "{{tenant_code}}"
							}
						],
						"body": {
							"mode": "raw",
							"raw": "{\n  \"saleId\": \"{{sale_id}}\",\n  \"format\": \"pdf\",\n  \"includeTaxBreakdown\": true,\n  \"includePaymentDetails\": true,\n  \"includeCustomerInfo\": true,\n  \"template\": \"standard\",\n  \"emailOptions\": {\n    \"sendToCustomer\": false,\n    \"emailAddress\": \"customer@example.com\"\n  }\n}"
						},
						"url": {
							"raw": "{{base_url}}/api/v1/pos/receipts",
							"host": [
								"{{base_url}}"
							],
							"path": [
								"api",
								"v1",
								"pos",
								"receipts"
							]
						}
					},
					"response": []
				},
				{
					"name": "Email Receipt",
					"event": [
						{
							"listen": "test",
							"script": {
								"exec": [
									"pm.test(\"Status code is 200\", function () {",
									"    pm.response.to.have.status(200);",
									"});",
									"",
									"pm.test(\"Response contains email status\", function () {",
									"    const jsonData = pm.response.json();",
									"    pm.expect(jsonData).to.have.property('success');",
									"    pm.expect(jsonData).to.have.property('message');",
									"    pm.expect(jsonData).to.have.property('emailId');",
									"});",
									"",
									"pm.test(\"Email was sent successfully\", function () {",
									"    const jsonData = pm.response.json();",
									"    pm.expect(jsonData.success).to.be.true;",
									"    pm.expect(jsonData.message).to.include('sent');",
									"});"
								],
								"type": "text/javascript"
							}
						}
					],
					"request": {
						"method": "POST",
						"header": [
							{
								"key": "Content-Type",
								"value": "application/json"
							},
							{
								"key": "Authorization",
								"value": "Bearer {{access_token}}"
							},
							{
								"key": "X-Tenant-Code",
								"value": "{{tenant_code}}"
							}
						],
						"body": {
							"mode": "raw",
							"raw": "{\n  \"receiptId\": \"{{receipt_id}}\",\n  \"emailAddress\": \"{{customer_email}}\",\n  \"subject\": \"Your Receipt from Umi Health Pharmacy\",\n  \"message\": \"Thank you for your purchase. Please find your receipt attached.\",\n  \"format\": \"pdf\",\n  \"includeAttachments\": true\n}"
						},
						"url": {
							"raw": "{{base_url}}/api/v1/pos/receipts/{{receipt_id}}/email",
							"host": [
								"{{base_url}}"
							],
							"path": [
								"api",
								"v1",
								"pos",
								"receipts",
								"{{receipt_id}}",
								"email"
							]
						}
					},
					"response": []
				}
			]
		},
		{
			"name": "Return Processing",
			"item": [
				{
					"name": "Process Return",
					"event": [
						{
							"listen": "test",
							"script": {
								"exec": [
									"pm.test(\"Status code is 201\", function () {",
									"    pm.response.to.have.status(201);",
									"});",
									"",
									"pm.test(\"Response contains return data\", function () {",
									"    const jsonData = pm.response.json();",
									"    pm.expect(jsonData).to.have.property('id');",
									"    pm.expect(jsonData).to.have.property('returnNumber');",
									"    pm.expect(jsonData).to.have.property('originalSaleId');",
									"    pm.expect(jsonData).to.have.property('items');",
									"    pm.expect(jsonData).to.have.property('totalRefund');",
									"    pm.expect(jsonData).to.have.property('status');",
									"    pm.expect(jsonData.status).to.eql('pending');",
									"});",
									"",
									"pm.test(\"Return items are valid\", function () {",
									"    const jsonData = pm.response.json();",
									"    pm.expect(jsonData.items).to.be.an('array');",
									"    if (jsonData.items.length > 0) {",
									"        const item = jsonData.items[0];",
									"        pm.expect(item).to.have.property('productId');",
									"        pm.expect(item).to.have.property('quantity');",
									"        pm.expect(item).to.have.property('reason');",
									"        pm.expect(item).to.have.property('refundAmount');",
									"    }",
									"});",
									"",
									"// Store return data for subsequent tests",
									"if (pm.response.code === 201) {",
									"    const jsonData = pm.response.json();",
									"    pm.environment.set(\"return_id\", jsonData.id);",
									"    pm.environment.set(\"return_number\", jsonData.returnNumber);",
									"}"
								],
								"type": "text/javascript"
							}
						}
					],
					"request": {
						"method": "POST",
						"header": [
							{
								"key": "Content-Type",
								"value": "application/json"
							},
							{
								"key": "Authorization",
								"value": "Bearer {{access_token}}"
							},
							{
								"key": "X-Tenant-Code",
								"value": "{{tenant_code}}"
							}
						],
						"body": {
							"mode": "raw",
							"raw": "{\n  \"originalSaleId\": \"{{sale_id}}\",\n  \"customerId\": \"{{customer_id}}\",\n  \"branchId\": \"{{branch_id}}\",\n  \"processedBy\": \"{{user_id}}\",\n  \"reason\": \"Customer requested refund due to product not needed\",\n  \"items\": [\n    {\n      \"productId\": \"{{product_id}}\",\n      \"quantity\": 1,\n      \"reason\": \"Product not needed\",\n      \"condition\": \"unopened\",\n      \"refundAmount\": 15.99,\n      \"restock\": true\n    }\n  ],\n  \"refundMethod\": \"original_payment\",\n  \"notes\": \"Customer returned item in original packaging\""
						},
						"url": {
							"raw": "{{base_url}}/api/v1/pos/returns",
							"host": [
								"{{base_url}}"
							],
							"path": [
								"api",
								"v1",
								"pos",
								"returns"
							]
						}
					},
					"response": []
				},
				{
					"name": "Approve Return",
					"event": [
						{
							"listen": "test",
							"script": {
								"exec": [
									"pm.test(\"Status code is 200\", function () {",
									"    pm.response.to.have.status(200);",
									"});",
									"",
									"pm.test(\"Response contains approved return data\", function () {",
									"    const jsonData = pm.response.json();",
									"    pm.expect(jsonData).to.have.property('id');",
									"    pm.expect(jsonData).to.have.property('status');",
									"    pm.expect(jsonData.status).to.eql('approved');",
									"    pm.expect(jsonData).to.have.property('refundDetails');",
									"});",
									"",
									"pm.test(\"Refund details are valid\", function () {",
									"    const jsonData = pm.response.json();",
									"    if (jsonData.refundDetails) {",
									"        pm.expect(jsonData.refundDetails).to.have.property('amount');",
									"        pm.expect(jsonData.refundDetails).to.have.property('method');",
									"        pm.expect(jsonData.refundDetails).to.have.property('status');",
									"    }",
									"});"
								],
								"type": "text/javascript"
							}
						}
					],
					"request": {
						"method": "POST",
						"header": [
							{
								"key": "Content-Type",
								"value": "application/json"
							},
							{
								"key": "Authorization",
								"value": "Bearer {{access_token}}"
							},
							{
								"key": "X-Tenant-Code",
								"value": "{{tenant_code}}"
							}
						],
						"body": {
							"mode": "raw",
							"raw": "{\n  \"action\": \"approve\",\n  \"notes\": \"Return approved after inspection of returned item\",\n  \"approvedBy\": \"{{user_id}}\",\n  \"refundDetails\": {\n    \"amount\": 15.99,\n    \"method\": \"original_payment\",\n    \"processingDate\": \"2024-12-24\",\n    \"reference\": \"REFUND-001\"\n  }\n}"
						},
						"url": {
							"raw": "{{base_url}}/api/v1/pos/returns/{{return_id}}/approve",
							"host": [
								"{{base_url}}"
							],
							"path": [
								"api",
								"v1",
								"pos",
								"returns",
								"{{return_id}}",
								"approve"
							]
						}
					},
					"response": []
				},
				{
					"name": "Process Refund",
					"event": [
						{
							"listen": "test",
							"script": {
								"exec": [
									"pm.test(\"Status code is 200\", function () {",
									"    pm.response.to.have.status(200);",
									"});",
									"",
									"pm.test(\"Response contains processed refund data\", function () {",
									"    const jsonData = pm.response.json();",
									"    pm.expect(jsonData).to.have.property('id');",
									"    pm.expect(jsonData).to.have.property('status');",
									"    pm.expect(jsonData.status).to.eql('completed');",
									"    pm.expect(jsonData).to.have.property('refundTransactionId');",
									"});"
								],
								"type": "text/javascript"
							}
						}
					],
					"request": {
						"method": "POST",
						"header": [
							{
								"key": "Content-Type",
								"value": "application/json"
							},
							{
								"key": "Authorization",
								"value": "Bearer {{access_token}}"
							},
							{
								"key": "X-Tenant-Code",
								"value": "{{tenant_code}}"
							}
						],
						"body": {
							"mode": "raw",
							"raw": "{\n  \"action\": \"process_refund\",\n  \"refundTransactionId\": \"REFTXN-001\",\n  \"processedBy\": \"{{user_id}}\",\n  \"notes\": \"Refund processed to original payment method\"\n}"
						},
						"url": {
							"raw": "{{base_url}}/api/v1/pos/returns/{{return_id}}/process",
							"host": [
								"{{base_url}}"
							],
							"path": [
								"api",
								"v1",
								"pos",
								"returns",
								"{{return_id}}",
								"process"
							]
						}
					},
					"response": []
				},
				{
					"name": "Get Return Details",
					"event": [
						{
							"listen": "test",
							"script": {
								"exec": [
									"pm.test(\"Status code is 200\", function () {",
									"    pm.response.to.have.status(200);",
									"});",
									"",
									"pm.test(\"Response contains complete return data\", function () {",
									"    const jsonData = pm.response.json();",
									"    pm.expect(jsonData).to.have.property('id');",
									"    pm.expect(jsonData).to.have.property('returnNumber');",
									"    pm.expect(jsonData).to.have.property('originalSale');",
									"    pm.expect(jsonData).to.have.property('items');",
									"    pm.expect(jsonData).to.have.property('refundDetails');",
									"    pm.expect(jsonData).to.have.property('history');",
									"});",
									"",
									"pm.test(\"Return matches created data\", function () {",
									"    const jsonData = pm.response.json();",
									"    pm.expect(jsonData.id).to.eql(pm.environment.get(\"return_id\"));",
									"    pm.expect(jsonData.returnNumber).to.eql(pm.environment.get(\"return_number\"));",
									"});"
								],
								"type": "text/javascript"
							}
						}
					],
					"request": {
						"method": "GET",
						"header": [
							{
								"key": "Authorization",
								"value": "Bearer {{access_token}}"
							},
							{
								"key": "X-Tenant-Code",
								"value": "{{tenant_code}}"
							}
						],
						"url": {
							"raw": "{{base_url}}/api/v1/pos/returns/{{return_id}}",
							"host": [
								"{{base_url}}"
							],
							"path": [
								"api",
								"v1",
								"pos",
								"returns",
								"{{return_id}}"
							]
						}
					},
					"response": []
				}
			]
		}
	],
	"event": [
		{
			"listen": "prerequest",
			"script": {
				"type": "text/javascript",
				"exec": [
					"// Generate unique test data if not set",
					"if (!pm.environment.get(\"customer_id\")) {",
					"    const timestamp = Date.now();",
					"    pm.environment.set(\"customer_id\", `customer-${timestamp}`);",
					"    pm.environment.set(\"customer_email\", `customer${timestamp}@example.com`);",
					"    pm.environment.set(\"product_id_2\", `product-2-${timestamp}`);",
					"}"
				]
			}
		},
		{
			"listen": "test",
			"script": {
				"type": "text/javascript",
				"exec": [
					"// Global test for response time",
					"pm.test(\"Response time is less than 2000ms\", function () {",
					"    pm.expect(pm.response.responseTime).to.be.below(2000);",
					"});",
					"",
					"// Global test for content type",
					"pm.test(\"Response has JSON content type\", function () {",
					"    pm.expect(pm.response.headers.get(\"Content-Type\")).to.include(\"application/json\");",
					"});"
				]
			}
		}
	]
}
